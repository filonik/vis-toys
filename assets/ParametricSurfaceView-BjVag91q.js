import{w as ae,r as E,c as B,i as Pe,p as ke,d as N,o as He,a as Ye,n as K,b as T,e as A,f as M,u as Ve,g as S,h as me,j as I,k as ne,l as C,m as j,t as q,F as H,q as Y,v as W,s as We,x as Xe,y as Qe,z as Je,_ as et,A as tt,S as nt,B as at,C as ot}from"./index-68fGHNun.js";import{c as Fe,o as D,w as $e,h as Ee,i as rt,u as st,A as oe,a as de,s as lt,N as ve,b as V,v as ut,d as ge,_ as Re,O as it,e as ct,f as dt,g as ft,r as k,j as Ue,m as L,k as ie,l as pt,n as mt,p as vt,q as he,t as gt,x as be,y as ht,z as bt,B as wt,C as we,I as xt,D as xe,E as yt,F as It,G as _t,P as Mt,H as St}from"./meshes-THav4CLT.js";function Dt(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function Pt(){return/Android/gi.test(window.navigator.userAgent)}function kt(){return Dt()||Pt()}function te(e,l,t){Fe.isServer||ae(r=>{document.addEventListener(e,l,t),r(()=>document.removeEventListener(e,l,t))})}function Vt(e,l,t){Fe.isServer||ae(r=>{window.addEventListener(e,l,t),r(()=>window.removeEventListener(e,l,t))})}function Ft(e,l,t=B(()=>!0)){function r(a,n){if(!t.value||a.defaultPrevented)return;let o=n(a);if(o===null||!o.getRootNode().contains(o))return;let d=function g(m){return typeof m=="function"?g(m()):Array.isArray(m)||m instanceof Set?m:[m]}(e);for(let g of d){if(g===null)continue;let m=g instanceof HTMLElement?g:D(g);if(m!=null&&m.contains(o)||a.composed&&a.composedPath().includes(m))return}return!$e(o,Ee.Loose)&&o.tabIndex!==-1&&a.preventDefault(),l(a,o)}let i=E(null);te("pointerdown",a=>{var n,o;t.value&&(i.value=((o=(n=a.composedPath)==null?void 0:n.call(a))==null?void 0:o[0])||a.target)},!0),te("mousedown",a=>{var n,o;t.value&&(i.value=((o=(n=a.composedPath)==null?void 0:n.call(a))==null?void 0:o[0])||a.target)},!0),te("click",a=>{kt()||i.value&&(r(a,()=>i.value),i.value=null)},!0),te("touchend",a=>r(a,()=>a.target instanceof HTMLElement?a.target:null),!0),Vt("blur",a=>r(a,()=>window.document.activeElement instanceof HTMLIFrameElement?window.document.activeElement:null),!0)}function ye(e){return[e.screenX,e.screenY]}function $t(){let e=E([-1,-1]);return{wasMoved(l){let t=ye(l);return e.value[0]===t[0]&&e.value[1]===t[1]?!1:(e.value=t,!0)},update(l){e.value=ye(l)}}}function Et({container:e,accept:l,walk:t,enabled:r}){ae(()=>{let i=e.value;if(!i||r!==void 0&&!r.value)return;let a=rt(e);if(!a)return;let n=Object.assign(d=>l(d),{acceptNode:l}),o=a.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,n,!1);for(;o.nextNode();)t(o.currentNode)})}let Ce=Symbol("Context");var X=(e=>(e[e.Open=1]="Open",e[e.Closed=2]="Closed",e[e.Closing=4]="Closing",e[e.Opening=8]="Opening",e))(X||{});function Rt(){return Pe(Ce,null)}function Ut(e){ke(Ce,e)}function Ct(e){throw new Error("Unexpected object: "+e)}var U=(e=>(e[e.First=0]="First",e[e.Previous=1]="Previous",e[e.Next=2]="Next",e[e.Last=3]="Last",e[e.Specific=4]="Specific",e[e.Nothing=5]="Nothing",e))(U||{});function Tt(e,l){let t=l.resolveItems();if(t.length<=0)return null;let r=l.resolveActiveIndex(),i=r??-1;switch(e.focus){case 0:{for(let a=0;a<t.length;++a)if(!l.resolveDisabled(t[a],a,t))return a;return r}case 1:{i===-1&&(i=t.length);for(let a=i-1;a>=0;--a)if(!l.resolveDisabled(t[a],a,t))return a;return r}case 2:{for(let a=i+1;a<t.length;++a)if(!l.resolveDisabled(t[a],a,t))return a;return r}case 3:{for(let a=t.length-1;a>=0;--a)if(!l.resolveDisabled(t[a],a,t))return a;return r}case 4:{for(let a=0;a<t.length;++a)if(l.resolveId(t[a],a,t)===e.id)return a;return r}case 5:return null;default:Ct(e)}}let Ie=/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g;function _e(e){var l,t;let r=(l=e.innerText)!=null?l:"",i=e.cloneNode(!0);if(!(i instanceof HTMLElement))return r;let a=!1;for(let o of i.querySelectorAll('[hidden],[aria-hidden],[role="img"]'))o.remove(),a=!0;let n=a?(t=i.innerText)!=null?t:"":r;return Ie.test(n)&&(n=n.replace(Ie,"")),n}function At(e){let l=e.getAttribute("aria-label");if(typeof l=="string")return l.trim();let t=e.getAttribute("aria-labelledby");if(t){let r=t.split(" ").map(i=>{let a=document.getElementById(i);if(a){let n=a.getAttribute("aria-label");return typeof n=="string"?n.trim():_e(a).trim()}return null}).filter(Boolean);if(r.length>0)return r.join(", ")}return _e(e).trim()}function Bt(e){let l=E(""),t=E("");return()=>{let r=D(e);if(!r)return"";let i=r.innerText;if(l.value===i)return t.value;let a=At(r).trim().toLowerCase();return l.value=i,t.value=a,a}}var Ot=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ot||{}),Lt=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(Lt||{});function Nt(e){requestAnimationFrame(()=>requestAnimationFrame(e))}let Te=Symbol("MenuContext");function re(e){let l=Pe(Te,null);if(l===null){let t=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,re),t}return l}let Gt=N({name:"Menu",props:{as:{type:[Object,String],default:"template"}},setup(e,{slots:l,attrs:t}){let r=E(1),i=E(null),a=E(null),n=E([]),o=E(""),d=E(null),g=E(1);function m(s=w=>w){let w=d.value!==null?n.value[d.value]:null,p=it(s(n.value.slice()),y=>D(y.dataRef.domRef)),_=w?p.indexOf(w):null;return _===-1&&(_=null),{items:p,activeItemIndex:_}}let v={menuState:r,buttonRef:i,itemsRef:a,items:n,searchQuery:o,activeItemIndex:d,activationTrigger:g,closeMenu:()=>{r.value=1,d.value=null},openMenu:()=>r.value=0,goToItem(s,w,p){let _=m(),y=Tt(s===U.Specific?{focus:U.Specific,id:w}:{focus:s},{resolveItems:()=>_.items,resolveActiveIndex:()=>_.activeItemIndex,resolveId:h=>h.id,resolveDisabled:h=>h.dataRef.disabled});o.value="",d.value=y,g.value=p??1,n.value=_.items},search(s){let w=o.value!==""?0:1;o.value+=s.toLowerCase();let p=(d.value!==null?n.value.slice(d.value+w).concat(n.value.slice(0,d.value+w)):n.value).find(y=>y.dataRef.textValue.startsWith(o.value)&&!y.dataRef.disabled),_=p?n.value.indexOf(p):-1;_===-1||_===d.value||(d.value=_,g.value=1)},clearSearch(){o.value=""},registerItem(s,w){let p=m(_=>[..._,{id:s,dataRef:w}]);n.value=p.items,d.value=p.activeItemIndex,g.value=1},unregisterItem(s){let w=m(p=>{let _=p.findIndex(y=>y.id===s);return _!==-1&&p.splice(_,1),p});n.value=w.items,d.value=w.activeItemIndex,g.value=1}};return Ft([i,a],(s,w)=>{var p;v.closeMenu(),$e(w,Ee.Loose)||(s.preventDefault(),(p=D(i))==null||p.focus())},B(()=>r.value===0)),ke(Te,v),Ut(B(()=>st(r.value,{0:X.Open,1:X.Closed}))),()=>{let s={open:r.value===0,close:v.closeMenu};return oe({ourProps:{},theirProps:e,slot:s,slots:l,attrs:t,name:"Menu"})}}}),zt=N({name:"MenuButton",props:{disabled:{type:Boolean,default:!1},as:{type:[Object,String],default:"button"},id:{type:String,default:null}},setup(e,{attrs:l,slots:t,expose:r}){var i;let a=(i=e.id)!=null?i:`headlessui-menu-button-${de()}`,n=re("MenuButton");r({el:n.buttonRef,$el:n.buttonRef});function o(v){switch(v.key){case V.Space:case V.Enter:case V.ArrowDown:v.preventDefault(),v.stopPropagation(),n.openMenu(),K(()=>{var s;(s=D(n.itemsRef))==null||s.focus({preventScroll:!0}),n.goToItem(U.First)});break;case V.ArrowUp:v.preventDefault(),v.stopPropagation(),n.openMenu(),K(()=>{var s;(s=D(n.itemsRef))==null||s.focus({preventScroll:!0}),n.goToItem(U.Last)});break}}function d(v){switch(v.key){case V.Space:v.preventDefault();break}}function g(v){e.disabled||(n.menuState.value===0?(n.closeMenu(),K(()=>{var s;return(s=D(n.buttonRef))==null?void 0:s.focus({preventScroll:!0})})):(v.preventDefault(),n.openMenu(),Nt(()=>{var s;return(s=D(n.itemsRef))==null?void 0:s.focus({preventScroll:!0})})))}let m=lt(B(()=>({as:e.as,type:l.type})),n.buttonRef);return()=>{var v;let s={open:n.menuState.value===0},{...w}=e,p={ref:n.buttonRef,id:a,type:m.value,"aria-haspopup":"menu","aria-controls":(v=D(n.itemsRef))==null?void 0:v.id,"aria-expanded":n.menuState.value===0,onKeydown:o,onKeyup:d,onClick:g};return oe({ourProps:p,theirProps:w,slot:s,attrs:l,slots:t,name:"MenuButton"})}}}),qt=N({name:"MenuItems",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null}},setup(e,{attrs:l,slots:t,expose:r}){var i;let a=(i=e.id)!=null?i:`headlessui-menu-items-${de()}`,n=re("MenuItems"),o=E(null);r({el:n.itemsRef,$el:n.itemsRef}),Et({container:B(()=>D(n.itemsRef)),enabled:B(()=>n.menuState.value===0),accept(s){return s.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:s.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(s){s.setAttribute("role","none")}});function d(s){var w;switch(o.value&&clearTimeout(o.value),s.key){case V.Space:if(n.searchQuery.value!=="")return s.preventDefault(),s.stopPropagation(),n.search(s.key);case V.Enter:if(s.preventDefault(),s.stopPropagation(),n.activeItemIndex.value!==null){let p=n.items.value[n.activeItemIndex.value];(w=D(p.dataRef.domRef))==null||w.click()}n.closeMenu(),Re(D(n.buttonRef));break;case V.ArrowDown:return s.preventDefault(),s.stopPropagation(),n.goToItem(U.Next);case V.ArrowUp:return s.preventDefault(),s.stopPropagation(),n.goToItem(U.Previous);case V.Home:case V.PageUp:return s.preventDefault(),s.stopPropagation(),n.goToItem(U.First);case V.End:case V.PageDown:return s.preventDefault(),s.stopPropagation(),n.goToItem(U.Last);case V.Escape:s.preventDefault(),s.stopPropagation(),n.closeMenu(),K(()=>{var p;return(p=D(n.buttonRef))==null?void 0:p.focus({preventScroll:!0})});break;case V.Tab:s.preventDefault(),s.stopPropagation(),n.closeMenu(),K(()=>ut(D(n.buttonRef),s.shiftKey?ge.Previous:ge.Next));break;default:s.key.length===1&&(n.search(s.key),o.value=setTimeout(()=>n.clearSearch(),350));break}}function g(s){switch(s.key){case V.Space:s.preventDefault();break}}let m=Rt(),v=B(()=>m!==null?(m.value&X.Open)===X.Open:n.menuState.value===0);return()=>{var s,w;let p={open:n.menuState.value===0},{..._}=e,y={"aria-activedescendant":n.activeItemIndex.value===null||(s=n.items.value[n.activeItemIndex.value])==null?void 0:s.id,"aria-labelledby":(w=D(n.buttonRef))==null?void 0:w.id,id:a,onKeydown:d,onKeyup:g,role:"menu",tabIndex:0,ref:n.itemsRef};return oe({ourProps:y,theirProps:_,slot:p,attrs:l,slots:t,features:ve.RenderStrategy|ve.Static,visible:v.value,name:"MenuItems"})}}}),Kt=N({name:"MenuItem",inheritAttrs:!1,props:{as:{type:[Object,String],default:"template"},disabled:{type:Boolean,default:!1},id:{type:String,default:null}},setup(e,{slots:l,attrs:t,expose:r}){var i;let a=(i=e.id)!=null?i:`headlessui-menu-item-${de()}`,n=re("MenuItem"),o=E(null);r({el:o,$el:o});let d=B(()=>n.activeItemIndex.value!==null?n.items.value[n.activeItemIndex.value].id===a:!1),g=Bt(o),m=B(()=>({disabled:e.disabled,get textValue(){return g()},domRef:o}));He(()=>n.registerItem(a,m)),Ye(()=>n.unregisterItem(a)),ae(()=>{n.menuState.value===0&&d.value&&n.activationTrigger.value!==0&&K(()=>{var h,G;return(G=(h=D(o))==null?void 0:h.scrollIntoView)==null?void 0:G.call(h,{block:"nearest"})})});function v(h){if(e.disabled)return h.preventDefault();n.closeMenu(),Re(D(n.buttonRef))}function s(){if(e.disabled)return n.goToItem(U.Nothing);n.goToItem(U.Specific,a)}let w=$t();function p(h){w.update(h)}function _(h){w.wasMoved(h)&&(e.disabled||d.value||n.goToItem(U.Specific,a,0))}function y(h){w.wasMoved(h)&&(e.disabled||d.value&&n.goToItem(U.Nothing))}return()=>{let{disabled:h,...G}=e,se={active:d.value,disabled:h,close:n.closeMenu};return oe({ourProps:{id:a,ref:o,role:"menuitem",tabIndex:h===!0?void 0:-1,"aria-disabled":h===!0?!0:void 0,onClick:v,onFocus:s,onPointerenter:p,onMouseenter:p,onPointermove:_,onMousemove:_,onPointerleave:y,onMouseleave:y},theirProps:{...t,...G},slot:se,attrs:t,slots:l,name:"MenuItem"})}}});const Zt=e=>l=>l.map(e),jt=e=>e.length,Ht=e=>Math.min(...e),Yt=e=>Ht(e.map(jt)),Wt=e=>(...l)=>Array.from({length:Yt(l)},(t,r)=>e(...l.map(i=>i[r]))),Xt=Wt,Ae=Xt,Qt=Ae(dt),Jt=Ae(ft),en=e=>(l,t)=>Zt(r=>e(r,t))(l),Me=en(ct);function tn(e,l){return T(),A("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[M("path",{d:"M3.53 2.47a.75.75 0 0 0-1.06 1.06l18 18a.75.75 0 1 0 1.06-1.06l-18-18ZM22.676 12.553a11.249 11.249 0 0 1-2.631 4.31l-3.099-3.099a5.25 5.25 0 0 0-6.71-6.71L7.759 4.577a11.217 11.217 0 0 1 4.242-.827c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113Z"}),M("path",{d:"M15.75 12c0 .18-.013.357-.037.53l-4.244-4.243A3.75 3.75 0 0 1 15.75 12ZM12.53 15.713l-4.243-4.244a3.75 3.75 0 0 0 4.244 4.243Z"}),M("path",{d:"M6.75 12c0-.619.107-1.213.304-1.764l-3.1-3.1a11.25 11.25 0 0 0-2.63 4.31c-.12.362-.12.752 0 1.114 1.489 4.467 5.704 7.69 10.675 7.69 1.5 0 2.933-.294 4.242-.827l-2.477-2.477A5.25 5.25 0 0 1 6.75 12Z"})])}function nn(e,l){return T(),A("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[M("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),M("path",{"fill-rule":"evenodd",d:"M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z","clip-rule":"evenodd"})])}const an=N({__name:"ToggleVisibleButton",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:l}){const i=Ve(e,"modelValue",l),a=()=>{i.value=!i.value};return(n,o)=>(T(),A("button",{class:"rounded-lg p-2",type:"button",onClick:o[0]||(o[0]=d=>a())},[S(I(tn),{class:me(["w-5 h-5",[I(i)?"hidden":"visible"]])},null,8,["class"]),S(I(nn),{class:me(["w-5 h-5",[I(i)?"visible":"hidden"]])},null,8,["class"])]))}}),on=["onUpdate:modelValue"],rn=["onUpdate:modelValue"],sn=N({__name:"ExtentInput",props:{modelValue:{}},emits:["update:modelValue"],setup(e,{emit:l}){const i=Ve(e,"modelValue",l),a=(d,g)=>{i.value=[i.value[0].map((m,v)=>g==v?d[0]:m),i.value[1].map((m,v)=>g==v?d[1]:m)]},n=B(()=>k(0,i.value[0].length)),o=[{name:"-1, +1",value:[-1,1]},{name:"-π, +π",value:[-Math.PI,+Math.PI]},{name:"-π/2, +π/2",value:[-Math.PI/2,+Math.PI/2]}];return(d,g)=>(T(!0),A(H,null,ne(n.value,m=>(T(),A("div",{class:"flex flex-row items-center gap-2",key:m},[S(I(Gt),{as:"div",class:"relative inline-block text-left"},{default:C(()=>[S(I(zt),{class:"w-16 text-xs text-right font-mono"},{default:C(()=>[j("x["+q(m)+"]:",1)]),_:2},1024),S(I(qt),{class:"absolute left-0 mt-2 w-32 origin-top-left divide-y divide-border bg-background-mute shadow-lg ring-1 ring-border-hover focus:outline-none z-50"},{default:C(()=>[(T(),A(H,null,ne(o,v=>S(I(Kt),{as:"div",class:"menu-item text-center",onClick:s=>a(v.value,m)},{default:C(()=>[j(q(v.name),1)]),_:2},1032,["onClick"])),64))]),_:2},1024)]),_:2},1024),Y(M("input",{class:"w-16",type:"number",step:"0.1","onUpdate:modelValue":v=>I(i)[0][m]=v},null,8,on),[[W,I(i)[0][m]]]),Y(M("input",{class:"w-16",type:"number",step:"0.1","onUpdate:modelValue":v=>I(i)[1][m]=v},null,8,rn),[[W,I(i)[1][m]]])]))),128))}}),ln=Ue(sn,[["__scopeId","data-v-52a8a7be"]]),un=(e,l)=>t=>Math.max(e,Math.min(t,l)),Se=un(-100,-.1);function cn(e,l){const t=We({isDown:!1,position:e??[-1,0,0],origin:[0,0,0]});let r;const i={wheel:o=>{o.preventDefault();const d=o.deltaY/100;t.position[0]=Se(t.position[0]+d)},pointerdown:o=>{t.isDown=!0,o.target.setPointerCapture(o.pointerId)},pointermove:o=>{if(!t.isDown)return;const d=o.target,g=[d.width,d.height],m=Math.min(...g),v=[+o.movementX*4/m,+o.movementY*4/m,0];if(o.altKey||o.metaKey){const s=-t.position[0]/4.8;t.origin[0]+=v[0]*s,t.origin[1]-=v[1]*s}else t.position[1]+=v[0],t.position[2]+=v[1]},pointerup:o=>{t.isDown=!1},touchstart:o=>{o.preventDefault()},touchmove:o=>{if(o.preventDefault(),o.targetTouches.length===2){const d=o.targetTouches[0],g=o.targetTouches[1];let m=Math.hypot(d.pageX-g.pageX,d.pageY-g.pageY);r===void 0&&(r=m);const v=m/r;t.position[0]=Se(t.position[0]*v)}},touchend:o=>{o.preventDefault(),r=void 0}},a=o=>(L.identity(o),L.translate(o,[0,0,t.position[0]],o),L.rotateY(o,t.position[2],o),L.rotateZ(o,t.position[1],o),L.translate(o,t.origin,o),o),n=B(()=>a(L.create()));return{listeners:i,transform:n,transformInplace:a}}const dn=()=>`
const PI = radians(180.0);
const TAU = radians(360.0);

fn cosk(k: f32, x: f32) -> f32 {
  if (k > 0.0) {
    let rk = sqrt(k);
    return cos(rk*x);
  }
  if (k < 0.0) {
    let rk = sqrt(-k);
    return cosh(rk*x);
  }
  return 1.0;
}

fn sink(k: f32, x: f32) -> f32 {
  if (k > 0.0) {
    let rk = sqrt(k);
    return sin(rk*x)/rk;
  }
  if (k < 0.0) {
    let rk = sqrt(-k);
    return sinh(rk*x)/rk;
  }
  return x;
}

alias vec1f = array<f32, 1>;
`,fn=e=>pt(e.map(l=>mt(-1,1,l))),pn=e=>{const l=e.length,t=vt(e);switch(l){case 1:return k(0,e[0]-1).map(i=>[(i+0)*t[0],(i+1)*t[0]]);case 2:{const r=k(0,e[0]).flatMap(a=>k(0,e[1]-1).map(n=>[a*t[0]+(n+0)*t[1],a*t[0]+(n+1)*t[1]])),i=k(0,e[1]).flatMap(a=>k(0,e[0]-1).map(n=>[(n+0)*t[0]+a*t[1],(n+1)*t[0]+a*t[1]]));return he(r,i)}case 3:{const r=k(0,e[0]).flatMap(n=>k(0,e[1]).flatMap(o=>k(0,e[2]-1).map(d=>[n*t[0]+o*t[1]+(d+0)*t[2],n*t[0]+o*t[1]+(d+1)*t[2]]))),i=k(0,e[0]).flatMap(n=>k(0,e[2]).flatMap(o=>k(0,e[1]-1).map(d=>[n*t[0]+(d+0)*t[1]+o*t[2],n*t[0]+(d+1)*t[1]+o*t[2]]))),a=k(0,e[1]).flatMap(n=>k(0,e[2]).flatMap(o=>k(0,e[0]-1).map(d=>[(d+0)*t[0]+n*t[1]+o*t[2],(d+1)*t[0]+n*t[1]+o*t[2]])));return he(r,i,a)}}return[]},mn=e=>{const l=fn(e).map(i=>[1,i[0]??0,i[1]??0,i[2]??0]),t=ie([1,1,1,1],l.length),r=pn(e);return{position:{data:l.flat(1),type:Float32Array,numComponents:4},color:{data:t.flat(1),type:Float32Array,numComponents:4},indices:{data:r.flat(1),type:Uint32Array}}},vn=e=>{const l=/@plot\s+fn\s+(?<name>\w+)\s*\(\w+:\s*(?<domain>\w+)\)\s*->\s*(?<codomain>\w+)/g,t=[];let r;do r=l.exec(e),r&&r.groups&&t.push({name:r.groups.name,domain:{name:r.groups.domain},codomain:{name:r.groups.codomain}});while(r);return{functions:t}},ce=e=>{switch(e.name){case"vec1f":return 1;case"vec2f":return 2;case"vec3f":return 3;case"vec4f":return 4}return 0},De=e=>[ce(e.domain),ce(e.codomain)],gn=`@plot
fn f(x: vec2f) -> vec3f {
  return vec3f(x[0], x[1], sin(x[0])*cos(x[1]));
}`,fe=e=>(at("data-v-944d3a7a"),e=e(),ot(),e),hn={class:"flex flex-row items-center h-12 p-1 border-b-2 border-border"},bn=fe(()=>M("h1",{class:"px-2"},"Parametric Surface",-1)),wn=fe(()=>M("span",{class:"flex-grow"},null,-1)),xn={class:"flex flex-row items-center justify-center overflow-hidden show-focus-within"},yn={class:"flex flex-col p-2"},In=fe(()=>M("summary",{class:"flex flex-row items-center gap-2 my-1"},[M("h2",null,"Global")],-1)),_n={class:"w-16 text-xs text-right font-mono"},Mn=["onUpdate:modelValue"],Sn=["onUpdate:modelValue"],Dn={class:"flex flex-row items-center gap-2 my-1"},Pn=["onUpdate:modelValue"],kn={class:"flex-grow"},Vn={class:"text-text text-base"},Fn=`
struct GlobalData {
  projection: mat4x4f,
  view: mat4x4f,
  args: vec4f,
  time: f32,
}
`,$n=`
struct SurfaceData {
  model: mat4x4f,
  color: vec4f,
}
`,En=N({__name:"ParametricSurfaceView",setup(e){const t=E({source:gn,options:{args:[0,0,0,0],functions:[]}}),r=Xe(t),i=`
${Fn}
${$n}

@group(0) @binding(0) var<uniform> uGlobal: GlobalData;
@group(0) @binding(1) var<uniform> uSurface: SurfaceData;
`,a=(u,[c,f])=>{const b=x=>{switch(x){case 1:return"vec1f(position.y)";case 2:return"position.yz";case 3:return"position.yzw";default:return"0.0"}};return`fn surface(position: vec4f) -> vec4f {
  return ${(x=>$=>{switch(x){case 1:return`vec4(1.0, ${$}[0], 0.0, 0.0)`;case 2:return`vec4(1.0, ${$}, 0.0)`;case 3:return`vec4(1.0, ${$})`;default:return"vec4(1.0, 0.0, 0.0, 0.0)"}})(f)(`${u}(${b(c)})`)};
}`},n=(u,c)=>`
${dn()}

struct VertexIn {
  @location(0) position: vec4f,
  @location(1) color: vec4f,
}

struct FragmentIn {
  @builtin(position) position: vec4f,
  @location(0) color: vec4f,
}

struct VaryingData {
  position: vec4f,
  color: vec4f,
}

${i}

${u}

${c}

fn fromVertexIn(in: VertexIn) -> VaryingData {
  return VaryingData(
    uGlobal.view * surface(uSurface.model * in.position),
    uSurface.color * in.color,
  );
}

fn toFragmentIn(in: VaryingData) -> FragmentIn {
  return FragmentIn(
    uGlobal.projection * in.position.yzwx,
    in.color,
  );
}

@vertex
fn vertexMain(in: VertexIn) -> FragmentIn {
  return toFragmentIn(fromVertexIn(in));
}

@fragment
fn fragmentMain(in: FragmentIn) -> @location(0) vec4f {
  return in.color;
}
`,o=E(null),d=gt(i),g=be(d.uniforms.uGlobal);g.set({projection:L.perspective(Math.PI/4,1920/1080,.1,1e3),view:L.translation([0,0,-3]),args:[0,0,0,0]});const m={},v={alphaMode:"premultiplied",size:[1920,1080],autoResize:!1},s=u=>{const c={state:null,valid:!1,onCreate(f){console.log("Resource::onCreate"),!c.state&&(c.state=u.create(f))},onUpdate(f){var b,F;c.valid||((b=c.onDelete)==null||b.call(c,f),(F=c.onCreate)==null||F.call(c,f),c.valid=!0)},onDelete(f){console.log("Resource::onDelete"),c.state&&(u.delete(f,c.state),c.state=null)}};return c},w=u=>[[],[Math.pow(u,3*2)],[Math.pow(u,3),Math.pow(u,3)],[Math.pow(u,2),Math.pow(u,2),Math.pow(u,2)]],p=s({create({device:u}){return w(3).map(mn).map(f=>({vertices:_t(u,f,{shaderLocation:0,stepMode:"vertex",interleave:!0}),topology:1}))},delete({device:u},c){}}),_=u=>{const c=Me(Qt(u[0],u[1]),2),f=Me(Jt(u[0],u[1]),2);return L.st(f,c)},y=s({create({device:u,format:c}){return{uniforms:u.createBuffer({size:g.arrayBuffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})}},delete({device:u},c){}}),h=s({create({device:u,format:c}){if(!y.state||!p.state||!o.value)return null;const{source:f,info:b}=o.value;return b.functions.map((F,x)=>{const[$,O]=De(F),R=u.createShaderModule({code:n(f,a(F.name,[$,O]))}),{uniforms:P}=y.state,{vertices:Q}=p.state[$],Z=u.createRenderPipeline({layout:"auto",vertex:{module:R,entryPoint:"vertexMain",buffers:Q.bufferLayouts},fragment:{module:R,entryPoint:"fragmentMain",targets:[{format:c}]},primitive:{topology:Mt[1]}});m[x]=be(d.uniforms.uSurface);const J=u.createBuffer({size:m[x].arrayBuffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),z=u.createBindGroup({layout:Z.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:P}},{binding:1,resource:{buffer:J}}]});return{pipeline:Z,bindGroup:z,uniforms:J}})},delete({device:u},c){}}),{listeners:G,transformInplace:se}=cn([-4,0,0]),Be={onCreate(u){var c,f,b;console.log("ParametricSurfaceView::onCreate"),(c=y.onUpdate)==null||c.call(y,u),y.state&&((f=p.onUpdate)==null||f.call(p,u),p.state&&((b=h.onUpdate)==null||b.call(h,u),h.state))},onRender(u){var P,Q,Z;const{device:c,context:f,timestamp:b}=u;if((P=y.onUpdate)==null||P.call(y,u),!y.state||((Q=p.onUpdate)==null||Q.call(p,u),!p.state)||((Z=h.onUpdate)==null||Z.call(h,u),!h.state))return;const F=c.createCommandEncoder(),x=F.beginRenderPass({colorAttachments:[{clearValue:Float32Array.of(0,0,0,0),loadOp:"clear",storeOp:"store",view:f.getCurrentTexture().createView()}]});if(!o.value)return null;const{info:$}=o.value,{uniforms:O}=y.state;g.set({args:r.options.args,time:b/1e3}),se(g.views.view),c.queue.writeBuffer(O,0,g.arrayBuffer),$.functions.forEach((J,z)=>{const[qe,Rn]=De(J),ue=r.options.functions[z];if(!ue.visible)return;const{vertices:ee}=p.state[qe],{pipeline:Ke,bindGroup:Ze,uniforms:je}=h.state[z];m[z].set({model:_(ue.extent),color:St(ue.color).gl()}),c.queue.writeBuffer(je,0,m[z].arrayBuffer),x.setPipeline(Ke),x.setBindGroup(0,Ze),x.setVertexBuffer(0,ee.buffers[0]),x.setIndexBuffer(ee.indexBuffer,ee.indexFormat),x.drawIndexed(ee.numElements)}),x.end();const R=F.finish();c.queue.submit([R])},onDelete(u){var c,f,b;console.log("ParametricSurfaceView::Delete"),(c=h.onDelete)==null||c.call(h,u),(f=p.onDelete)==null||f.call(p,u),(b=y.onDelete)==null||b.call(y,u)}},Oe=u=>({source:u.replaceAll("@plot","/*@plot*/"),info:vn(u)}),Le=u=>{const c=ce(u.domain);return[ie(-1,c),ie(1,c)]},Ne=({info:u})=>({functions:u.functions.map(c=>({name:c.name,color:"#ffffff",extent:Le(c),visible:!0}))}),Ge=(u,c)=>{var f;return{args:u.args??c.args,functions:((f=u.functions)==null?void 0:f.map((b,F)=>{const x=c.functions[F];return{color:(x==null?void 0:x.color)??b.color,extent:[b.extent[0].map(($,O)=>{var R,P;return((P=(R=x==null?void 0:x.extent)==null?void 0:R[0])==null?void 0:P[O])??$}),b.extent[1].map(($,O)=>{var R,P;return((P=(R=x==null?void 0:x.extent)==null?void 0:R[1])==null?void 0:P[O])??$})],visible:(x==null?void 0:x.visible)??b.visible}}))??c.functions}},pe=u=>{const c=Oe(u.source);o.value=c,u.options=Ge(Ne(c),u.options),h.valid=!1},ze=u=>{switch(u.key){case"Enter":return u.shiftKey;case"s":case"S":return u.ctrlKey||u.metaKey;default:return!1}};Qe(document,"keydown",u=>{ze(u)&&(u.stopPropagation(),u.preventDefault(),pe(r))}),Je(t,pe,{immediate:!0});const le=u=>{var c,f,b;return(b=(f=(c=o.value)==null?void 0:c.info)==null?void 0:f.functions)==null?void 0:b[u]};return(u,c)=>(T(),A(H,null,[M("header",hn,[bn,wn,S(ht,{modelValue:t.value,"onUpdate:modelValue":c[0]||(c[0]=f=>t.value=f)},null,8,["modelValue"]),S(bt)]),S(I(It),{as:"main",class:"flex-grow flex flex-col overflow-hidden","default-index":2},{default:C(()=>[S(I(wt),{class:"flex flex-row md:hidden"},{default:C(()=>[S(I(we),{class:"tab"},{default:C(()=>[j("Input")]),_:1}),S(I(we),{class:"tab"},{default:C(()=>[j("Output")]),_:1})]),_:1}),S(I(xt),{class:"h-full md:grid md:grid-cols-2 border-y-2 border-border"},{default:C(()=>[S(I(xe),{class:"h-full ui-not-selected:hidden md:ui-not-selected:grid grid grid-rows-1 overflow-hidden",static:!0},{default:C(()=>[S(et,{modelValue:I(r).source,"onUpdate:modelValue":c[1]||(c[1]=f=>I(r).source=f)},null,8,["modelValue"])]),_:1}),S(I(xe),{class:"h-full ui-not-selected:hidden md:ui-not-selected:grid grid grid-rows-2 overflow-hidden",static:!0},{default:C(()=>[(T(),tt(nt,null,{default:C(()=>[M("div",xn,[S(yt,{renderer:Be,listeners:I(G),options:v},null,8,["listeners"])])]),_:1})),M("div",yn,[M("details",null,[In,(T(!0),A(H,null,ne(k(0,4),f=>(T(),A("div",{class:"flex flex-row items-center gap-2",key:f},[M("label",_n,"args["+q(f)+"]:",1),Y(M("input",{class:"w-16",type:"number",step:"0.1","onUpdate:modelValue":b=>I(r).options.args[f]=b},null,8,Mn),[[W,I(r).options.args[f]]]),Y(M("input",{class:"flex-grow",type:"range",min:"-1",max:"1",step:"0.01","onUpdate:modelValue":b=>I(r).options.args[f]=b},null,8,Sn),[[W,I(r).options.args[f]]])]))),128))]),(T(!0),A(H,null,ne(I(r).options.functions,(f,b)=>{var F,x,$,O,R;return T(),A("details",{key:b},[M("summary",Dn,[Y(M("input",{class:"w-8 h-8",name:"fill",type:"color","onUpdate:modelValue":P=>f.color=P},null,8,Pn),[[W,f.color]]),M("h2",kn,[j(q((F=le(b))==null?void 0:F.name)+": ",1),M("span",Vn,q(($=(x=le(b))==null?void 0:x.domain)==null?void 0:$.name)+" → "+q((R=(O=le(b))==null?void 0:O.codomain)==null?void 0:R.name),1)]),S(an,{modelValue:f.visible,"onUpdate:modelValue":P=>f.visible=P},null,8,["modelValue","onUpdate:modelValue"])]),S(ln,{modelValue:f.extent,"onUpdate:modelValue":P=>f.extent=P},null,8,["modelValue","onUpdate:modelValue"])])}),128))])]),_:1})]),_:1})]),_:1})],64))}}),Tn=Ue(En,[["__scopeId","data-v-944d3a7a"]]);export{Tn as default};
