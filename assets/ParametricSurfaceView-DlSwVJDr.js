import{w as ee,r as V,c as T,i as _e,p as De,d as N,o as Ke,a as Ze,n as q,b as B,e as L,f as k,u as Pe,g as _,h as pe,j as M,k as le,l as U,m as Z,t as j,F as J,q as se,v as ue,s as je,x as He,y as Ye,z as We,_ as Qe,A as Xe,S as Je}from"./index-ByeIlVLP.js";import{c as ke,o as D,w as Fe,h as $e,i as et,u as tt,A as te,a as de,s as nt,N as me,b as P,v as at,d as ve,_ as Ve,O as ot,e as rt,f as lt,g as st,r as $,m as O,j as ie,k as ut,l as it,n as ct,p as ge,q as dt,t as be,x as ft,y as pt,z as mt,B as he,I as vt,C as we,D as gt,E as bt,F as ht,P as wt,G as xt}from"./meshes-BCo1InXi.js";function yt(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function It(){return/Android/gi.test(window.navigator.userAgent)}function Mt(){return yt()||It()}function X(e,l,n){ke.isServer||ee(o=>{document.addEventListener(e,l,n),o(()=>document.removeEventListener(e,l,n))})}function St(e,l,n){ke.isServer||ee(o=>{window.addEventListener(e,l,n),o(()=>window.removeEventListener(e,l,n))})}function _t(e,l,n=T(()=>!0)){function o(a,t){if(!n.value||a.defaultPrevented)return;let i=t(a);if(i===null||!i.getRootNode().contains(i))return;let f=function b(p){return typeof p=="function"?b(p()):Array.isArray(p)||p instanceof Set?p:[p]}(e);for(let b of f){if(b===null)continue;let p=b instanceof HTMLElement?b:D(b);if(p!=null&&p.contains(i)||a.composed&&a.composedPath().includes(p))return}return!Fe(i,$e.Loose)&&i.tabIndex!==-1&&a.preventDefault(),l(a,i)}let r=V(null);X("pointerdown",a=>{var t,i;n.value&&(r.value=((i=(t=a.composedPath)==null?void 0:t.call(a))==null?void 0:i[0])||a.target)},!0),X("mousedown",a=>{var t,i;n.value&&(r.value=((i=(t=a.composedPath)==null?void 0:t.call(a))==null?void 0:i[0])||a.target)},!0),X("click",a=>{Mt()||r.value&&(o(a,()=>r.value),r.value=null)},!0),X("touchend",a=>o(a,()=>a.target instanceof HTMLElement?a.target:null),!0),St("blur",a=>o(a,()=>window.document.activeElement instanceof HTMLIFrameElement?window.document.activeElement:null),!0)}function xe(e){return[e.screenX,e.screenY]}function Dt(){let e=V([-1,-1]);return{wasMoved(l){let n=xe(l);return e.value[0]===n[0]&&e.value[1]===n[1]?!1:(e.value=n,!0)},update(l){e.value=xe(l)}}}function Pt({container:e,accept:l,walk:n,enabled:o}){ee(()=>{let r=e.value;if(!r||o!==void 0&&!o.value)return;let a=et(e);if(!a)return;let t=Object.assign(f=>l(f),{acceptNode:l}),i=a.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,t,!1);for(;i.nextNode();)n(i.currentNode)})}let Ee=Symbol("Context");var H=(e=>(e[e.Open=1]="Open",e[e.Closed=2]="Closed",e[e.Closing=4]="Closing",e[e.Opening=8]="Opening",e))(H||{});function kt(){return _e(Ee,null)}function Ft(e){De(Ee,e)}function $t(e){throw new Error("Unexpected object: "+e)}var R=(e=>(e[e.First=0]="First",e[e.Previous=1]="Previous",e[e.Next=2]="Next",e[e.Last=3]="Last",e[e.Specific=4]="Specific",e[e.Nothing=5]="Nothing",e))(R||{});function Vt(e,l){let n=l.resolveItems();if(n.length<=0)return null;let o=l.resolveActiveIndex(),r=o??-1;switch(e.focus){case 0:{for(let a=0;a<n.length;++a)if(!l.resolveDisabled(n[a],a,n))return a;return o}case 1:{r===-1&&(r=n.length);for(let a=r-1;a>=0;--a)if(!l.resolveDisabled(n[a],a,n))return a;return o}case 2:{for(let a=r+1;a<n.length;++a)if(!l.resolveDisabled(n[a],a,n))return a;return o}case 3:{for(let a=n.length-1;a>=0;--a)if(!l.resolveDisabled(n[a],a,n))return a;return o}case 4:{for(let a=0;a<n.length;++a)if(l.resolveId(n[a],a,n)===e.id)return a;return o}case 5:return null;default:$t(e)}}let ye=/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g;function Ie(e){var l,n;let o=(l=e.innerText)!=null?l:"",r=e.cloneNode(!0);if(!(r instanceof HTMLElement))return o;let a=!1;for(let i of r.querySelectorAll('[hidden],[aria-hidden],[role="img"]'))i.remove(),a=!0;let t=a?(n=r.innerText)!=null?n:"":o;return ye.test(t)&&(t=t.replace(ye,"")),t}function Et(e){let l=e.getAttribute("aria-label");if(typeof l=="string")return l.trim();let n=e.getAttribute("aria-labelledby");if(n){let o=n.split(" ").map(r=>{let a=document.getElementById(r);if(a){let t=a.getAttribute("aria-label");return typeof t=="string"?t.trim():Ie(a).trim()}return null}).filter(Boolean);if(o.length>0)return o.join(", ")}return Ie(e).trim()}function Rt(e){let l=V(""),n=V("");return()=>{let o=D(e);if(!o)return"";let r=o.innerText;if(l.value===r)return n.value;let a=Et(o).trim().toLowerCase();return l.value=r,n.value=a,a}}var Ct=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ct||{}),Ut=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(Ut||{});function Tt(e){requestAnimationFrame(()=>requestAnimationFrame(e))}let Re=Symbol("MenuContext");function ne(e){let l=_e(Re,null);if(l===null){let n=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,ne),n}return l}let At=N({name:"Menu",props:{as:{type:[Object,String],default:"template"}},setup(e,{slots:l,attrs:n}){let o=V(1),r=V(null),a=V(null),t=V([]),i=V(""),f=V(null),b=V(1);function p(s=h=>h){let h=f.value!==null?t.value[f.value]:null,d=ot(s(t.value.slice()),w=>D(w.dataRef.domRef)),I=h?d.indexOf(h):null;return I===-1&&(I=null),{items:d,activeItemIndex:I}}let v={menuState:o,buttonRef:r,itemsRef:a,items:t,searchQuery:i,activeItemIndex:f,activationTrigger:b,closeMenu:()=>{o.value=1,f.value=null},openMenu:()=>o.value=0,goToItem(s,h,d){let I=p(),w=Vt(s===R.Specific?{focus:R.Specific,id:h}:{focus:s},{resolveItems:()=>I.items,resolveActiveIndex:()=>I.activeItemIndex,resolveId:g=>g.id,resolveDisabled:g=>g.dataRef.disabled});i.value="",f.value=w,b.value=d??1,t.value=I.items},search(s){let h=i.value!==""?0:1;i.value+=s.toLowerCase();let d=(f.value!==null?t.value.slice(f.value+h).concat(t.value.slice(0,f.value+h)):t.value).find(w=>w.dataRef.textValue.startsWith(i.value)&&!w.dataRef.disabled),I=d?t.value.indexOf(d):-1;I===-1||I===f.value||(f.value=I,b.value=1)},clearSearch(){i.value=""},registerItem(s,h){let d=p(I=>[...I,{id:s,dataRef:h}]);t.value=d.items,f.value=d.activeItemIndex,b.value=1},unregisterItem(s){let h=p(d=>{let I=d.findIndex(w=>w.id===s);return I!==-1&&d.splice(I,1),d});t.value=h.items,f.value=h.activeItemIndex,b.value=1}};return _t([r,a],(s,h)=>{var d;v.closeMenu(),Fe(h,$e.Loose)||(s.preventDefault(),(d=D(r))==null||d.focus())},T(()=>o.value===0)),De(Re,v),Ft(T(()=>tt(o.value,{0:H.Open,1:H.Closed}))),()=>{let s={open:o.value===0,close:v.closeMenu};return te({ourProps:{},theirProps:e,slot:s,slots:l,attrs:n,name:"Menu"})}}}),Bt=N({name:"MenuButton",props:{disabled:{type:Boolean,default:!1},as:{type:[Object,String],default:"button"},id:{type:String,default:null}},setup(e,{attrs:l,slots:n,expose:o}){var r;let a=(r=e.id)!=null?r:`headlessui-menu-button-${de()}`,t=ne("MenuButton");o({el:t.buttonRef,$el:t.buttonRef});function i(v){switch(v.key){case P.Space:case P.Enter:case P.ArrowDown:v.preventDefault(),v.stopPropagation(),t.openMenu(),q(()=>{var s;(s=D(t.itemsRef))==null||s.focus({preventScroll:!0}),t.goToItem(R.First)});break;case P.ArrowUp:v.preventDefault(),v.stopPropagation(),t.openMenu(),q(()=>{var s;(s=D(t.itemsRef))==null||s.focus({preventScroll:!0}),t.goToItem(R.Last)});break}}function f(v){switch(v.key){case P.Space:v.preventDefault();break}}function b(v){e.disabled||(t.menuState.value===0?(t.closeMenu(),q(()=>{var s;return(s=D(t.buttonRef))==null?void 0:s.focus({preventScroll:!0})})):(v.preventDefault(),t.openMenu(),Tt(()=>{var s;return(s=D(t.itemsRef))==null?void 0:s.focus({preventScroll:!0})})))}let p=nt(T(()=>({as:e.as,type:l.type})),t.buttonRef);return()=>{var v;let s={open:t.menuState.value===0},{...h}=e,d={ref:t.buttonRef,id:a,type:p.value,"aria-haspopup":"menu","aria-controls":(v=D(t.itemsRef))==null?void 0:v.id,"aria-expanded":t.menuState.value===0,onKeydown:i,onKeyup:f,onClick:b};return te({ourProps:d,theirProps:h,slot:s,attrs:l,slots:n,name:"MenuButton"})}}}),Ot=N({name:"MenuItems",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null}},setup(e,{attrs:l,slots:n,expose:o}){var r;let a=(r=e.id)!=null?r:`headlessui-menu-items-${de()}`,t=ne("MenuItems"),i=V(null);o({el:t.itemsRef,$el:t.itemsRef}),Pt({container:T(()=>D(t.itemsRef)),enabled:T(()=>t.menuState.value===0),accept(s){return s.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:s.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(s){s.setAttribute("role","none")}});function f(s){var h;switch(i.value&&clearTimeout(i.value),s.key){case P.Space:if(t.searchQuery.value!=="")return s.preventDefault(),s.stopPropagation(),t.search(s.key);case P.Enter:if(s.preventDefault(),s.stopPropagation(),t.activeItemIndex.value!==null){let d=t.items.value[t.activeItemIndex.value];(h=D(d.dataRef.domRef))==null||h.click()}t.closeMenu(),Ve(D(t.buttonRef));break;case P.ArrowDown:return s.preventDefault(),s.stopPropagation(),t.goToItem(R.Next);case P.ArrowUp:return s.preventDefault(),s.stopPropagation(),t.goToItem(R.Previous);case P.Home:case P.PageUp:return s.preventDefault(),s.stopPropagation(),t.goToItem(R.First);case P.End:case P.PageDown:return s.preventDefault(),s.stopPropagation(),t.goToItem(R.Last);case P.Escape:s.preventDefault(),s.stopPropagation(),t.closeMenu(),q(()=>{var d;return(d=D(t.buttonRef))==null?void 0:d.focus({preventScroll:!0})});break;case P.Tab:s.preventDefault(),s.stopPropagation(),t.closeMenu(),q(()=>at(D(t.buttonRef),s.shiftKey?ve.Previous:ve.Next));break;default:s.key.length===1&&(t.search(s.key),i.value=setTimeout(()=>t.clearSearch(),350));break}}function b(s){switch(s.key){case P.Space:s.preventDefault();break}}let p=kt(),v=T(()=>p!==null?(p.value&H.Open)===H.Open:t.menuState.value===0);return()=>{var s,h;let d={open:t.menuState.value===0},{...I}=e,w={"aria-activedescendant":t.activeItemIndex.value===null||(s=t.items.value[t.activeItemIndex.value])==null?void 0:s.id,"aria-labelledby":(h=D(t.buttonRef))==null?void 0:h.id,id:a,onKeydown:f,onKeyup:b,role:"menu",tabIndex:0,ref:t.itemsRef};return te({ourProps:w,theirProps:I,slot:d,attrs:l,slots:n,features:me.RenderStrategy|me.Static,visible:v.value,name:"MenuItems"})}}}),Lt=N({name:"MenuItem",inheritAttrs:!1,props:{as:{type:[Object,String],default:"template"},disabled:{type:Boolean,default:!1},id:{type:String,default:null}},setup(e,{slots:l,attrs:n,expose:o}){var r;let a=(r=e.id)!=null?r:`headlessui-menu-item-${de()}`,t=ne("MenuItem"),i=V(null);o({el:i,$el:i});let f=T(()=>t.activeItemIndex.value!==null?t.items.value[t.activeItemIndex.value].id===a:!1),b=Rt(i),p=T(()=>({disabled:e.disabled,get textValue(){return b()},domRef:i}));Ke(()=>t.registerItem(a,p)),Ze(()=>t.unregisterItem(a)),ee(()=>{t.menuState.value===0&&f.value&&t.activationTrigger.value!==0&&q(()=>{var g,G;return(G=(g=D(i))==null?void 0:g.scrollIntoView)==null?void 0:G.call(g,{block:"nearest"})})});function v(g){if(e.disabled)return g.preventDefault();t.closeMenu(),Ve(D(t.buttonRef))}function s(){if(e.disabled)return t.goToItem(R.Nothing);t.goToItem(R.Specific,a)}let h=Dt();function d(g){h.update(g)}function I(g){h.wasMoved(g)&&(e.disabled||f.value||t.goToItem(R.Specific,a,0))}function w(g){h.wasMoved(g)&&(e.disabled||f.value&&t.goToItem(R.Nothing))}return()=>{let{disabled:g,...G}=e,ae={active:f.value,disabled:g,close:t.closeMenu};return te({ourProps:{id:a,ref:i,role:"menuitem",tabIndex:g===!0?void 0:-1,"aria-disabled":g===!0?!0:void 0,onClick:v,onFocus:s,onPointerenter:d,onMouseenter:d,onPointermove:I,onMousemove:I,onPointerleave:w,onMouseleave:w},theirProps:{...n,...G},slot:ae,attrs:n,slots:l,name:"MenuItem"})}}});const Nt=e=>l=>l.map(e),Gt=e=>e.length,zt=e=>Math.min(...e),qt=e=>zt(e.map(Gt)),Kt=e=>(...l)=>Array.from({length:qt(l)},(n,o)=>e(...l.map(r=>r[o]))),Zt=Kt,Ce=Zt,jt=Ce(lt),Ht=Ce(st),Yt=e=>(l,n)=>Nt(o=>e(o,n))(l),Me=Yt(rt);function Wt(e,l){return B(),L("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[k("path",{d:"M3.53 2.47a.75.75 0 0 0-1.06 1.06l18 18a.75.75 0 1 0 1.06-1.06l-18-18ZM22.676 12.553a11.249 11.249 0 0 1-2.631 4.31l-3.099-3.099a5.25 5.25 0 0 0-6.71-6.71L7.759 4.577a11.217 11.217 0 0 1 4.242-.827c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113Z"}),k("path",{d:"M15.75 12c0 .18-.013.357-.037.53l-4.244-4.243A3.75 3.75 0 0 1 15.75 12ZM12.53 15.713l-4.243-4.244a3.75 3.75 0 0 0 4.244 4.243Z"}),k("path",{d:"M6.75 12c0-.619.107-1.213.304-1.764l-3.1-3.1a11.25 11.25 0 0 0-2.63 4.31c-.12.362-.12.752 0 1.114 1.489 4.467 5.704 7.69 10.675 7.69 1.5 0 2.933-.294 4.242-.827l-2.477-2.477A5.25 5.25 0 0 1 6.75 12Z"})])}function Qt(e,l){return B(),L("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[k("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"}),k("path",{"fill-rule":"evenodd",d:"M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z","clip-rule":"evenodd"})])}const Xt=N({__name:"ToggleVisibleButton",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:l}){const r=Pe(e,"modelValue",l),a=()=>{r.value=!r.value};return(t,i)=>(B(),L("button",{class:"rounded-lg p-2",type:"button",onClick:i[0]||(i[0]=f=>a())},[_(M(Wt),{class:pe(["w-5 h-5",[M(r)?"hidden":"visible"]])},null,8,["class"]),_(M(Qt),{class:pe(["w-5 h-5",[M(r)?"visible":"hidden"]])},null,8,["class"])]))}}),Jt=["onUpdate:modelValue"],en=["onUpdate:modelValue"],tn=N({__name:"ExtentInput",props:{modelValue:{}},emits:["update:modelValue"],setup(e,{emit:l}){const r=Pe(e,"modelValue",l),a=(f,b)=>{r.value=[r.value[0].map((p,v)=>b==v?f[0]:p),r.value[1].map((p,v)=>b==v?f[1]:p)]},t=T(()=>$(0,r.value[0].length)),i=[{name:"-1, +1",value:[-1,1]},{name:"-π, +π",value:[-Math.PI,+Math.PI]},{name:"-π/2, +π/2",value:[-Math.PI/2,+Math.PI/2]}];return(f,b)=>(B(!0),L(J,null,le(t.value,p=>(B(),L("div",{class:"flex flex-row items-center gap-2",key:p},[_(M(At),{as:"div",class:"relative inline-block text-left"},{default:U(()=>[_(M(Bt),{class:"w-8 text-xs text-right font-mono"},{default:U(()=>[Z("x["+j(p)+"]:",1)]),_:2},1024),_(M(Ot),{class:"absolute left-0 mt-2 w-32 origin-top-left divide-y divide-border bg-background-mute shadow-lg ring-1 ring-border-hover focus:outline-none z-50"},{default:U(()=>[(B(),L(J,null,le(i,v=>_(M(Lt),{as:"div",class:"menu-item text-center",onClick:s=>a(v.value,p)},{default:U(()=>[Z(j(v.name),1)]),_:2},1032,["onClick"])),64))]),_:2},1024)]),_:2},1024),se(k("input",{class:"w-16",type:"number",step:"0.1","onUpdate:modelValue":v=>M(r)[0][p]=v},null,8,Jt),[[ue,M(r)[0][p]]]),se(k("input",{class:"w-16",type:"number",step:"0.1","onUpdate:modelValue":v=>M(r)[1][p]=v},null,8,en),[[ue,M(r)[1][p]]])]))),128))}}),nn=(e,l)=>{const n=e.__vccOpts||e;for(const[o,r]of l)n[o]=r;return n},an=nn(tn,[["__scopeId","data-v-e5099bb9"]]);function on(e,l){const n=je({isDown:!1,position:e??[-1,0,0],origin:[0,0,0]}),o={pointerdown:t=>{n.isDown=!0,t.target.setPointerCapture(t.pointerId)},pointermove:t=>{if(!n.isDown)return;const i=t.target,f=[i.width,i.height],b=Math.min(...f),p=[+t.movementX*4/b,+t.movementY*4/b,0];t.altKey||t.metaKey?(n.origin[0]+=p[0],n.origin[1]-=p[1]):(n.position[1]+=p[0],n.position[2]+=p[1])},pointerup:t=>{n.isDown=!1},wheel:t=>{const i=t.deltaY/100;n.position[0]+=i}},r=t=>(O.identity(t),O.translate(t,[0,0,n.position[0]],t),O.rotateY(t,n.position[2],t),O.rotateZ(t,n.position[1],t),O.translate(t,n.origin,t),t),a=T(()=>r(O.create()));return{listeners:o,transform:a,transformInplace:r}}const rn=()=>`
const PI = radians(180.0);
const TAU = radians(360.0);

fn cosk(k: f32, x: f32) -> f32 {
  if (k > 0.0) {
    let rk = sqrt(k);
    return cos(rk*x);
  }
  if (k < 0.0) {
    let rk = sqrt(-k);
    return cosh(rk*x);
  }
  return 1.0;
}

fn sink(k: f32, x: f32) -> f32 {
  if (k > 0.0) {
    let rk = sqrt(k);
    return sin(rk*x)/rk;
  }
  if (k < 0.0) {
    let rk = sqrt(-k);
    return sinh(rk*x)/rk;
  }
  return x;
}

alias vec1f = array<f32, 1>;
`,ln=e=>ut(e.map(l=>it(-1,1,l))),sn=e=>{const l=e.length,n=ct(e);switch(l){case 1:return $(0,e[0]-1).map(r=>[(r+0)*n[0],(r+1)*n[0]]);case 2:{const o=$(0,e[0]).flatMap(a=>$(0,e[1]-1).map(t=>[a*n[0]+(t+0)*n[1],a*n[0]+(t+1)*n[1]])),r=$(0,e[1]).flatMap(a=>$(0,e[0]-1).map(t=>[(t+0)*n[0]+a*n[1],(t+1)*n[0]+a*n[1]]));return ge(o,r)}case 3:{const o=$(0,e[0]).flatMap(t=>$(0,e[1]).flatMap(i=>$(0,e[2]-1).map(f=>[t*n[0]+i*n[1]+(f+0)*n[2],t*n[0]+i*n[1]+(f+1)*n[2]]))),r=$(0,e[0]).flatMap(t=>$(0,e[2]).flatMap(i=>$(0,e[1]-1).map(f=>[t*n[0]+(f+0)*n[1]+i*n[2],t*n[0]+(f+1)*n[1]+i*n[2]]))),a=$(0,e[1]).flatMap(t=>$(0,e[2]).flatMap(i=>$(0,e[0]-1).map(f=>[(f+0)*n[0]+t*n[1]+i*n[2],(f+1)*n[0]+t*n[1]+i*n[2]])));return ge(o,r,a)}}return[]},un=e=>{const l=ln(e).map(r=>[1,r[0]??0,r[1]??0,r[2]??0]),n=ie([1,1,1,1],l.length),o=sn(e);return{position:{data:l.flat(1),type:Float32Array,numComponents:4},color:{data:n.flat(1),type:Float32Array,numComponents:4},indices:{data:o.flat(1),type:Uint32Array}}},cn=e=>{const l=/@plot\s+fn\s+(?<name>\w+)\s*\(\w+:\s*(?<domain>\w+)\)\s*->\s*(?<codomain>\w+)/g,n=[];let o;do o=l.exec(e),o&&o.groups&&n.push({name:o.groups.name,domain:{name:o.groups.domain},codomain:{name:o.groups.codomain}});while(o);return{functions:n}},ce=e=>{switch(e.name){case"vec1f":return 1;case"vec2f":return 2;case"vec3f":return 3;case"vec4f":return 4}return 0},Se=e=>[ce(e.domain),ce(e.codomain)],dn=`@plot
fn f(x: vec2f) -> vec3f {
  return vec3f(x, sin(x[0])*cos(x[1]));
}`,fn={class:"flex flex-row items-center h-12 p-1 border-b-2 border-border"},pn=k("h1",{class:"px-2"},"Parametric Surface",-1),mn=k("span",{class:"flex-grow"},null,-1),vn={class:"flex flex-row items-center justify-center overflow-hidden"},gn={class:"flex flex-col p-2"},bn={class:"flex flex-row items-center text-heading text-lg gap-2 my-2"},hn=["onUpdate:modelValue"],wn={class:"flex-grow"},xn={class:"text-text text-base"},yn=`
struct GlobalData {
  projection: mat4x4f,
  view: mat4x4f,
  time: f32,
}
`,In=`
struct SurfaceData {
  model: mat4x4f,
  color: vec4f,
}
`,Dn=N({__name:"ParametricSurfaceView",setup(e){const n=V({source:dn,options:{functions:[]}}),o=He(n),r=`
${yn}
${In}

@group(0) @binding(0) var<uniform> uGlobal: GlobalData;
@group(0) @binding(1) var<uniform> uSurface: SurfaceData;
`,a=(u,[c,m])=>{const y=S=>{switch(S){case 1:return"vec1f(position.y)";case 2:return"position.yz";case 3:return"position.yzw";default:return"0.0"}};return`fn surface(position: vec4f) -> vec4f {
  return ${(S=>F=>{switch(S){case 1:return`vec4(1.0, ${F}[0], 0.0, 0.0)`;case 2:return`vec4(1.0, ${F}, 0.0)`;case 3:return`vec4(1.0, ${F})`;default:return"vec4(1.0, 0.0, 0.0, 0.0)"}})(m)(`${u}(${y(c)})`)};
}`},t=(u,c)=>`
${rn()}

struct VertexIn {
  @location(0) position: vec4f,
  @location(1) color: vec4f,
}

struct FragmentIn {
  @builtin(position) position: vec4f,
  @location(0) color: vec4f,
}

struct VaryingData {
  position: vec4f,
  color: vec4f,
}

${r}

${u}

${c}

fn fromVertexIn(in: VertexIn) -> VaryingData {
  return VaryingData(
    uGlobal.view * surface(uSurface.model * in.position),
    uSurface.color * in.color,
  );
}

fn toFragmentIn(in: VaryingData) -> FragmentIn {
  return FragmentIn(
    uGlobal.projection * in.position.yzwx,
    in.color,
  );
}

@vertex
fn vertexMain(in: VertexIn) -> FragmentIn {
  return toFragmentIn(fromVertexIn(in));
}

@fragment
fn fragmentMain(in: FragmentIn) -> @location(0) vec4f {
  return in.color;
}
`,i=V(null),f=dt(r),b=be(f.uniforms.uGlobal);b.set({projection:O.perspective(Math.PI/4,1920/1080,.1,1e3),view:O.translation([0,0,-3])});const p={},v={alphaMode:"premultiplied",size:[1920,1080],autoResize:!1},s=u=>{const c={state:null,valid:!1,onCreate(m){console.log("Resource::onCreate"),!c.state&&(c.state=u.create(m))},onUpdate(m){var y,x;c.valid||((y=c.onDelete)==null||y.call(c,m),(x=c.onCreate)==null||x.call(c,m),c.valid=!0)},onDelete(m){console.log("Resource::onDelete"),c.state&&(u.delete(m,c.state),c.state=null)}};return c},h=u=>[[],[Math.pow(u,3*2)],[Math.pow(u,3),Math.pow(u,3)],[Math.pow(u,2),Math.pow(u,2),Math.pow(u,2)]],d=s({create({device:u}){return h(3).map(un).map(m=>({vertices:ht(u,m,{shaderLocation:0,stepMode:"vertex",interleave:!0}),topology:1}))},delete({device:u},c){}}),I=u=>{const c=Me(jt(u[0],u[1]),2),m=Me(Ht(u[0],u[1]),2);return O.st(m,c)},w=s({create({device:u,format:c}){return{uniforms:u.createBuffer({size:b.arrayBuffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})}},delete({device:u},c){}}),g=s({create({device:u,format:c}){if(!w.state||!d.state||!i.value)return null;const{source:m,info:y}=i.value;return y.functions.map((x,S)=>{const[F,C]=Se(x),E=u.createShaderModule({code:t(m,a(x.name,[F,C]))}),{uniforms:A}=w.state,{vertices:Y}=d.state[F],K=u.createRenderPipeline({layout:"auto",vertex:{module:E,entryPoint:"vertexMain",buffers:Y.bufferLayouts},fragment:{module:E,entryPoint:"fragmentMain",targets:[{format:c}]},primitive:{topology:wt[1]}});p[S]=be(f.uniforms.uSurface);const W=u.createBuffer({size:p[S].arrayBuffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),z=u.createBindGroup({layout:K.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:A}},{binding:1,resource:{buffer:W}}]});return{pipeline:K,bindGroup:z,uniforms:W}})},delete({device:u},c){}}),{listeners:G,transformInplace:ae}=on([-4,0,-Math.PI/4]),Ue={onCreate(u){var c,m,y;console.log("ParametricSurfaceView::onCreate"),(c=w.onUpdate)==null||c.call(w,u),w.state&&((m=d.onUpdate)==null||m.call(d,u),d.state&&((y=g.onUpdate)==null||y.call(g,u),g.state))},onRender(u){var A,Y,K;const{device:c,context:m,timestamp:y}=u;if((A=w.onUpdate)==null||A.call(w,u),!w.state||((Y=d.onUpdate)==null||Y.call(d,u),!d.state)||((K=g.onUpdate)==null||K.call(g,u),!g.state))return;const x=c.createCommandEncoder(),S=x.beginRenderPass({colorAttachments:[{clearValue:Float32Array.of(0,0,0,0),loadOp:"clear",storeOp:"store",view:m.getCurrentTexture().createView()}]});if(!i.value)return null;const{info:F}=i.value,{uniforms:C}=w.state;b.set({time:y/1e3}),ae(b.views.view),c.queue.writeBuffer(C,0,b.arrayBuffer),F.functions.forEach((W,z)=>{const[Ne,Mn]=Se(W),re=o.options.functions[z];if(!re.visible)return;const{vertices:Q}=d.state[Ne],{pipeline:Ge,bindGroup:ze,uniforms:qe}=g.state[z];p[z].set({model:I(re.extent),color:xt(re.color).gl()}),c.queue.writeBuffer(qe,0,p[z].arrayBuffer),S.setPipeline(Ge),S.setBindGroup(0,ze),S.setVertexBuffer(0,Q.buffers[0]),S.setIndexBuffer(Q.indexBuffer,Q.indexFormat),S.drawIndexed(Q.numElements)}),S.end();const E=x.finish();c.queue.submit([E])},onDelete(u){var c,m,y;console.log("ParametricSurfaceView::Delete"),(c=g.onDelete)==null||c.call(g,u),(m=d.onDelete)==null||m.call(d,u),(y=w.onDelete)==null||y.call(w,u)}},Te=u=>({source:u.replaceAll("@plot","/*@plot*/"),info:cn(u)}),Ae=u=>{const c=ce(u.domain);return[ie(-1,c),ie(1,c)]},Be=({info:u})=>({functions:u.functions.map(c=>({name:c.name,color:"#ffffff",extent:Ae(c),visible:!0}))}),Oe=(u,c)=>({functions:u.functions.map((m,y)=>{const x=c.functions[y];return{color:(x==null?void 0:x.color)??m.color,extent:[m.extent[0].map((S,F)=>{var C,E;return((E=(C=x==null?void 0:x.extent)==null?void 0:C[0])==null?void 0:E[F])??S}),m.extent[1].map((S,F)=>{var C,E;return((E=(C=x==null?void 0:x.extent)==null?void 0:C[1])==null?void 0:E[F])??S})],visible:(x==null?void 0:x.visible)??m.visible}})}),fe=u=>{const c=Te(u.source);i.value=c,u.options=Oe(Be(c),u.options),g.valid=!1},Le=u=>{switch(u.key){case"Enter":return u.shiftKey;case"s":case"S":return u.ctrlKey||u.metaKey;default:return!1}};Ye(document,"keydown",u=>{Le(u)&&(u.stopPropagation(),u.preventDefault(),fe(o))}),We(n,fe,{immediate:!0});const oe=u=>{var c,m,y;return(y=(m=(c=i.value)==null?void 0:c.info)==null?void 0:m.functions)==null?void 0:y[u]};return(u,c)=>(B(),L(J,null,[k("header",fn,[pn,mn,_(ft,{modelValue:n.value,"onUpdate:modelValue":c[0]||(c[0]=m=>n.value=m)},null,8,["modelValue"]),_(pt)]),_(M(bt),{as:"main",class:"flex-grow flex flex-col overflow-hidden","default-index":2},{default:U(()=>[_(M(mt),{class:"flex flex-row md:hidden"},{default:U(()=>[_(M(he),{class:"tab"},{default:U(()=>[Z("Input")]),_:1}),_(M(he),{class:"tab"},{default:U(()=>[Z("Output")]),_:1})]),_:1}),_(M(vt),{class:"h-full md:grid md:grid-cols-2 border-y-2 border-border"},{default:U(()=>[_(M(we),{class:"h-full ui-not-selected:hidden md:ui-not-selected:grid grid grid-rows-1 overflow-hidden",static:!0},{default:U(()=>[_(Qe,{modelValue:M(o).source,"onUpdate:modelValue":c[1]||(c[1]=m=>M(o).source=m)},null,8,["modelValue"])]),_:1}),_(M(we),{class:"h-full ui-not-selected:hidden md:ui-not-selected:grid grid grid-rows-2 overflow-hidden",static:!0},{default:U(()=>[(B(),Xe(Je,null,{default:U(()=>[k("div",vn,[_(gt,{renderer:Ue,listeners:M(G),options:v},null,8,["listeners"])])]),_:1})),k("div",gn,[(B(!0),L(J,null,le(M(o).options.functions,(m,y)=>{var x,S,F,C,E;return B(),L("div",{key:y},[k("h2",bn,[se(k("input",{class:"w-8 h-8",name:"fill",type:"color","onUpdate:modelValue":A=>m.color=A},null,8,hn),[[ue,m.color]]),k("span",wn,[Z(j((x=oe(y))==null?void 0:x.name)+": ",1),k("span",xn,j((F=(S=oe(y))==null?void 0:S.domain)==null?void 0:F.name)+" → "+j((E=(C=oe(y))==null?void 0:C.codomain)==null?void 0:E.name),1)]),_(Xt,{modelValue:m.visible,"onUpdate:modelValue":A=>m.visible=A},null,8,["modelValue","onUpdate:modelValue"])]),_(an,{modelValue:m.extent,"onUpdate:modelValue":A=>m.extent=A},null,8,["modelValue","onUpdate:modelValue"])])}),128))])]),_:1})]),_:1})]),_:1})],64))}});export{Dn as default};
