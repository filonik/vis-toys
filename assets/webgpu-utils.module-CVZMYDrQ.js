import{C as Uu,G as Vu,n as Pu}from"./ToggleDarkButton.vue_vue_type_script_setup_true_lang-BiELzYaB.js";import{o as Ou,z as Bu,d as Ru,c as Fn,r as qn,C as Gu,b as Cn,e as Ln}from"./index-CB0EF2dQ.js";async function Du(c,e,r={},a={}){let o=null;const f=w=>{let F,Q,ee;return w.devicePixelContentBoxSize?(F=w.devicePixelContentBoxSize[0].inlineSize,Q=w.devicePixelContentBoxSize[0].blockSize,ee=1):(F=w.contentRect.width,Q=w.contentRect.height,ee=window.devicePixelRatio),[Math.round(F*ee),Math.round(Q*ee)]},y=(w,F)=>{const[Q,ee]=F,ue=w.width!==Q||w.height!==ee;return ue&&(w.width=Q,w.height=ee),ue},{pause:k,resume:x}=Uu(w=>{var F;if(o){if(a.autoResize){const Q=c.value;y(Q,o.display)}(F=e.onRender)==null||F.call(e,{...o,...w})}},{immediate:!1});Vu(c,w=>{var F;o&&(o.display=f(w[0]),(F=e.onResize)==null||F.call(e,{...o,entries:w}))});for(const[w,F]of Object.entries(r))Pu(c,w,F);if(Ou(()=>{var w;ie(),o&&((w=e.onCreate)==null||w.call(e,o),x())}),Bu(()=>{var w;o&&(k(),(w=e.onDelete)==null||w.call(e,o)),oe()}),!navigator.gpu)return console.log("WebGPU not supported."),!1;const S=await navigator.gpu.requestAdapter();if(!S)return console.log("Invalid adapter."),!1;const{features:M=[]}=a,q=[];for(let w of M)S.features.has(w)?q.push(w):console.warn(`Requested feature not supported: "${w}".`);const X=await S.requestDevice({requiredFeatures:q});if(!X)return console.log("Invalid device."),!1;const ie=()=>{console.log("useWebGpu::initialize");const w=c.value;if(!w){console.log("Invalid canvas.");return}const F=w.getContext("webgpu");if(!F){console.log("Invalid context.");return}const Q=navigator.gpu.getPreferredCanvasFormat(),{alphaMode:ee}=a;F.configure({device:X,format:Q,alphaMode:ee});const{width:ue,height:ce}=w.getBoundingClientRect();o={adapter:S,device:X,context:F,format:Q,display:[ue,ce]}},oe=()=>{console.log("useWebGpu::finalize"),o=null};return!0}const Wu=["width","height"],ju={key:1,class:"flex items-center justify-center"},el=Ru({__name:"WebGpuCanvas",props:{renderer:{},options:{default:()=>({size:[1920,1080]})},listeners:{default:()=>({})}},async setup(c){let e,r;const a=c,o=Fn(()=>{var x;return((x=a.options.size)==null?void 0:x[0])??1920}),f=Fn(()=>{var x;return((x=a.options.size)==null?void 0:x[1])??1080}),y=qn(),k=qn(!0);return k.value=([e,r]=Gu(()=>Du(y,a.renderer,a.listeners,a.options)),e=await e,r(),e),(x,S)=>k.value?(Cn(),Ln("canvas",{key:0,ref_key:"canvasRef",ref:y,class:"cursor-default",width:o.value,height:f.value,tabindex:"1"},null,8,Wu)):(Cn(),Ln("div",ju,"WebGPU not supported."))}});var Yu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xu(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Zn={exports:{}};/**
 * chroma.js - JavaScript library for color conversions
 *
 * Copyright (c) 2011-2019, Gregor Aisch
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 * list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 * this list of conditions and the following disclaimer in the documentation
 * and/or other materials provided with the distribution.
 *
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 * derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * -------------------------------------------------------
 *
 * chroma.js includes colors from colorbrewer2.org, which are released under
 * the following license:
 *
 * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
 * and The Pennsylvania State University.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied. See the License for the specific
 * language governing permissions and limitations under the License.
 *
 * ------------------------------------------------------
 *
 * Named colors are taken from X11 Color Names.
 * http://www.w3.org/TR/css3-color/#svg-color
 *
 * @preserve
 */(function(c,e){(function(r,a){c.exports=a()})(Yu,function(){for(var r=function(t,n,s){return n===void 0&&(n=0),s===void 0&&(s=1),t<n?n:t>s?s:t},a=r,o=function(t){t._clipped=!1,t._unclipped=t.slice(0);for(var n=0;n<=3;n++)n<3?((t[n]<0||t[n]>255)&&(t._clipped=!0),t[n]=a(t[n],0,255)):n===3&&(t[n]=a(t[n],0,1));return t},f={},y=0,k=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];y<k.length;y+=1){var x=k[y];f["[object "+x+"]"]=x.toLowerCase()}var S=function(t){return f[Object.prototype.toString.call(t)]||"object"},M=S,q=function(t,n){return n===void 0&&(n=null),t.length>=3?Array.prototype.slice.call(t):M(t[0])=="object"&&n?n.split("").filter(function(s){return t[0][s]!==void 0}).map(function(s){return t[0][s]}):t[0]},X=S,ie=function(t){if(t.length<2)return null;var n=t.length-1;return X(t[n])=="string"?t[n].toLowerCase():null},oe=Math.PI,w={clip_rgb:o,limit:r,type:S,unpack:q,last:ie,PI:oe,TWOPI:oe*2,PITHIRD:oe/3,DEG2RAD:oe/180,RAD2DEG:180/oe},F={format:{},autodetect:[]},Q=w.last,ee=w.clip_rgb,ue=w.type,ce=F,Me=function(){for(var n=[],s=arguments.length;s--;)n[s]=arguments[s];var u=this;if(ue(n[0])==="object"&&n[0].constructor&&n[0].constructor===this.constructor)return n[0];var h=Q(n),d=!1;if(!h){d=!0,ce.sorted||(ce.autodetect=ce.autodetect.sort(function(E,$){return $.p-E.p}),ce.sorted=!0);for(var l=0,m=ce.autodetect;l<m.length;l+=1){var v=m[l];if(h=v.test.apply(v,n),h)break}}if(ce.format[h]){var b=ce.format[h].apply(null,d?n:n.slice(0,-1));u._rgb=ee(b)}else throw new Error("unknown format: "+n);u._rgb.length===3&&u._rgb.push(1)};Me.prototype.toString=function(){return ue(this.hex)=="function"?this.hex():"["+this._rgb.join(",")+"]"};var C=Me,Ie=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(Ie.Color,[null].concat(t)))};Ie.Color=C,Ie.version="2.4.2";var J=Ie,fs=w.unpack,tr=Math.max,ds=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var s=fs(t,"rgb"),u=s[0],h=s[1],d=s[2];u=u/255,h=h/255,d=d/255;var l=1-tr(u,tr(h,d)),m=l<1?1/(1-l):0,v=(1-u-l)*m,b=(1-h-l)*m,E=(1-d-l)*m;return[v,b,E,l]},_s=ds,ps=w.unpack,ms=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];t=ps(t,"cmyk");var s=t[0],u=t[1],h=t[2],d=t[3],l=t.length>4?t[4]:1;return d===1?[0,0,0,l]:[s>=1?0:255*(1-s)*(1-d),u>=1?0:255*(1-u)*(1-d),h>=1?0:255*(1-h)*(1-d),l]},gs=ms,vs=J,rr=C,nr=F,ys=w.unpack,bs=w.type,ws=_s;rr.prototype.cmyk=function(){return ws(this._rgb)},vs.cmyk=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(rr,[null].concat(t,["cmyk"])))},nr.format.cmyk=gs,nr.autodetect.push({p:2,test:function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(t=ys(t,"cmyk"),bs(t)==="array"&&t.length===4)return"cmyk"}});var ks=w.unpack,xs=w.last,_t=function(t){return Math.round(t*100)/100},Es=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var s=ks(t,"hsla"),u=xs(t)||"lsa";return s[0]=_t(s[0]||0),s[1]=_t(s[1]*100)+"%",s[2]=_t(s[2]*100)+"%",u==="hsla"||s.length>3&&s[3]<1?(s[3]=s.length>3?s[3]:1,u="hsla"):s.length=3,u+"("+s.join(",")+")"},As=Es,Ts=w.unpack,Ss=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];t=Ts(t,"rgba");var s=t[0],u=t[1],h=t[2];s/=255,u/=255,h/=255;var d=Math.min(s,u,h),l=Math.max(s,u,h),m=(l+d)/2,v,b;return l===d?(v=0,b=Number.NaN):v=m<.5?(l-d)/(l+d):(l-d)/(2-l-d),s==l?b=(u-h)/(l-d):u==l?b=2+(h-s)/(l-d):h==l&&(b=4+(s-u)/(l-d)),b*=60,b<0&&(b+=360),t.length>3&&t[3]!==void 0?[b,v,m,t[3]]:[b,v,m]},sr=Ss,$s=w.unpack,zs=w.last,Ns=As,Ms=sr,pt=Math.round,Is=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var s=$s(t,"rgba"),u=zs(t)||"rgb";return u.substr(0,3)=="hsl"?Ns(Ms(s),u):(s[0]=pt(s[0]),s[1]=pt(s[1]),s[2]=pt(s[2]),(u==="rgba"||s.length>3&&s[3]<1)&&(s[3]=s.length>3?s[3]:1,u="rgba"),u+"("+s.slice(0,u==="rgb"?3:4).join(",")+")")},Fs=Is,qs=w.unpack,mt=Math.round,Cs=function(){for(var t,n=[],s=arguments.length;s--;)n[s]=arguments[s];n=qs(n,"hsl");var u=n[0],h=n[1],d=n[2],l,m,v;if(h===0)l=m=v=d*255;else{var b=[0,0,0],E=[0,0,0],$=d<.5?d*(1+h):d+h-d*h,A=2*d-$,N=u/360;b[0]=N+1/3,b[1]=N,b[2]=N-1/3;for(var z=0;z<3;z++)b[z]<0&&(b[z]+=1),b[z]>1&&(b[z]-=1),6*b[z]<1?E[z]=A+($-A)*6*b[z]:2*b[z]<1?E[z]=$:3*b[z]<2?E[z]=A+($-A)*(2/3-b[z])*6:E[z]=A;t=[mt(E[0]*255),mt(E[1]*255),mt(E[2]*255)],l=t[0],m=t[1],v=t[2]}return n.length>3?[l,m,v,n[3]]:[l,m,v,1]},ar=Cs,ir=ar,or=F,ur=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,cr=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,lr=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,hr=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,fr=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,dr=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,_r=Math.round,pr=function(t){t=t.toLowerCase().trim();var n;if(or.format.named)try{return or.format.named(t)}catch{}if(n=t.match(ur)){for(var s=n.slice(1,4),u=0;u<3;u++)s[u]=+s[u];return s[3]=1,s}if(n=t.match(cr)){for(var h=n.slice(1,5),d=0;d<4;d++)h[d]=+h[d];return h}if(n=t.match(lr)){for(var l=n.slice(1,4),m=0;m<3;m++)l[m]=_r(l[m]*2.55);return l[3]=1,l}if(n=t.match(hr)){for(var v=n.slice(1,5),b=0;b<3;b++)v[b]=_r(v[b]*2.55);return v[3]=+v[3],v}if(n=t.match(fr)){var E=n.slice(1,4);E[1]*=.01,E[2]*=.01;var $=ir(E);return $[3]=1,$}if(n=t.match(dr)){var A=n.slice(1,4);A[1]*=.01,A[2]*=.01;var N=ir(A);return N[3]=+n[4],N}};pr.test=function(t){return ur.test(t)||cr.test(t)||lr.test(t)||hr.test(t)||fr.test(t)||dr.test(t)};var Ls=pr,Us=J,mr=C,gr=F,Vs=w.type,Ps=Fs,vr=Ls;mr.prototype.css=function(t){return Ps(this._rgb,t)},Us.css=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(mr,[null].concat(t,["css"])))},gr.format.css=vr,gr.autodetect.push({p:5,test:function(t){for(var n=[],s=arguments.length-1;s-- >0;)n[s]=arguments[s+1];if(!n.length&&Vs(t)==="string"&&vr.test(t))return"css"}});var yr=C,Os=J,Bs=F,Rs=w.unpack;Bs.format.gl=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var s=Rs(t,"rgba");return s[0]*=255,s[1]*=255,s[2]*=255,s},Os.gl=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(yr,[null].concat(t,["gl"])))},yr.prototype.gl=function(){var t=this._rgb;return[t[0]/255,t[1]/255,t[2]/255,t[3]]};var Gs=w.unpack,Ds=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var s=Gs(t,"rgb"),u=s[0],h=s[1],d=s[2],l=Math.min(u,h,d),m=Math.max(u,h,d),v=m-l,b=v*100/255,E=l/(255-v)*100,$;return v===0?$=Number.NaN:(u===m&&($=(h-d)/v),h===m&&($=2+(d-u)/v),d===m&&($=4+(u-h)/v),$*=60,$<0&&($+=360)),[$,b,E]},Ws=Ds,js=w.unpack,Ys=Math.floor,Xs=function(){for(var t,n,s,u,h,d,l=[],m=arguments.length;m--;)l[m]=arguments[m];l=js(l,"hcg");var v=l[0],b=l[1],E=l[2],$,A,N;E=E*255;var z=b*255;if(b===0)$=A=N=E;else{v===360&&(v=0),v>360&&(v-=360),v<0&&(v+=360),v/=60;var L=Ys(v),P=v-L,B=E*(1-b),D=B+z*(1-P),se=B+z*P,re=B+z;switch(L){case 0:t=[re,se,B],$=t[0],A=t[1],N=t[2];break;case 1:n=[D,re,B],$=n[0],A=n[1],N=n[2];break;case 2:s=[B,re,se],$=s[0],A=s[1],N=s[2];break;case 3:u=[B,D,re],$=u[0],A=u[1],N=u[2];break;case 4:h=[se,B,re],$=h[0],A=h[1],N=h[2];break;case 5:d=[re,B,D],$=d[0],A=d[1],N=d[2];break}}return[$,A,N,l.length>3?l[3]:1]},Hs=Xs,Zs=w.unpack,Js=w.type,Qs=J,br=C,wr=F,Ks=Ws;br.prototype.hcg=function(){return Ks(this._rgb)},Qs.hcg=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(br,[null].concat(t,["hcg"])))},wr.format.hcg=Hs,wr.autodetect.push({p:1,test:function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(t=Zs(t,"hcg"),Js(t)==="array"&&t.length===3)return"hcg"}});var ea=w.unpack,ta=w.last,et=Math.round,ra=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var s=ea(t,"rgba"),u=s[0],h=s[1],d=s[2],l=s[3],m=ta(t)||"auto";l===void 0&&(l=1),m==="auto"&&(m=l<1?"rgba":"rgb"),u=et(u),h=et(h),d=et(d);var v=u<<16|h<<8|d,b="000000"+v.toString(16);b=b.substr(b.length-6);var E="0"+et(l*255).toString(16);switch(E=E.substr(E.length-2),m.toLowerCase()){case"rgba":return"#"+b+E;case"argb":return"#"+E+b;default:return"#"+b}},kr=ra,na=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,sa=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,aa=function(t){if(t.match(na)){(t.length===4||t.length===7)&&(t=t.substr(1)),t.length===3&&(t=t.split(""),t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var n=parseInt(t,16),s=n>>16,u=n>>8&255,h=n&255;return[s,u,h,1]}if(t.match(sa)){(t.length===5||t.length===9)&&(t=t.substr(1)),t.length===4&&(t=t.split(""),t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);var d=parseInt(t,16),l=d>>24&255,m=d>>16&255,v=d>>8&255,b=Math.round((d&255)/255*100)/100;return[l,m,v,b]}throw new Error("unknown hex color: "+t)},xr=aa,ia=J,Er=C,oa=w.type,Ar=F,ua=kr;Er.prototype.hex=function(t){return ua(this._rgb,t)},ia.hex=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(Er,[null].concat(t,["hex"])))},Ar.format.hex=xr,Ar.autodetect.push({p:4,test:function(t){for(var n=[],s=arguments.length-1;s-- >0;)n[s]=arguments[s+1];if(!n.length&&oa(t)==="string"&&[3,4,5,6,7,8,9].indexOf(t.length)>=0)return"hex"}});var ca=w.unpack,Tr=w.TWOPI,la=Math.min,ha=Math.sqrt,fa=Math.acos,da=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var s=ca(t,"rgb"),u=s[0],h=s[1],d=s[2];u/=255,h/=255,d/=255;var l,m=la(u,h,d),v=(u+h+d)/3,b=v>0?1-m/v:0;return b===0?l=NaN:(l=(u-h+(u-d))/2,l/=ha((u-h)*(u-h)+(u-d)*(h-d)),l=fa(l),d>h&&(l=Tr-l),l/=Tr),[l*360,b,v]},_a=da,pa=w.unpack,gt=w.limit,Fe=w.TWOPI,vt=w.PITHIRD,qe=Math.cos,ma=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];t=pa(t,"hsi");var s=t[0],u=t[1],h=t[2],d,l,m;return isNaN(s)&&(s=0),isNaN(u)&&(u=0),s>360&&(s-=360),s<0&&(s+=360),s/=360,s<1/3?(m=(1-u)/3,d=(1+u*qe(Fe*s)/qe(vt-Fe*s))/3,l=1-(m+d)):s<2/3?(s-=1/3,d=(1-u)/3,l=(1+u*qe(Fe*s)/qe(vt-Fe*s))/3,m=1-(d+l)):(s-=2/3,l=(1-u)/3,m=(1+u*qe(Fe*s)/qe(vt-Fe*s))/3,d=1-(l+m)),d=gt(h*d*3),l=gt(h*l*3),m=gt(h*m*3),[d*255,l*255,m*255,t.length>3?t[3]:1]},ga=ma,va=w.unpack,ya=w.type,ba=J,Sr=C,$r=F,wa=_a;Sr.prototype.hsi=function(){return wa(this._rgb)},ba.hsi=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(Sr,[null].concat(t,["hsi"])))},$r.format.hsi=ga,$r.autodetect.push({p:2,test:function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(t=va(t,"hsi"),ya(t)==="array"&&t.length===3)return"hsi"}});var ka=w.unpack,xa=w.type,Ea=J,zr=C,Nr=F,Aa=sr;zr.prototype.hsl=function(){return Aa(this._rgb)},Ea.hsl=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(zr,[null].concat(t,["hsl"])))},Nr.format.hsl=ar,Nr.autodetect.push({p:2,test:function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(t=ka(t,"hsl"),xa(t)==="array"&&t.length===3)return"hsl"}});var Ta=w.unpack,Sa=Math.min,$a=Math.max,za=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];t=Ta(t,"rgb");var s=t[0],u=t[1],h=t[2],d=Sa(s,u,h),l=$a(s,u,h),m=l-d,v,b,E;return E=l/255,l===0?(v=Number.NaN,b=0):(b=m/l,s===l&&(v=(u-h)/m),u===l&&(v=2+(h-s)/m),h===l&&(v=4+(s-u)/m),v*=60,v<0&&(v+=360)),[v,b,E]},Na=za,Ma=w.unpack,Ia=Math.floor,Fa=function(){for(var t,n,s,u,h,d,l=[],m=arguments.length;m--;)l[m]=arguments[m];l=Ma(l,"hsv");var v=l[0],b=l[1],E=l[2],$,A,N;if(E*=255,b===0)$=A=N=E;else{v===360&&(v=0),v>360&&(v-=360),v<0&&(v+=360),v/=60;var z=Ia(v),L=v-z,P=E*(1-b),B=E*(1-b*L),D=E*(1-b*(1-L));switch(z){case 0:t=[E,D,P],$=t[0],A=t[1],N=t[2];break;case 1:n=[B,E,P],$=n[0],A=n[1],N=n[2];break;case 2:s=[P,E,D],$=s[0],A=s[1],N=s[2];break;case 3:u=[P,B,E],$=u[0],A=u[1],N=u[2];break;case 4:h=[D,P,E],$=h[0],A=h[1],N=h[2];break;case 5:d=[E,P,B],$=d[0],A=d[1],N=d[2];break}}return[$,A,N,l.length>3?l[3]:1]},qa=Fa,Ca=w.unpack,La=w.type,Ua=J,Mr=C,Ir=F,Va=Na;Mr.prototype.hsv=function(){return Va(this._rgb)},Ua.hsv=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(Mr,[null].concat(t,["hsv"])))},Ir.format.hsv=qa,Ir.autodetect.push({p:2,test:function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(t=Ca(t,"hsv"),La(t)==="array"&&t.length===3)return"hsv"}});var tt={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Ce=tt,Pa=w.unpack,Fr=Math.pow,Oa=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var s=Pa(t,"rgb"),u=s[0],h=s[1],d=s[2],l=Ba(u,h,d),m=l[0],v=l[1],b=l[2],E=116*v-16;return[E<0?0:E,500*(m-v),200*(v-b)]},yt=function(t){return(t/=255)<=.04045?t/12.92:Fr((t+.055)/1.055,2.4)},bt=function(t){return t>Ce.t3?Fr(t,1/3):t/Ce.t2+Ce.t0},Ba=function(t,n,s){t=yt(t),n=yt(n),s=yt(s);var u=bt((.4124564*t+.3575761*n+.1804375*s)/Ce.Xn),h=bt((.2126729*t+.7151522*n+.072175*s)/Ce.Yn),d=bt((.0193339*t+.119192*n+.9503041*s)/Ce.Zn);return[u,h,d]},qr=Oa,Le=tt,Ra=w.unpack,Ga=Math.pow,Da=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];t=Ra(t,"lab");var s=t[0],u=t[1],h=t[2],d,l,m,v,b,E;return l=(s+16)/116,d=isNaN(u)?l:l+u/500,m=isNaN(h)?l:l-h/200,l=Le.Yn*kt(l),d=Le.Xn*kt(d),m=Le.Zn*kt(m),v=wt(3.2404542*d-1.5371385*l-.4985314*m),b=wt(-.969266*d+1.8760108*l+.041556*m),E=wt(.0556434*d-.2040259*l+1.0572252*m),[v,b,E,t.length>3?t[3]:1]},wt=function(t){return 255*(t<=.00304?12.92*t:1.055*Ga(t,1/2.4)-.055)},kt=function(t){return t>Le.t1?t*t*t:Le.t2*(t-Le.t0)},Cr=Da,Wa=w.unpack,ja=w.type,Ya=J,Lr=C,Ur=F,Xa=qr;Lr.prototype.lab=function(){return Xa(this._rgb)},Ya.lab=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(Lr,[null].concat(t,["lab"])))},Ur.format.lab=Cr,Ur.autodetect.push({p:2,test:function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(t=Wa(t,"lab"),ja(t)==="array"&&t.length===3)return"lab"}});var Ha=w.unpack,Za=w.RAD2DEG,Ja=Math.sqrt,Qa=Math.atan2,Ka=Math.round,ei=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var s=Ha(t,"lab"),u=s[0],h=s[1],d=s[2],l=Ja(h*h+d*d),m=(Qa(d,h)*Za+360)%360;return Ka(l*1e4)===0&&(m=Number.NaN),[u,l,m]},Vr=ei,ti=w.unpack,ri=qr,ni=Vr,si=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var s=ti(t,"rgb"),u=s[0],h=s[1],d=s[2],l=ri(u,h,d),m=l[0],v=l[1],b=l[2];return ni(m,v,b)},ai=si,ii=w.unpack,oi=w.DEG2RAD,ui=Math.sin,ci=Math.cos,li=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var s=ii(t,"lch"),u=s[0],h=s[1],d=s[2];return isNaN(d)&&(d=0),d=d*oi,[u,ci(d)*h,ui(d)*h]},Pr=li,hi=w.unpack,fi=Pr,di=Cr,_i=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];t=hi(t,"lch");var s=t[0],u=t[1],h=t[2],d=fi(s,u,h),l=d[0],m=d[1],v=d[2],b=di(l,m,v),E=b[0],$=b[1],A=b[2];return[E,$,A,t.length>3?t[3]:1]},Or=_i,pi=w.unpack,mi=Or,gi=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var s=pi(t,"hcl").reverse();return mi.apply(void 0,s)},vi=gi,yi=w.unpack,bi=w.type,Br=J,rt=C,xt=F,Rr=ai;rt.prototype.lch=function(){return Rr(this._rgb)},rt.prototype.hcl=function(){return Rr(this._rgb).reverse()},Br.lch=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(rt,[null].concat(t,["lch"])))},Br.hcl=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(rt,[null].concat(t,["hcl"])))},xt.format.lch=Or,xt.format.hcl=vi,["lch","hcl"].forEach(function(t){return xt.autodetect.push({p:2,test:function(){for(var n=[],s=arguments.length;s--;)n[s]=arguments[s];if(n=yi(n,t),bi(n)==="array"&&n.length===3)return t}})});var wi={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},Gr=wi,ki=C,Dr=F,xi=w.type,Xe=Gr,Ei=xr,Ai=kr;ki.prototype.name=function(){for(var t=Ai(this._rgb,"rgb"),n=0,s=Object.keys(Xe);n<s.length;n+=1){var u=s[n];if(Xe[u]===t)return u.toLowerCase()}return t},Dr.format.named=function(t){if(t=t.toLowerCase(),Xe[t])return Ei(Xe[t]);throw new Error("unknown color name: "+t)},Dr.autodetect.push({p:5,test:function(t){for(var n=[],s=arguments.length-1;s-- >0;)n[s]=arguments[s+1];if(!n.length&&xi(t)==="string"&&Xe[t.toLowerCase()])return"named"}});var Ti=w.unpack,Si=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var s=Ti(t,"rgb"),u=s[0],h=s[1],d=s[2];return(u<<16)+(h<<8)+d},$i=Si,zi=w.type,Ni=function(t){if(zi(t)=="number"&&t>=0&&t<=16777215){var n=t>>16,s=t>>8&255,u=t&255;return[n,s,u,1]}throw new Error("unknown num color: "+t)},Mi=Ni,Ii=J,Wr=C,jr=F,Fi=w.type,qi=$i;Wr.prototype.num=function(){return qi(this._rgb)},Ii.num=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(Wr,[null].concat(t,["num"])))},jr.format.num=Mi,jr.autodetect.push({p:5,test:function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(t.length===1&&Fi(t[0])==="number"&&t[0]>=0&&t[0]<=16777215)return"num"}});var Ci=J,Et=C,Yr=F,Xr=w.unpack,Hr=w.type,Zr=Math.round;Et.prototype.rgb=function(t){return t===void 0&&(t=!0),t===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(Zr)},Et.prototype.rgba=function(t){return t===void 0&&(t=!0),this._rgb.slice(0,4).map(function(n,s){return s<3?t===!1?n:Zr(n):n})},Ci.rgb=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(Et,[null].concat(t,["rgb"])))},Yr.format.rgb=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var s=Xr(t,"rgba");return s[3]===void 0&&(s[3]=1),s},Yr.autodetect.push({p:3,test:function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(t=Xr(t,"rgba"),Hr(t)==="array"&&(t.length===3||t.length===4&&Hr(t[3])=="number"&&t[3]>=0&&t[3]<=1))return"rgb"}});var nt=Math.log,Li=function(t){var n=t/100,s,u,h;return n<66?(s=255,u=n<6?0:-155.25485562709179-.44596950469579133*(u=n-2)+104.49216199393888*nt(u),h=n<20?0:-254.76935184120902+.8274096064007395*(h=n-10)+115.67994401066147*nt(h)):(s=351.97690566805693+.114206453784165*(s=n-55)-40.25366309332127*nt(s),u=325.4494125711974+.07943456536662342*(u=n-50)-28.0852963507957*nt(u),h=255),[s,u,h,1]},Jr=Li,Ui=Jr,Vi=w.unpack,Pi=Math.round,Oi=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];for(var s=Vi(t,"rgb"),u=s[0],h=s[2],d=1e3,l=4e4,m=.4,v;l-d>m;){v=(l+d)*.5;var b=Ui(v);b[2]/b[0]>=h/u?l=v:d=v}return Pi(v)},Bi=Oi,At=J,st=C,Tt=F,Ri=Bi;st.prototype.temp=st.prototype.kelvin=st.prototype.temperature=function(){return Ri(this._rgb)},At.temp=At.kelvin=At.temperature=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(st,[null].concat(t,["temp"])))},Tt.format.temp=Tt.format.kelvin=Tt.format.temperature=Jr;var Gi=w.unpack,St=Math.cbrt,Di=Math.pow,Wi=Math.sign,ji=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var s=Gi(t,"rgb"),u=s[0],h=s[1],d=s[2],l=[$t(u/255),$t(h/255),$t(d/255)],m=l[0],v=l[1],b=l[2],E=St(.4122214708*m+.5363325363*v+.0514459929*b),$=St(.2119034982*m+.6806995451*v+.1073969566*b),A=St(.0883024619*m+.2817188376*v+.6299787005*b);return[.2104542553*E+.793617785*$-.0040720468*A,1.9779984951*E-2.428592205*$+.4505937099*A,.0259040371*E+.7827717662*$-.808675766*A]},Qr=ji;function $t(t){var n=Math.abs(t);return n<.04045?t/12.92:(Wi(t)||1)*Di((n+.055)/1.055,2.4)}var Yi=w.unpack,at=Math.pow,Xi=Math.sign,Hi=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];t=Yi(t,"lab");var s=t[0],u=t[1],h=t[2],d=at(s+.3963377774*u+.2158037573*h,3),l=at(s-.1055613458*u-.0638541728*h,3),m=at(s-.0894841775*u-1.291485548*h,3);return[255*zt(4.0767416621*d-3.3077115913*l+.2309699292*m),255*zt(-1.2684380046*d+2.6097574011*l-.3413193965*m),255*zt(-.0041960863*d-.7034186147*l+1.707614701*m),t.length>3?t[3]:1]},Kr=Hi;function zt(t){var n=Math.abs(t);return n>.0031308?(Xi(t)||1)*(1.055*at(n,1/2.4)-.055):t*12.92}var Zi=w.unpack,Ji=w.type,Qi=J,en=C,tn=F,Ki=Qr;en.prototype.oklab=function(){return Ki(this._rgb)},Qi.oklab=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(en,[null].concat(t,["oklab"])))},tn.format.oklab=Kr,tn.autodetect.push({p:3,test:function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(t=Zi(t,"oklab"),Ji(t)==="array"&&t.length===3)return"oklab"}});var eo=w.unpack,to=Qr,ro=Vr,no=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var s=eo(t,"rgb"),u=s[0],h=s[1],d=s[2],l=to(u,h,d),m=l[0],v=l[1],b=l[2];return ro(m,v,b)},so=no,ao=w.unpack,io=Pr,oo=Kr,uo=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];t=ao(t,"lch");var s=t[0],u=t[1],h=t[2],d=io(s,u,h),l=d[0],m=d[1],v=d[2],b=oo(l,m,v),E=b[0],$=b[1],A=b[2];return[E,$,A,t.length>3?t[3]:1]},co=uo,lo=w.unpack,ho=w.type,fo=J,rn=C,nn=F,_o=so;rn.prototype.oklch=function(){return _o(this._rgb)},fo.oklch=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return new(Function.prototype.bind.apply(rn,[null].concat(t,["oklch"])))},nn.format.oklch=co,nn.autodetect.push({p:3,test:function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(t=lo(t,"oklch"),ho(t)==="array"&&t.length===3)return"oklch"}});var sn=C,po=w.type;sn.prototype.alpha=function(t,n){return n===void 0&&(n=!1),t!==void 0&&po(t)==="number"?n?(this._rgb[3]=t,this):new sn([this._rgb[0],this._rgb[1],this._rgb[2],t],"rgb"):this._rgb[3]};var mo=C;mo.prototype.clipped=function(){return this._rgb._clipped||!1};var Ae=C,go=tt;Ae.prototype.darken=function(t){t===void 0&&(t=1);var n=this,s=n.lab();return s[0]-=go.Kn*t,new Ae(s,"lab").alpha(n.alpha(),!0)},Ae.prototype.brighten=function(t){return t===void 0&&(t=1),this.darken(-t)},Ae.prototype.darker=Ae.prototype.darken,Ae.prototype.brighter=Ae.prototype.brighten;var vo=C;vo.prototype.get=function(t){var n=t.split("."),s=n[0],u=n[1],h=this[s]();if(u){var d=s.indexOf(u)-(s.substr(0,2)==="ok"?2:0);if(d>-1)return h[d];throw new Error("unknown channel "+u+" in mode "+s)}else return h};var Ue=C,yo=w.type,bo=Math.pow,wo=1e-7,ko=20;Ue.prototype.luminance=function(t){if(t!==void 0&&yo(t)==="number"){if(t===0)return new Ue([0,0,0,this._rgb[3]],"rgb");if(t===1)return new Ue([255,255,255,this._rgb[3]],"rgb");var n=this.luminance(),s="rgb",u=ko,h=function(l,m){var v=l.interpolate(m,.5,s),b=v.luminance();return Math.abs(t-b)<wo||!u--?v:b>t?h(l,v):h(v,m)},d=(n>t?h(new Ue([0,0,0]),this):h(this,new Ue([255,255,255]))).rgb();return new Ue(d.concat([this._rgb[3]]))}return xo.apply(void 0,this._rgb.slice(0,3))};var xo=function(t,n,s){return t=Nt(t),n=Nt(n),s=Nt(s),.2126*t+.7152*n+.0722*s},Nt=function(t){return t/=255,t<=.03928?t/12.92:bo((t+.055)/1.055,2.4)},he={},an=C,on=w.type,it=he,un=function(t,n,s){s===void 0&&(s=.5);for(var u=[],h=arguments.length-3;h-- >0;)u[h]=arguments[h+3];var d=u[0]||"lrgb";if(!it[d]&&!u.length&&(d=Object.keys(it)[0]),!it[d])throw new Error("interpolation mode "+d+" is not defined");return on(t)!=="object"&&(t=new an(t)),on(n)!=="object"&&(n=new an(n)),it[d](t,n,s).alpha(t.alpha()+s*(n.alpha()-t.alpha()))},cn=C,Eo=un;cn.prototype.mix=cn.prototype.interpolate=function(t,n){n===void 0&&(n=.5);for(var s=[],u=arguments.length-2;u-- >0;)s[u]=arguments[u+2];return Eo.apply(void 0,[this,t,n].concat(s))};var ln=C;ln.prototype.premultiply=function(t){t===void 0&&(t=!1);var n=this._rgb,s=n[3];return t?(this._rgb=[n[0]*s,n[1]*s,n[2]*s,s],this):new ln([n[0]*s,n[1]*s,n[2]*s,s],"rgb")};var Mt=C,Ao=tt;Mt.prototype.saturate=function(t){t===void 0&&(t=1);var n=this,s=n.lch();return s[1]+=Ao.Kn*t,s[1]<0&&(s[1]=0),new Mt(s,"lch").alpha(n.alpha(),!0)},Mt.prototype.desaturate=function(t){return t===void 0&&(t=1),this.saturate(-t)};var hn=C,fn=w.type;hn.prototype.set=function(t,n,s){s===void 0&&(s=!1);var u=t.split("."),h=u[0],d=u[1],l=this[h]();if(d){var m=h.indexOf(d)-(h.substr(0,2)==="ok"?2:0);if(m>-1){if(fn(n)=="string")switch(n.charAt(0)){case"+":l[m]+=+n;break;case"-":l[m]+=+n;break;case"*":l[m]*=+n.substr(1);break;case"/":l[m]/=+n.substr(1);break;default:l[m]=+n}else if(fn(n)==="number")l[m]=n;else throw new Error("unsupported value for Color.set");var v=new hn(l,h);return s?(this._rgb=v._rgb,this):v}throw new Error("unknown channel "+d+" in mode "+h)}else return l};var To=C,So=function(t,n,s){var u=t._rgb,h=n._rgb;return new To(u[0]+s*(h[0]-u[0]),u[1]+s*(h[1]-u[1]),u[2]+s*(h[2]-u[2]),"rgb")};he.rgb=So;var $o=C,It=Math.sqrt,Ve=Math.pow,zo=function(t,n,s){var u=t._rgb,h=u[0],d=u[1],l=u[2],m=n._rgb,v=m[0],b=m[1],E=m[2];return new $o(It(Ve(h,2)*(1-s)+Ve(v,2)*s),It(Ve(d,2)*(1-s)+Ve(b,2)*s),It(Ve(l,2)*(1-s)+Ve(E,2)*s),"rgb")};he.lrgb=zo;var No=C,Mo=function(t,n,s){var u=t.lab(),h=n.lab();return new No(u[0]+s*(h[0]-u[0]),u[1]+s*(h[1]-u[1]),u[2]+s*(h[2]-u[2]),"lab")};he.lab=Mo;var dn=C,Pe=function(t,n,s,u){var h,d,l,m;u==="hsl"?(l=t.hsl(),m=n.hsl()):u==="hsv"?(l=t.hsv(),m=n.hsv()):u==="hcg"?(l=t.hcg(),m=n.hcg()):u==="hsi"?(l=t.hsi(),m=n.hsi()):u==="lch"||u==="hcl"?(u="hcl",l=t.hcl(),m=n.hcl()):u==="oklch"&&(l=t.oklch().reverse(),m=n.oklch().reverse());var v,b,E,$,A,N;(u.substr(0,1)==="h"||u==="oklch")&&(h=l,v=h[0],E=h[1],A=h[2],d=m,b=d[0],$=d[1],N=d[2]);var z,L,P,B;return!isNaN(v)&&!isNaN(b)?(b>v&&b-v>180?B=b-(v+360):b<v&&v-b>180?B=b+360-v:B=b-v,L=v+s*B):isNaN(v)?isNaN(b)?L=Number.NaN:(L=b,(A==1||A==0)&&u!="hsv"&&(z=$)):(L=v,(N==1||N==0)&&u!="hsv"&&(z=E)),z===void 0&&(z=E+s*($-E)),P=A+s*(N-A),u==="oklch"?new dn([P,z,L],u):new dn([L,z,P],u)},Io=Pe,_n=function(t,n,s){return Io(t,n,s,"lch")};he.lch=_n,he.hcl=_n;var Fo=C,qo=function(t,n,s){var u=t.num(),h=n.num();return new Fo(u+s*(h-u),"num")};he.num=qo;var Co=Pe,Lo=function(t,n,s){return Co(t,n,s,"hcg")};he.hcg=Lo;var Uo=Pe,Vo=function(t,n,s){return Uo(t,n,s,"hsi")};he.hsi=Vo;var Po=Pe,Oo=function(t,n,s){return Po(t,n,s,"hsl")};he.hsl=Oo;var Bo=Pe,Ro=function(t,n,s){return Bo(t,n,s,"hsv")};he.hsv=Ro;var Go=C,Do=function(t,n,s){var u=t.oklab(),h=n.oklab();return new Go(u[0]+s*(h[0]-u[0]),u[1]+s*(h[1]-u[1]),u[2]+s*(h[2]-u[2]),"oklab")};he.oklab=Do;var Wo=Pe,jo=function(t,n,s){return Wo(t,n,s,"oklch")};he.oklch=jo;var Ft=C,Yo=w.clip_rgb,qt=Math.pow,Ct=Math.sqrt,Lt=Math.PI,pn=Math.cos,mn=Math.sin,Xo=Math.atan2,Ho=function(t,n,s){n===void 0&&(n="lrgb"),s===void 0&&(s=null);var u=t.length;s||(s=Array.from(new Array(u)).map(function(){return 1}));var h=u/s.reduce(function(L,P){return L+P});if(s.forEach(function(L,P){s[P]*=h}),t=t.map(function(L){return new Ft(L)}),n==="lrgb")return Zo(t,s);for(var d=t.shift(),l=d.get(n),m=[],v=0,b=0,E=0;E<l.length;E++)if(l[E]=(l[E]||0)*s[0],m.push(isNaN(l[E])?0:s[0]),n.charAt(E)==="h"&&!isNaN(l[E])){var $=l[E]/180*Lt;v+=pn($)*s[0],b+=mn($)*s[0]}var A=d.alpha()*s[0];t.forEach(function(L,P){var B=L.get(n);A+=L.alpha()*s[P+1];for(var D=0;D<l.length;D++)if(!isNaN(B[D]))if(m[D]+=s[P+1],n.charAt(D)==="h"){var se=B[D]/180*Lt;v+=pn(se)*s[P+1],b+=mn(se)*s[P+1]}else l[D]+=B[D]*s[P+1]});for(var N=0;N<l.length;N++)if(n.charAt(N)==="h"){for(var z=Xo(b/m[N],v/m[N])/Lt*180;z<0;)z+=360;for(;z>=360;)z-=360;l[N]=z}else l[N]=l[N]/m[N];return A/=u,new Ft(l,n).alpha(A>.99999?1:A,!0)},Zo=function(t,n){for(var s=t.length,u=[0,0,0,0],h=0;h<t.length;h++){var d=t[h],l=n[h]/s,m=d._rgb;u[0]+=qt(m[0],2)*l,u[1]+=qt(m[1],2)*l,u[2]+=qt(m[2],2)*l,u[3]+=m[3]*l}return u[0]=Ct(u[0]),u[1]=Ct(u[1]),u[2]=Ct(u[2]),u[3]>.9999999&&(u[3]=1),new Ft(Yo(u))},fe=J,Oe=w.type,Jo=Math.pow,Ut=function(t){var n="rgb",s=fe("#ccc"),u=0,h=[0,1],d=[],l=[0,0],m=!1,v=[],b=!1,E=0,$=1,A=!1,N={},z=!0,L=1,P=function(T){if(T=T||["#fff","#000"],T&&Oe(T)==="string"&&fe.brewer&&fe.brewer[T.toLowerCase()]&&(T=fe.brewer[T.toLowerCase()]),Oe(T)==="array"){T.length===1&&(T=[T[0],T[0]]),T=T.slice(0);for(var I=0;I<T.length;I++)T[I]=fe(T[I]);d.length=0;for(var V=0;V<T.length;V++)d.push(V/(T.length-1))}return le(),v=T},B=function(T){if(m!=null){for(var I=m.length-1,V=0;V<I&&T>=m[V];)V++;return V-1}return 0},D=function(T){return T},se=function(T){return T},re=function(T,I){var V,U;if(I==null&&(I=!1),isNaN(T)||T===null)return s;if(I)U=T;else if(m&&m.length>2){var ae=B(T);U=ae/(m.length-2)}else $!==E?U=(T-E)/($-E):U=1;U=se(U),I||(U=D(U)),L!==1&&(U=Jo(U,L)),U=l[0]+U*(1-l[0]-l[1]),U=Math.min(1,Math.max(0,U));var H=Math.floor(U*1e4);if(z&&N[H])V=N[H];else{if(Oe(v)==="array")for(var R=0;R<d.length;R++){var W=d[R];if(U<=W){V=v[R];break}if(U>=W&&R===d.length-1){V=v[R];break}if(U>W&&U<d[R+1]){U=(U-W)/(d[R+1]-W),V=fe.interpolate(v[R],v[R+1],U,n);break}}else Oe(v)==="function"&&(V=v(U));z&&(N[H]=V)}return V},le=function(){return N={}};P(t);var O=function(T){var I=fe(re(T));return b&&I[b]?I[b]():I};return O.classes=function(T){if(T!=null){if(Oe(T)==="array")m=T,h=[T[0],T[T.length-1]];else{var I=fe.analyze(h);T===0?m=[I.min,I.max]:m=fe.limits(I,"e",T)}return O}return m},O.domain=function(T){if(!arguments.length)return h;E=T[0],$=T[T.length-1],d=[];var I=v.length;if(T.length===I&&E!==$)for(var V=0,U=Array.from(T);V<U.length;V+=1){var ae=U[V];d.push((ae-E)/($-E))}else{for(var H=0;H<I;H++)d.push(H/(I-1));if(T.length>2){var R=T.map(function(j,Y){return Y/(T.length-1)}),W=T.map(function(j){return(j-E)/($-E)});W.every(function(j,Y){return R[Y]===j})||(se=function(j){if(j<=0||j>=1)return j;for(var Y=0;j>=W[Y+1];)Y++;var _e=(j-W[Y])/(W[Y+1]-W[Y]),xe=R[Y]+_e*(R[Y+1]-R[Y]);return xe})}}return h=[E,$],O},O.mode=function(T){return arguments.length?(n=T,le(),O):n},O.range=function(T,I){return P(T),O},O.out=function(T){return b=T,O},O.spread=function(T){return arguments.length?(u=T,O):u},O.correctLightness=function(T){return T==null&&(T=!0),A=T,le(),A?D=function(I){for(var V=re(0,!0).lab()[0],U=re(1,!0).lab()[0],ae=V>U,H=re(I,!0).lab()[0],R=V+(U-V)*I,W=H-R,j=0,Y=1,_e=20;Math.abs(W)>.01&&_e-- >0;)(function(){return ae&&(W*=-1),W<0?(j=I,I+=(Y-I)*.5):(Y=I,I+=(j-I)*.5),H=re(I,!0).lab()[0],W=H-R})();return I}:D=function(I){return I},O},O.padding=function(T){return T!=null?(Oe(T)==="number"&&(T=[T,T]),l=T,O):l},O.colors=function(T,I){arguments.length<2&&(I="hex");var V=[];if(arguments.length===0)V=v.slice(0);else if(T===1)V=[O(.5)];else if(T>1){var U=h[0],ae=h[1]-U;V=Qo(0,T).map(function(Y){return O(U+Y/(T-1)*ae)})}else{t=[];var H=[];if(m&&m.length>2)for(var R=1,W=m.length,j=1<=W;j?R<W:R>W;j?R++:R--)H.push((m[R-1]+m[R])*.5);else H=h;V=H.map(function(Y){return O(Y)})}return fe[I]&&(V=V.map(function(Y){return Y[I]()})),V},O.cache=function(T){return T!=null?(z=T,O):z},O.gamma=function(T){return T!=null?(L=T,O):L},O.nodata=function(T){return T!=null?(s=fe(T),O):s},O};function Qo(t,n,s){for(var u=[],h=t<n,d=n,l=t;h?l<d:l>d;h?l++:l--)u.push(l);return u}var He=C,Ko=Ut,eu=function(t){for(var n=[1,1],s=1;s<t;s++){for(var u=[1],h=1;h<=n.length;h++)u[h]=(n[h]||0)+n[h-1];n=u}return n},tu=function(t){var n,s,u,h,d,l,m;if(t=t.map(function(A){return new He(A)}),t.length===2)n=t.map(function(A){return A.lab()}),d=n[0],l=n[1],h=function(A){var N=[0,1,2].map(function(z){return d[z]+A*(l[z]-d[z])});return new He(N,"lab")};else if(t.length===3)s=t.map(function(A){return A.lab()}),d=s[0],l=s[1],m=s[2],h=function(A){var N=[0,1,2].map(function(z){return(1-A)*(1-A)*d[z]+2*(1-A)*A*l[z]+A*A*m[z]});return new He(N,"lab")};else if(t.length===4){var v;u=t.map(function(A){return A.lab()}),d=u[0],l=u[1],m=u[2],v=u[3],h=function(A){var N=[0,1,2].map(function(z){return(1-A)*(1-A)*(1-A)*d[z]+3*(1-A)*(1-A)*A*l[z]+3*(1-A)*A*A*m[z]+A*A*A*v[z]});return new He(N,"lab")}}else if(t.length>=5){var b,E,$;b=t.map(function(A){return A.lab()}),$=t.length-1,E=eu($),h=function(A){var N=1-A,z=[0,1,2].map(function(L){return b.reduce(function(P,B,D){return P+E[D]*Math.pow(N,$-D)*Math.pow(A,D)*B[L]},0)});return new He(z,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return h},ru=function(t){var n=tu(t);return n.scale=function(){return Ko(n)},n},Vt=J,de=function(t,n,s){if(!de[s])throw new Error("unknown blend mode "+s);return de[s](t,n)},we=function(t){return function(n,s){var u=Vt(s).rgb(),h=Vt(n).rgb();return Vt.rgb(t(u,h))}},ke=function(t){return function(n,s){var u=[];return u[0]=t(n[0],s[0]),u[1]=t(n[1],s[1]),u[2]=t(n[2],s[2]),u}},nu=function(t){return t},su=function(t,n){return t*n/255},au=function(t,n){return t>n?n:t},iu=function(t,n){return t>n?t:n},ou=function(t,n){return 255*(1-(1-t/255)*(1-n/255))},uu=function(t,n){return n<128?2*t*n/255:255*(1-2*(1-t/255)*(1-n/255))},cu=function(t,n){return 255*(1-(1-n/255)/(t/255))},lu=function(t,n){return t===255?255:(t=255*(n/255)/(1-t/255),t>255?255:t)};de.normal=we(ke(nu)),de.multiply=we(ke(su)),de.screen=we(ke(ou)),de.overlay=we(ke(uu)),de.darken=we(ke(au)),de.lighten=we(ke(iu)),de.dodge=we(ke(lu)),de.burn=we(ke(cu));for(var hu=de,Pt=w.type,fu=w.clip_rgb,du=w.TWOPI,_u=Math.pow,pu=Math.sin,mu=Math.cos,gn=J,gu=function(t,n,s,u,h){t===void 0&&(t=300),n===void 0&&(n=-1.5),s===void 0&&(s=1),u===void 0&&(u=1),h===void 0&&(h=[0,1]);var d=0,l;Pt(h)==="array"?l=h[1]-h[0]:(l=0,h=[h,h]);var m=function(v){var b=du*((t+120)/360+n*v),E=_u(h[0]+l*v,u),$=d!==0?s[0]+v*d:s,A=$*E*(1-E)/2,N=mu(b),z=pu(b),L=E+A*(-.14861*N+1.78277*z),P=E+A*(-.29227*N-.90649*z),B=E+A*(1.97294*N);return gn(fu([L*255,P*255,B*255,1]))};return m.start=function(v){return v==null?t:(t=v,m)},m.rotations=function(v){return v==null?n:(n=v,m)},m.gamma=function(v){return v==null?u:(u=v,m)},m.hue=function(v){return v==null?s:(s=v,Pt(s)==="array"?(d=s[1]-s[0],d===0&&(s=s[1])):d=0,m)},m.lightness=function(v){return v==null?h:(Pt(v)==="array"?(h=v,l=v[1]-v[0]):(h=[v,v],l=0),m)},m.scale=function(){return gn.scale(m)},m.hue(s),m},vu=C,yu="0123456789abcdef",bu=Math.floor,wu=Math.random,ku=function(){for(var t="#",n=0;n<6;n++)t+=yu.charAt(bu(wu()*16));return new vu(t,"hex")},Ot=S,vn=Math.log,xu=Math.pow,Eu=Math.floor,Au=Math.abs,yn=function(t,n){n===void 0&&(n=null);var s={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return Ot(t)==="object"&&(t=Object.values(t)),t.forEach(function(u){n&&Ot(u)==="object"&&(u=u[n]),u!=null&&!isNaN(u)&&(s.values.push(u),s.sum+=u,u<s.min&&(s.min=u),u>s.max&&(s.max=u),s.count+=1)}),s.domain=[s.min,s.max],s.limits=function(u,h){return bn(s,u,h)},s},bn=function(t,n,s){n===void 0&&(n="equal"),s===void 0&&(s=7),Ot(t)=="array"&&(t=yn(t));var u=t.min,h=t.max,d=t.values.sort(function(Rt,Gt){return Rt-Gt});if(s===1)return[u,h];var l=[];if(n.substr(0,1)==="c"&&(l.push(u),l.push(h)),n.substr(0,1)==="e"){l.push(u);for(var m=1;m<s;m++)l.push(u+m/s*(h-u));l.push(h)}else if(n.substr(0,1)==="l"){if(u<=0)throw new Error("Logarithmic scales are only possible for values > 0");var v=Math.LOG10E*vn(u),b=Math.LOG10E*vn(h);l.push(u);for(var E=1;E<s;E++)l.push(xu(10,v+E/s*(b-v)));l.push(h)}else if(n.substr(0,1)==="q"){l.push(u);for(var $=1;$<s;$++){var A=(d.length-1)*$/s,N=Eu(A);if(N===A)l.push(d[N]);else{var z=A-N;l.push(d[N]*(1-z)+d[N+1]*z)}}l.push(h)}else if(n.substr(0,1)==="k"){var L,P=d.length,B=new Array(P),D=new Array(s),se=!0,re=0,le=null;le=[],le.push(u);for(var O=1;O<s;O++)le.push(u+O/s*(h-u));for(le.push(h);se;){for(var T=0;T<s;T++)D[T]=0;for(var I=0;I<P;I++)for(var V=d[I],U=Number.MAX_VALUE,ae=void 0,H=0;H<s;H++){var R=Au(le[H]-V);R<U&&(U=R,ae=H),D[ae]++,B[I]=ae}for(var W=new Array(s),j=0;j<s;j++)W[j]=null;for(var Y=0;Y<P;Y++)L=B[Y],W[L]===null?W[L]=d[Y]:W[L]+=d[Y];for(var _e=0;_e<s;_e++)W[_e]*=1/D[_e];se=!1;for(var xe=0;xe<s;xe++)if(W[xe]!==le[xe]){se=!0;break}le=W,re++,re>200&&(se=!1)}for(var Ee={},Be=0;Be<s;Be++)Ee[Be]=[];for(var Re=0;Re<P;Re++)L=B[Re],Ee[L].push(d[Re]);for(var ve=[],Te=0;Te<s;Te++)ve.push(Ee[Te][0]),ve.push(Ee[Te][Ee[Te].length-1]);ve=ve.sort(function(Rt,Gt){return Rt-Gt}),l.push(ve[0]);for(var Ze=1;Ze<ve.length;Ze+=2){var Se=ve[Ze];!isNaN(Se)&&l.indexOf(Se)===-1&&l.push(Se)}}return l},wn={analyze:yn,limits:bn},kn=C,Tu=function(t,n){t=new kn(t),n=new kn(n);var s=t.luminance(),u=n.luminance();return s>u?(s+.05)/(u+.05):(u+.05)/(s+.05)},xn=C,ge=Math.sqrt,K=Math.pow,Su=Math.min,$u=Math.max,En=Math.atan2,An=Math.abs,ot=Math.cos,Tn=Math.sin,zu=Math.exp,Sn=Math.PI,Nu=function(t,n,s,u,h){s===void 0&&(s=1),u===void 0&&(u=1),h===void 0&&(h=1);var d=function(Se){return 360*Se/(2*Sn)},l=function(Se){return 2*Sn*Se/360};t=new xn(t),n=new xn(n);var m=Array.from(t.lab()),v=m[0],b=m[1],E=m[2],$=Array.from(n.lab()),A=$[0],N=$[1],z=$[2],L=(v+A)/2,P=ge(K(b,2)+K(E,2)),B=ge(K(N,2)+K(z,2)),D=(P+B)/2,se=.5*(1-ge(K(D,7)/(K(D,7)+K(25,7)))),re=b*(1+se),le=N*(1+se),O=ge(K(re,2)+K(E,2)),T=ge(K(le,2)+K(z,2)),I=(O+T)/2,V=d(En(E,re)),U=d(En(z,le)),ae=V>=0?V:V+360,H=U>=0?U:U+360,R=An(ae-H)>180?(ae+H+360)/2:(ae+H)/2,W=1-.17*ot(l(R-30))+.24*ot(l(2*R))+.32*ot(l(3*R+6))-.2*ot(l(4*R-63)),j=H-ae;j=An(j)<=180?j:H<=ae?j+360:j-360,j=2*ge(O*T)*Tn(l(j)/2);var Y=A-v,_e=T-O,xe=1+.015*K(L-50,2)/ge(20+K(L-50,2)),Ee=1+.045*I,Be=1+.015*I*W,Re=30*zu(-K((R-275)/25,2)),ve=2*ge(K(I,7)/(K(I,7)+K(25,7))),Te=-ve*Tn(2*l(Re)),Ze=ge(K(Y/(s*xe),2)+K(_e/(u*Ee),2)+K(j/(h*Be),2)+Te*(_e/(u*Ee))*(j/(h*Be)));return $u(0,Su(100,Ze))},$n=C,Mu=function(t,n,s){s===void 0&&(s="lab"),t=new $n(t),n=new $n(n);var u=t.get(s),h=n.get(s),d=0;for(var l in u){var m=(u[l]||0)-(h[l]||0);d+=m*m}return Math.sqrt(d)},Iu=C,Fu=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];try{return new(Function.prototype.bind.apply(Iu,[null].concat(t))),!0}catch{return!1}},zn=J,Nn=Ut,qu={cool:function(){return Nn([zn.hsl(180,1,.9),zn.hsl(250,.7,.4)])},hot:function(){return Nn(["#000","#f00","#ff0","#fff"]).mode("rgb")}},ut={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Bt=0,Mn=Object.keys(ut);Bt<Mn.length;Bt+=1){var In=Mn[Bt];ut[In.toLowerCase()]=ut[In]}var Cu=ut,te=J;te.average=Ho,te.bezier=ru,te.blend=hu,te.cubehelix=gu,te.mix=te.interpolate=un,te.random=ku,te.scale=Ut,te.analyze=wn.analyze,te.contrast=Tu,te.deltaE=Nu,te.distance=Mu,te.limits=wn.limits,te.valid=Fu,te.scales=qu,te.colors=Gr,te.brewer=Cu;var Lu=te;return Lu})})(Zn);var Hu=Zn.exports;const tl=Xu(Hu),Qt=(c,e)=>((c+e-1)/e|0)*e;function Zu(c){return Object.keys(c)}function Ju(c,e){return new Array(c).fill(0).map((r,a)=>e(a))}const Qe=c=>c&&typeof c.length=="number"&&c.buffer instanceof ArrayBuffer&&typeof c.byteLength=="number",Jn=c=>c,G=Jn({i32:{numElements:1,align:4,size:4,type:"i32",View:Int32Array},u32:{numElements:1,align:4,size:4,type:"u32",View:Uint32Array},f32:{numElements:1,align:4,size:4,type:"f32",View:Float32Array},f16:{numElements:1,align:2,size:2,type:"u16",View:Uint16Array},vec2f:{numElements:2,align:8,size:8,type:"f32",View:Float32Array},vec2i:{numElements:2,align:8,size:8,type:"i32",View:Int32Array},vec2u:{numElements:2,align:8,size:8,type:"u32",View:Uint32Array},vec2h:{numElements:2,align:4,size:4,type:"u16",View:Uint16Array},vec3i:{numElements:3,align:16,size:12,type:"i32",View:Int32Array},vec3u:{numElements:3,align:16,size:12,type:"u32",View:Uint32Array},vec3f:{numElements:3,align:16,size:12,type:"f32",View:Float32Array},vec3h:{numElements:3,align:8,size:6,type:"u16",View:Uint16Array},vec4i:{numElements:4,align:16,size:16,type:"i32",View:Int32Array},vec4u:{numElements:4,align:16,size:16,type:"u32",View:Uint32Array},vec4f:{numElements:4,align:16,size:16,type:"f32",View:Float32Array},vec4h:{numElements:4,align:8,size:8,type:"u16",View:Uint16Array},mat2x2f:{numElements:4,align:8,size:16,type:"f32",View:Float32Array},mat2x2h:{numElements:4,align:4,size:8,type:"u16",View:Uint16Array},mat3x2f:{numElements:6,align:8,size:24,type:"f32",View:Float32Array},mat3x2h:{numElements:6,align:4,size:12,type:"u16",View:Uint16Array},mat4x2f:{numElements:8,align:8,size:32,type:"f32",View:Float32Array},mat4x2h:{numElements:8,align:4,size:16,type:"u16",View:Uint16Array},mat2x3f:{numElements:8,align:16,size:32,pad:[3,1],type:"f32",View:Float32Array},mat2x3h:{numElements:8,align:8,size:16,pad:[3,1],type:"u16",View:Uint16Array},mat3x3f:{numElements:12,align:16,size:48,pad:[3,1],type:"f32",View:Float32Array},mat3x3h:{numElements:12,align:8,size:24,pad:[3,1],type:"u16",View:Uint16Array},mat4x3f:{numElements:16,align:16,size:64,pad:[3,1],type:"f32",View:Float32Array},mat4x3h:{numElements:16,align:8,size:32,pad:[3,1],type:"u16",View:Uint16Array},mat2x4f:{numElements:8,align:16,size:32,type:"f32",View:Float32Array},mat2x4h:{numElements:8,align:8,size:16,type:"u16",View:Uint16Array},mat3x4f:{numElements:12,align:16,size:48,pad:[3,1],type:"f32",View:Float32Array},mat3x4h:{numElements:12,align:8,size:24,pad:[3,1],type:"u16",View:Uint16Array},mat4x4f:{numElements:16,align:16,size:64,type:"f32",View:Float32Array},mat4x4h:{numElements:16,align:8,size:32,type:"u16",View:Uint16Array},bool:{numElements:0,align:1,size:0,type:"bool",View:Uint32Array}}),Ye=Jn({...G,"atomic<i32>":G.i32,"atomic<u32>":G.u32,"vec2<i32>":G.vec2i,"vec2<u32>":G.vec2u,"vec2<f32>":G.vec2f,"vec2<f16>":G.vec2h,"vec3<i32>":G.vec3i,"vec3<u32>":G.vec3u,"vec3<f32>":G.vec3f,"vec3<f16>":G.vec3h,"vec4<i32>":G.vec4i,"vec4<u32>":G.vec4u,"vec4<f32>":G.vec4f,"vec4<f16>":G.vec4h,"mat2x2<f32>":G.mat2x2f,"mat2x2<f16>":G.mat2x2h,"mat3x2<f32>":G.mat3x2f,"mat3x2<f16>":G.mat3x2h,"mat4x2<f32>":G.mat4x2f,"mat4x2<f16>":G.mat4x2h,"mat2x3<f32>":G.mat2x3f,"mat2x3<f16>":G.mat2x3h,"mat3x3<f32>":G.mat3x3f,"mat3x3<f16>":G.mat3x3h,"mat4x3<f32>":G.mat4x3f,"mat4x3<f16>":G.mat4x3h,"mat2x4<f32>":G.mat2x4f,"mat2x4<f16>":G.mat2x4h,"mat3x4<f32>":G.mat3x4f,"mat3x4<f16>":G.mat3x4h,"mat4x4<f32>":G.mat4x4f,"mat4x4<f16>":G.mat4x4h}),Qu=Zu(Ye);function Ku(c=[],e){const r=new Set;for(const a of Qu){const o=Ye[a];r.has(o)||(r.add(o),o.flatten=c.includes(a)?e:!e)}}Ku();function ec(c){const e=c;if(e.elementType)return e.size;{const a=c,o=e.numElements||1;if(a.fields)return c.size*o;{const f=c,{align:y}=Ye[f.type];return o>1?Qt(c.size,y)*o:c.size}}}function Un(c,e,r,a){const{size:o,type:f}=c;try{const{View:y,align:k}=Ye[f],x=a!==void 0,S=x?Qt(o,k):o,M=S/y.BYTES_PER_ELEMENT,q=x?a===0?(e.byteLength-r)/S:a:1;return new y(e,r,M*q)}catch{throw new Error(`unknown type: ${f}`)}}function tc(c){return!c.fields&&!c.elementType}function rc(c,e,r){const a=r||0,o=new ArrayBuffer(ec(c)),f=(y,k)=>{const x=y,S=x.elementType;if(S){if(tc(S)&&Ye[S.type].flatten)return Un(S,o,k,x.numElements);{const{size:M}=Qn(y),q=x.numElements===0?(o.byteLength-k)/M:x.numElements;return Ju(q,X=>f(S,k+M*X))}}else{if(typeof y=="string")throw Error("unreachable");{const M=y.fields;if(M){const q={};for(const[X,{type:ie,offset:oe}]of Object.entries(M))q[X]=f(ie,k+oe);return q}else return Un(y,o,k)}}};return{views:f(c,a),arrayBuffer:o}}function Yt(c,e){if(c!==void 0)if(Qe(e)){const r=e;if(r.length===1&&typeof c=="number")r[0]=c;else if(Array.isArray(c[0])||Qe(c[0])){const a=c[0].length,o=a===3?4:a;for(let f=0;f<c.length;++f){const y=f*o;r.set(c[f],y)}}else r.set(c)}else if(Array.isArray(e)){const r=e;c.forEach((a,o)=>{Yt(a,r[o])})}else{const r=e;for(const[a,o]of Object.entries(c)){const f=r[a];f&&Yt(o,f)}}}function rl(c,e,r=0){const a=c,o=a.group===void 0?c:a.typeDefinition,f=rc(o,e,r);return{...f,set(y){Yt(y,f.views)}}}function Xt(c){const r=c.elementType;if(r)return Xt(r);const o=c.fields;if(o)return Object.values(o).reduce((k,{type:x})=>Math.max(k,Xt(x)),0);const{type:f}=c,{align:y}=Ye[f];return y}function Qn(c){const r=c.elementType;if(r){const f=r.size,y=Xt(r);return{unalignedSize:f,align:y,size:Qt(f,y)}}const o=c.fields;if(o){const f=Object.values(o).pop();if(f.type.size===0)return Qn(f.type)}return{size:0,unalignedSize:0,align:1}}class nc{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class be{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,r){if(e){r(ft.instance);for(const a of e)a instanceof Array?this.searchBlock(a,r):a.search(r);r(dt.instance)}}}class ft extends be{}ft.instance=new ft;class dt extends be{}dt.instance=new dt;class Z extends be{constructor(){super()}}let Ht=class extends Z{constructor(e,r,a,o,f,y){super(),this.calls=new Set,this.name=e,this.args=r,this.returnType=a,this.body=o,this.startLine=f,this.endLine=y}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}};class sc extends Z{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class ac extends Z{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class ic extends Z{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class oc extends Z{constructor(e,r,a,o){super(),this.init=e,this.condition=r,this.increment=a,this.body=o}get astNodeType(){return"for"}search(e){var r,a,o;(r=this.init)===null||r===void 0||r.search(e),(a=this.condition)===null||a===void 0||a.search(e),(o=this.increment)===null||o===void 0||o.search(e),this.searchBlock(this.body,e)}}class ze extends Z{constructor(e,r,a,o,f){super(),this.name=e,this.type=r,this.storage=a,this.access=o,this.value=f}get astNodeType(){return"var"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class Kn extends Z{constructor(e,r,a){super(),this.name=e,this.type=r,this.value=a}get astNodeType(){return"override"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class Zt extends Z{constructor(e,r,a,o,f){super(),this.name=e,this.type=r,this.storage=a,this.access=o,this.value=f}get astNodeType(){return"let"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class Vn extends Z{constructor(e,r,a,o,f){super(),this.name=e,this.type=r,this.storage=a,this.access=o,this.value=f}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}var je;(function(c){c.increment="++",c.decrement="--"})(je||(je={}));(function(c){function e(r){const a=r;if(a=="parse")throw new Error("Invalid value for IncrementOperator");return c[a]}c.parse=e})(je||(je={}));class uc extends Z{constructor(e,r){super(),this.operator=e,this.variable=r}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var Ke;(function(c){c.assign="=",c.addAssign="+=",c.subtractAssin="-=",c.multiplyAssign="*=",c.divideAssign="/=",c.moduloAssign="%=",c.andAssign="&=",c.orAssign="|=",c.xorAssign="^=",c.shiftLeftAssign="<<=",c.shiftRightAssign=">>="})(Ke||(Ke={}));(function(c){function e(r){const a=r;if(a=="parse")throw new Error("Invalid value for AssignOperator");return a}c.parse=e})(Ke||(Ke={}));class cc extends Z{constructor(e,r,a){super(),this.operator=e,this.variable=r,this.value=a}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class es extends Z{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"call"}search(e){for(const r of this.args)r.search(e);e(this)}}class lc extends Z{constructor(e,r){super(),this.body=e,this.continuing=r}get astNodeType(){return"loop"}}class hc extends Z{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"body"}}class fc extends Z{constructor(e,r,a,o){super(),this.condition=e,this.body=r,this.elseif=a,this.else=o}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class dc extends Z{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class _c extends Z{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class pc extends Z{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class mc extends Z{constructor(e,r){super(),this.severity=e,this.rule=r}get astNodeType(){return"diagnostic"}}class ts extends Z{constructor(e,r){super(),this.name=e,this.type=r}get astNodeType(){return"alias"}}class gc extends Z{constructor(){super()}get astNodeType(){return"discard"}}class vc extends Z{constructor(){super()}get astNodeType(){return"break"}}class yc extends Z{constructor(){super()}get astNodeType(){return"continue"}}class Ne extends Z{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class $e extends Ne{constructor(e,r,a,o){super(e),this.members=r,this.startLine=a,this.endLine=o}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let r=0;r<this.members.length;r++)if(this.members[r].name==e)return r;return-1}}class rs extends Ne{constructor(e,r,a){super(e),this.format=r,this.access=a}get astNodeType(){return"template"}}class bc extends Ne{constructor(e,r,a,o){super(e),this.storage=r,this.type=a,this.access=o}get astNodeType(){return"pointer"}}class ns extends Ne{constructor(e,r,a,o){super(e),this.attributes=r,this.format=a,this.count=o}get astNodeType(){return"array"}get isArray(){return!0}}class Je extends Ne{constructor(e,r,a){super(e),this.format=r,this.access=a}get astNodeType(){return"sampler"}}class pe extends be{constructor(){super()}}class Pn extends pe{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class De extends pe{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"createExpr"}search(e){e(this);for(const r of this.args)r.search(e)}}class ss extends pe{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const r of this.args)r.search(e);e(this)}}class Jt extends pe{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const r=e.constants.get(this.name);if(!r)throw new Error("Cannot evaluate node");return r.evaluate(e)}}class On extends pe{constructor(e,r){super(),this.name=e,this.initializer=r}get astNodeType(){return"constExpr"}evaluate(e){var r,a;if(this.initializer instanceof De){const o=(r=this.postfix)===null||r===void 0?void 0:r.evaluateString(e),f=(a=this.initializer.type)===null||a===void 0?void 0:a.name,y=e.structs.get(f),k=y==null?void 0:y.getMemberIndex(o);if(k!=-1)return this.initializer.args[k].evaluate(e);console.log(k)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class Bn extends pe{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class wc extends pe{constructor(e,r){super(),this.type=e,this.value=r}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class kc extends pe{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}search(e){this.searchBlock(this.args,e)}}class Rn extends pe{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class xc extends pe{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class as extends pe{constructor(){super()}}class Ec extends as{constructor(e,r){super(),this.operator=e,this.right=r}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class me extends as{constructor(e,r,a){super(),this.operator=e,this.left=r,this.right=a}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class is extends be{constructor(){super()}}class Ac extends is{constructor(e,r){super(),this.selector=e,this.body=r}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class Tc extends is{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Sc extends be{constructor(e,r,a){super(),this.name=e,this.type=r,this.attributes=a}get astNodeType(){return"argument"}}class $c extends be{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class zc extends be{constructor(e,r,a){super(),this.name=e,this.type=r,this.attributes=a}get astNodeType(){return"member"}}class Gn extends be{constructor(e,r){super(),this.name=e,this.value=r}get astNodeType(){return"attribute"}}var g,_;(function(c){c[c.token=0]="token",c[c.keyword=1]="keyword",c[c.reserved=2]="reserved"})(_||(_={}));class p{constructor(e,r,a){this.name=e,this.type=r,this.rule=a}toString(){return this.name}}class i{}g=i;i.none=new p("",_.reserved,"");i.eof=new p("EOF",_.token,"");i.reserved={asm:new p("asm",_.reserved,"asm"),bf16:new p("bf16",_.reserved,"bf16"),do:new p("do",_.reserved,"do"),enum:new p("enum",_.reserved,"enum"),f16:new p("f16",_.reserved,"f16"),f64:new p("f64",_.reserved,"f64"),handle:new p("handle",_.reserved,"handle"),i8:new p("i8",_.reserved,"i8"),i16:new p("i16",_.reserved,"i16"),i64:new p("i64",_.reserved,"i64"),mat:new p("mat",_.reserved,"mat"),premerge:new p("premerge",_.reserved,"premerge"),regardless:new p("regardless",_.reserved,"regardless"),typedef:new p("typedef",_.reserved,"typedef"),u8:new p("u8",_.reserved,"u8"),u16:new p("u16",_.reserved,"u16"),u64:new p("u64",_.reserved,"u64"),unless:new p("unless",_.reserved,"unless"),using:new p("using",_.reserved,"using"),vec:new p("vec",_.reserved,"vec"),void:new p("void",_.reserved,"void")};i.keywords={array:new p("array",_.keyword,"array"),atomic:new p("atomic",_.keyword,"atomic"),bool:new p("bool",_.keyword,"bool"),f32:new p("f32",_.keyword,"f32"),i32:new p("i32",_.keyword,"i32"),mat2x2:new p("mat2x2",_.keyword,"mat2x2"),mat2x3:new p("mat2x3",_.keyword,"mat2x3"),mat2x4:new p("mat2x4",_.keyword,"mat2x4"),mat3x2:new p("mat3x2",_.keyword,"mat3x2"),mat3x3:new p("mat3x3",_.keyword,"mat3x3"),mat3x4:new p("mat3x4",_.keyword,"mat3x4"),mat4x2:new p("mat4x2",_.keyword,"mat4x2"),mat4x3:new p("mat4x3",_.keyword,"mat4x3"),mat4x4:new p("mat4x4",_.keyword,"mat4x4"),ptr:new p("ptr",_.keyword,"ptr"),sampler:new p("sampler",_.keyword,"sampler"),sampler_comparison:new p("sampler_comparison",_.keyword,"sampler_comparison"),struct:new p("struct",_.keyword,"struct"),texture_1d:new p("texture_1d",_.keyword,"texture_1d"),texture_2d:new p("texture_2d",_.keyword,"texture_2d"),texture_2d_array:new p("texture_2d_array",_.keyword,"texture_2d_array"),texture_3d:new p("texture_3d",_.keyword,"texture_3d"),texture_cube:new p("texture_cube",_.keyword,"texture_cube"),texture_cube_array:new p("texture_cube_array",_.keyword,"texture_cube_array"),texture_multisampled_2d:new p("texture_multisampled_2d",_.keyword,"texture_multisampled_2d"),texture_storage_1d:new p("texture_storage_1d",_.keyword,"texture_storage_1d"),texture_storage_2d:new p("texture_storage_2d",_.keyword,"texture_storage_2d"),texture_storage_2d_array:new p("texture_storage_2d_array",_.keyword,"texture_storage_2d_array"),texture_storage_3d:new p("texture_storage_3d",_.keyword,"texture_storage_3d"),texture_depth_2d:new p("texture_depth_2d",_.keyword,"texture_depth_2d"),texture_depth_2d_array:new p("texture_depth_2d_array",_.keyword,"texture_depth_2d_array"),texture_depth_cube:new p("texture_depth_cube",_.keyword,"texture_depth_cube"),texture_depth_cube_array:new p("texture_depth_cube_array",_.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new p("texture_depth_multisampled_2d",_.keyword,"texture_depth_multisampled_2d"),texture_external:new p("texture_external",_.keyword,"texture_external"),u32:new p("u32",_.keyword,"u32"),vec2:new p("vec2",_.keyword,"vec2"),vec3:new p("vec3",_.keyword,"vec3"),vec4:new p("vec4",_.keyword,"vec4"),bitcast:new p("bitcast",_.keyword,"bitcast"),block:new p("block",_.keyword,"block"),break:new p("break",_.keyword,"break"),case:new p("case",_.keyword,"case"),continue:new p("continue",_.keyword,"continue"),continuing:new p("continuing",_.keyword,"continuing"),default:new p("default",_.keyword,"default"),diagnostic:new p("diagnostic",_.keyword,"diagnostic"),discard:new p("discard",_.keyword,"discard"),else:new p("else",_.keyword,"else"),enable:new p("enable",_.keyword,"enable"),fallthrough:new p("fallthrough",_.keyword,"fallthrough"),false:new p("false",_.keyword,"false"),fn:new p("fn",_.keyword,"fn"),for:new p("for",_.keyword,"for"),function:new p("function",_.keyword,"function"),if:new p("if",_.keyword,"if"),let:new p("let",_.keyword,"let"),const:new p("const",_.keyword,"const"),loop:new p("loop",_.keyword,"loop"),while:new p("while",_.keyword,"while"),private:new p("private",_.keyword,"private"),read:new p("read",_.keyword,"read"),read_write:new p("read_write",_.keyword,"read_write"),return:new p("return",_.keyword,"return"),requires:new p("requires",_.keyword,"requires"),storage:new p("storage",_.keyword,"storage"),switch:new p("switch",_.keyword,"switch"),true:new p("true",_.keyword,"true"),alias:new p("alias",_.keyword,"alias"),type:new p("type",_.keyword,"type"),uniform:new p("uniform",_.keyword,"uniform"),var:new p("var",_.keyword,"var"),override:new p("override",_.keyword,"override"),workgroup:new p("workgroup",_.keyword,"workgroup"),write:new p("write",_.keyword,"write"),r8unorm:new p("r8unorm",_.keyword,"r8unorm"),r8snorm:new p("r8snorm",_.keyword,"r8snorm"),r8uint:new p("r8uint",_.keyword,"r8uint"),r8sint:new p("r8sint",_.keyword,"r8sint"),r16uint:new p("r16uint",_.keyword,"r16uint"),r16sint:new p("r16sint",_.keyword,"r16sint"),r16float:new p("r16float",_.keyword,"r16float"),rg8unorm:new p("rg8unorm",_.keyword,"rg8unorm"),rg8snorm:new p("rg8snorm",_.keyword,"rg8snorm"),rg8uint:new p("rg8uint",_.keyword,"rg8uint"),rg8sint:new p("rg8sint",_.keyword,"rg8sint"),r32uint:new p("r32uint",_.keyword,"r32uint"),r32sint:new p("r32sint",_.keyword,"r32sint"),r32float:new p("r32float",_.keyword,"r32float"),rg16uint:new p("rg16uint",_.keyword,"rg16uint"),rg16sint:new p("rg16sint",_.keyword,"rg16sint"),rg16float:new p("rg16float",_.keyword,"rg16float"),rgba8unorm:new p("rgba8unorm",_.keyword,"rgba8unorm"),rgba8unorm_srgb:new p("rgba8unorm_srgb",_.keyword,"rgba8unorm_srgb"),rgba8snorm:new p("rgba8snorm",_.keyword,"rgba8snorm"),rgba8uint:new p("rgba8uint",_.keyword,"rgba8uint"),rgba8sint:new p("rgba8sint",_.keyword,"rgba8sint"),bgra8unorm:new p("bgra8unorm",_.keyword,"bgra8unorm"),bgra8unorm_srgb:new p("bgra8unorm_srgb",_.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new p("rgb10a2unorm",_.keyword,"rgb10a2unorm"),rg11b10float:new p("rg11b10float",_.keyword,"rg11b10float"),rg32uint:new p("rg32uint",_.keyword,"rg32uint"),rg32sint:new p("rg32sint",_.keyword,"rg32sint"),rg32float:new p("rg32float",_.keyword,"rg32float"),rgba16uint:new p("rgba16uint",_.keyword,"rgba16uint"),rgba16sint:new p("rgba16sint",_.keyword,"rgba16sint"),rgba16float:new p("rgba16float",_.keyword,"rgba16float"),rgba32uint:new p("rgba32uint",_.keyword,"rgba32uint"),rgba32sint:new p("rgba32sint",_.keyword,"rgba32sint"),rgba32float:new p("rgba32float",_.keyword,"rgba32float"),static_assert:new p("static_assert",_.keyword,"static_assert")};i.tokens={decimal_float_literal:new p("decimal_float_literal",_.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new p("hex_float_literal",_.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new p("int_literal",_.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new p("uint_literal",_.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new p("ident",_.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new p("and",_.token,"&"),and_and:new p("and_and",_.token,"&&"),arrow:new p("arrow ",_.token,"->"),attr:new p("attr",_.token,"@"),attr_left:new p("attr_left",_.token,"[["),attr_right:new p("attr_right",_.token,"]]"),forward_slash:new p("forward_slash",_.token,"/"),bang:new p("bang",_.token,"!"),bracket_left:new p("bracket_left",_.token,"["),bracket_right:new p("bracket_right",_.token,"]"),brace_left:new p("brace_left",_.token,"{"),brace_right:new p("brace_right",_.token,"}"),colon:new p("colon",_.token,":"),comma:new p("comma",_.token,","),equal:new p("equal",_.token,"="),equal_equal:new p("equal_equal",_.token,"=="),not_equal:new p("not_equal",_.token,"!="),greater_than:new p("greater_than",_.token,">"),greater_than_equal:new p("greater_than_equal",_.token,">="),shift_right:new p("shift_right",_.token,">>"),less_than:new p("less_than",_.token,"<"),less_than_equal:new p("less_than_equal",_.token,"<="),shift_left:new p("shift_left",_.token,"<<"),modulo:new p("modulo",_.token,"%"),minus:new p("minus",_.token,"-"),minus_minus:new p("minus_minus",_.token,"--"),period:new p("period",_.token,"."),plus:new p("plus",_.token,"+"),plus_plus:new p("plus_plus",_.token,"++"),or:new p("or",_.token,"|"),or_or:new p("or_or",_.token,"||"),paren_left:new p("paren_left",_.token,"("),paren_right:new p("paren_right",_.token,")"),semicolon:new p("semicolon",_.token,";"),star:new p("star",_.token,"*"),tilde:new p("tilde",_.token,"~"),underscore:new p("underscore",_.token,"_"),xor:new p("xor",_.token,"^"),plus_equal:new p("plus_equal",_.token,"+="),minus_equal:new p("minus_equal",_.token,"-="),times_equal:new p("times_equal",_.token,"*="),division_equal:new p("division_equal",_.token,"/="),modulo_equal:new p("modulo_equal",_.token,"%="),and_equal:new p("and_equal",_.token,"&="),or_equal:new p("or_equal",_.token,"|="),xor_equal:new p("xor_equal",_.token,"^="),shift_right_equal:new p("shift_right_equal",_.token,">>="),shift_left_equal:new p("shift_left_equal",_.token,"<<=")};i.simpleTokens={"@":g.tokens.attr,"{":g.tokens.brace_left,"}":g.tokens.brace_right,":":g.tokens.colon,",":g.tokens.comma,"(":g.tokens.paren_left,")":g.tokens.paren_right,";":g.tokens.semicolon};i.literalTokens={"&":g.tokens.and,"&&":g.tokens.and_and,"->":g.tokens.arrow,"[[":g.tokens.attr_left,"]]":g.tokens.attr_right,"/":g.tokens.forward_slash,"!":g.tokens.bang,"[":g.tokens.bracket_left,"]":g.tokens.bracket_right,"=":g.tokens.equal,"==":g.tokens.equal_equal,"!=":g.tokens.not_equal,">":g.tokens.greater_than,">=":g.tokens.greater_than_equal,">>":g.tokens.shift_right,"<":g.tokens.less_than,"<=":g.tokens.less_than_equal,"<<":g.tokens.shift_left,"%":g.tokens.modulo,"-":g.tokens.minus,"--":g.tokens.minus_minus,".":g.tokens.period,"+":g.tokens.plus,"++":g.tokens.plus_plus,"|":g.tokens.or,"||":g.tokens.or_or,"*":g.tokens.star,"~":g.tokens.tilde,_:g.tokens.underscore,"^":g.tokens.xor,"+=":g.tokens.plus_equal,"-=":g.tokens.minus_equal,"*=":g.tokens.times_equal,"/=":g.tokens.division_equal,"%=":g.tokens.modulo_equal,"&=":g.tokens.and_equal,"|=":g.tokens.or_equal,"^=":g.tokens.xor_equal,">>=":g.tokens.shift_right_equal,"<<=":g.tokens.shift_left_equal};i.regexTokens={decimal_float_literal:g.tokens.decimal_float_literal,hex_float_literal:g.tokens.hex_float_literal,int_literal:g.tokens.int_literal,uint_literal:g.tokens.uint_literal,ident:g.tokens.ident};i.storage_class=[g.keywords.function,g.keywords.private,g.keywords.workgroup,g.keywords.uniform,g.keywords.storage];i.access_mode=[g.keywords.read,g.keywords.write,g.keywords.read_write];i.sampler_type=[g.keywords.sampler,g.keywords.sampler_comparison];i.sampled_texture_type=[g.keywords.texture_1d,g.keywords.texture_2d,g.keywords.texture_2d_array,g.keywords.texture_3d,g.keywords.texture_cube,g.keywords.texture_cube_array];i.multisampled_texture_type=[g.keywords.texture_multisampled_2d];i.storage_texture_type=[g.keywords.texture_storage_1d,g.keywords.texture_storage_2d,g.keywords.texture_storage_2d_array,g.keywords.texture_storage_3d];i.depth_texture_type=[g.keywords.texture_depth_2d,g.keywords.texture_depth_2d_array,g.keywords.texture_depth_cube,g.keywords.texture_depth_cube_array,g.keywords.texture_depth_multisampled_2d];i.texture_external_type=[g.keywords.texture_external];i.any_texture_type=[...g.sampled_texture_type,...g.multisampled_texture_type,...g.storage_texture_type,...g.depth_texture_type,...g.texture_external_type];i.texel_format=[g.keywords.r8unorm,g.keywords.r8snorm,g.keywords.r8uint,g.keywords.r8sint,g.keywords.r16uint,g.keywords.r16sint,g.keywords.r16float,g.keywords.rg8unorm,g.keywords.rg8snorm,g.keywords.rg8uint,g.keywords.rg8sint,g.keywords.r32uint,g.keywords.r32sint,g.keywords.r32float,g.keywords.rg16uint,g.keywords.rg16sint,g.keywords.rg16float,g.keywords.rgba8unorm,g.keywords.rgba8unorm_srgb,g.keywords.rgba8snorm,g.keywords.rgba8uint,g.keywords.rgba8sint,g.keywords.bgra8unorm,g.keywords.bgra8unorm_srgb,g.keywords.rgb10a2unorm,g.keywords.rg11b10float,g.keywords.rg32uint,g.keywords.rg32sint,g.keywords.rg32float,g.keywords.rgba16uint,g.keywords.rgba16sint,g.keywords.rgba16float,g.keywords.rgba32uint,g.keywords.rgba32sint,g.keywords.rgba32float];i.const_literal=[g.tokens.int_literal,g.tokens.uint_literal,g.tokens.decimal_float_literal,g.tokens.hex_float_literal,g.keywords.true,g.keywords.false];i.literal_or_ident=[g.tokens.ident,g.tokens.int_literal,g.tokens.uint_literal,g.tokens.decimal_float_literal,g.tokens.hex_float_literal];i.element_count_expression=[g.tokens.int_literal,g.tokens.uint_literal,g.tokens.ident];i.template_types=[g.keywords.vec2,g.keywords.vec3,g.keywords.vec4,g.keywords.mat2x2,g.keywords.mat2x3,g.keywords.mat2x4,g.keywords.mat3x2,g.keywords.mat3x3,g.keywords.mat3x4,g.keywords.mat4x2,g.keywords.mat4x3,g.keywords.mat4x4,g.keywords.atomic,g.keywords.bitcast,...g.any_texture_type];i.attribute_name=[g.tokens.ident,g.keywords.block,g.keywords.diagnostic];i.assignment_operators=[g.tokens.equal,g.tokens.plus_equal,g.tokens.minus_equal,g.tokens.times_equal,g.tokens.division_equal,g.tokens.modulo_equal,g.tokens.and_equal,g.tokens.or_equal,g.tokens.xor_equal,g.tokens.shift_right_equal,g.tokens.shift_left_equal];i.increment_operators=[g.tokens.plus_plus,g.tokens.minus_minus];class Dn{constructor(e,r,a){this.type=e,this.lexeme=r,this.line=a}toString(){return this.lexeme}isTemplateType(){return i.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==i.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Nc{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Dn(i.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let y=1;for(;y>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),y--,y==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),y++)}return!0}}const r=i.simpleTokens[e];if(r)return this._addToken(r),!0;let a=i.none;const o=this._isAlpha(e),f=e==="_";if(this._isAlphaNumeric(e)){let y=this._peekAhead();for(;this._isAlphaNumeric(y);)e+=this._advance(),y=this._peekAhead()}if(o){const y=i.keywords[e];if(y)return this._addToken(y),!0}if(o||f)return this._addToken(i.tokens.ident),!0;for(;;){let y=this._findType(e);const k=this._peekAhead();if(e==">"&&(k==">"||k=="=")){let x=!1,S=this._tokens.length-1;for(let M=0;M<5&&S>=0;++M,--S)if(this._tokens[S].type===i.tokens.less_than){S>0&&this._tokens[S-1].isArrayOrTemplateType()&&(x=!0);break}if(x)return this._addToken(y),!0}if(y===i.none){let x=e,S=0;const M=2;for(let q=0;q<M;++q)if(x+=this._peekAhead(q),y=this._findType(x),y!==i.none){S=q;break}if(y===i.none)return a===i.none?!1:(this._current--,this._addToken(a),!0);e=x,this._current+=S+1}if(a=y,this._isAtEnd())break;e+=this._advance()}return a===i.none?!1:(this._addToken(a),!0)}_findType(e){for(const a in i.regexTokens){const o=i.regexTokens[a];if(this._match(e,o.rule))return o}const r=i.literalTokens[e];return r||i.none}_match(e,r){const a=r.exec(e);return a&&a.index==0&&a[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let r=this._source[this._current];return e=e||0,e++,this._current+=e,r}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const r=this._source.substring(this._start,this._current);this._tokens.push(new Dn(e,r,this._line))}}class Mc{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new nc,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const r=[];for(;!this._isAtEnd();){const a=this._global_decl_or_directive();if(!a)break;r.push(a)}if(this._deferArrayCountEval.length>0){for(const a of this._deferArrayCountEval){const o=a.arrayType,f=a.countNode;if(f instanceof Jt){const k=f.name,x=this._context.constants.get(k);if(x)try{const S=x.evaluate(this._context);o.count=S}catch{}}}this._deferArrayCountEval.length=0}return r}_initialize(e){if(e)if(typeof e=="string"){const r=new Nc(e);this._tokens=r.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,r){return{token:e,message:r,toString:function(){return`${r}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==i.eof}_match(e){if(e instanceof p)return this._check(e)?(this._advance(),!0):!1;for(let r=0,a=e.length;r<a;++r){const o=e[r];if(this._check(o))return this._advance(),!0}return!1}_consume(e,r){if(this._check(e))return this._advance();throw this._error(this._peek(),r)}_check(e){if(this._isAtEnd())return!1;const r=this._peek();if(e instanceof Array){const a=r.type;return e.indexOf(a)!=-1}return r.type==e}_advance(){var e,r;return this._currentLine=(r=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(i.tokens.semicolon)&&!this._isAtEnd(););if(this._match(i.keywords.alias)){const r=this._type_alias();return this._consume(i.tokens.semicolon,"Expected ';'"),r}if(this._match(i.keywords.diagnostic)){const r=this._diagnostic();return this._consume(i.tokens.semicolon,"Expected ';'"),r}if(this._match(i.keywords.requires)){const r=this._requires_directive();return this._consume(i.tokens.semicolon,"Expected ';'"),r}if(this._match(i.keywords.enable)){const r=this._enable_directive();return this._consume(i.tokens.semicolon,"Expected ';'"),r}const e=this._attribute();if(this._check(i.keywords.var)){const r=this._global_variable_decl();return r!=null&&(r.attributes=e),this._consume(i.tokens.semicolon,"Expected ';'."),r}if(this._check(i.keywords.override)){const r=this._override_variable_decl();return r!=null&&(r.attributes=e),this._consume(i.tokens.semicolon,"Expected ';'."),r}if(this._check(i.keywords.let)){const r=this._global_let_decl();return r!=null&&(r.attributes=e),this._consume(i.tokens.semicolon,"Expected ';'."),r}if(this._check(i.keywords.const)){const r=this._global_const_decl();return r!=null&&(r.attributes=e),this._consume(i.tokens.semicolon,"Expected ';'."),r}if(this._check(i.keywords.struct)){const r=this._struct_decl();return r!=null&&(r.attributes=e),r}if(this._check(i.keywords.fn)){const r=this._function_decl();return r!=null&&(r.attributes=e),r}return null}_function_decl(){if(!this._match(i.keywords.fn))return null;const e=this._currentLine,r=this._consume(i.tokens.ident,"Expected function name.").toString();this._consume(i.tokens.paren_left,"Expected '(' for function arguments.");const a=[];if(!this._check(i.tokens.paren_right))do{if(this._check(i.tokens.paren_right))break;const k=this._attribute(),x=this._consume(i.tokens.ident,"Expected argument name.").toString();this._consume(i.tokens.colon,"Expected ':' for argument type.");const S=this._attribute(),M=this._type_decl();M!=null&&(M.attributes=S,a.push(new Sc(x,M,k)))}while(this._match(i.tokens.comma));this._consume(i.tokens.paren_right,"Expected ')' after function arguments.");let o=null;if(this._match(i.tokens.arrow)){const k=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=k)}const f=this._compound_statement(),y=this._currentLine;return new Ht(r,a,o,f,e,y)}_compound_statement(){const e=[];for(this._consume(i.tokens.brace_left,"Expected '{' for block.");!this._check(i.tokens.brace_right);){const r=this._statement();r!==null&&e.push(r)}return this._consume(i.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(i.tokens.semicolon)&&!this._isAtEnd(););if(this._check(i.tokens.attr)&&this._attribute(),this._check(i.keywords.if))return this._if_statement();if(this._check(i.keywords.switch))return this._switch_statement();if(this._check(i.keywords.loop))return this._loop_statement();if(this._check(i.keywords.for))return this._for_statement();if(this._check(i.keywords.while))return this._while_statement();if(this._check(i.keywords.continuing))return this._continuing_statement();if(this._check(i.keywords.static_assert))return this._static_assert_statement();if(this._check(i.tokens.brace_left))return this._compound_statement();let e=null;return this._check(i.keywords.return)?e=this._return_statement():this._check([i.keywords.var,i.keywords.let,i.keywords.const])?e=this._variable_statement():this._match(i.keywords.discard)?e=new gc:this._match(i.keywords.break)?e=new vc:this._match(i.keywords.continue)?e=new yc:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(i.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(i.keywords.static_assert))return null;const e=this._optional_paren_expression();return new sc(e)}_while_statement(){if(!this._match(i.keywords.while))return null;const e=this._optional_paren_expression();this._check(i.tokens.attr)&&this._attribute();const r=this._compound_statement();return new ac(e,r)}_continuing_statement(){if(!this._match(i.keywords.continuing))return null;const e=this._compound_statement();return new ic(e)}_for_statement(){if(!this._match(i.keywords.for))return null;this._consume(i.tokens.paren_left,"Expected '('.");const e=this._check(i.tokens.semicolon)?null:this._for_init();this._consume(i.tokens.semicolon,"Expected ';'.");const r=this._check(i.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(i.tokens.semicolon,"Expected ';'.");const a=this._check(i.tokens.paren_right)?null:this._for_increment();this._consume(i.tokens.paren_right,"Expected ')'."),this._check(i.tokens.attr)&&this._attribute();const o=this._compound_statement();return new oc(e,r,a,o)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(i.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(i.tokens.equal)&&(r=this._short_circuit_or_expression()),new ze(e.name,e.type,e.storage,e.access,r)}if(this._match(i.keywords.let)){const e=this._consume(i.tokens.ident,"Expected name for let.").toString();let r=null;if(this._match(i.tokens.colon)){const o=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=o)}this._consume(i.tokens.equal,"Expected '=' for let.");const a=this._short_circuit_or_expression();return new Zt(e,r,null,null,a)}if(this._match(i.keywords.const)){const e=this._consume(i.tokens.ident,"Expected name for const.").toString();let r=null;if(this._match(i.tokens.colon)){const o=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=o)}this._consume(i.tokens.equal,"Expected '=' for const.");const a=this._short_circuit_or_expression();return new Vn(e,r,null,null,a)}return null}_increment_decrement_statement(){const e=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(i.increment_operators))return this._current=e,null;const a=this._consume(i.increment_operators,"Expected increment operator");return new uc(a.type===i.tokens.plus_plus?je.increment:je.decrement,r)}_assignment_statement(){let e=null;if(this._check(i.tokens.brace_right))return null;let r=this._match(i.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const a=this._consume(i.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return new cc(Ke.parse(a.lexeme),e,o)}_func_call_statement(){if(!this._check(i.tokens.ident))return null;const e=this._current,r=this._consume(i.tokens.ident,"Expected function name."),a=this._argument_expression_list();return a===null?(this._current=e,null):new es(r.lexeme,a)}_loop_statement(){if(!this._match(i.keywords.loop))return null;this._check(i.tokens.attr)&&this._attribute(),this._consume(i.tokens.brace_left,"Expected '{' for loop.");const e=[];let r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let o of r)e.push(o);else e.push(r);r=this._statement()}let a=null;return this._match(i.keywords.continuing)&&(a=this._compound_statement()),this._consume(i.tokens.brace_right,"Expected '}' for loop."),new lc(e,a)}_switch_statement(){if(!this._match(i.keywords.switch))return null;const e=this._optional_paren_expression();this._check(i.tokens.attr)&&this._attribute(),this._consume(i.tokens.brace_left,"Expected '{' for switch.");const r=this._switch_body();if(r==null||r.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(i.tokens.brace_right,"Expected '}' for switch."),new hc(e,r)}_switch_body(){const e=[];if(this._match(i.keywords.case)){const r=this._case_selectors();this._match(i.tokens.colon),this._check(i.tokens.attr)&&this._attribute(),this._consume(i.tokens.brace_left,"Exected '{' for switch case.");const a=this._case_body();this._consume(i.tokens.brace_right,"Exected '}' for switch case."),e.push(new Ac(r,a))}if(this._match(i.keywords.default)){this._match(i.tokens.colon),this._check(i.tokens.attr)&&this._attribute(),this._consume(i.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(i.tokens.brace_right,"Exected '}' for switch default."),e.push(new Tc(r))}if(this._check([i.keywords.default,i.keywords.case])){const r=this._switch_body();e.push(r[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(i.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(i.keywords.fallthrough))return this._consume(i.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const r=this._case_body();return r.length==0?e:[...e,r[0]]}_if_statement(){if(!this._match(i.keywords.if))return null;const e=this._optional_paren_expression();this._check(i.tokens.attr)&&this._attribute();const r=this._compound_statement();let a=[];this._match_elseif()&&(this._check(i.tokens.attr)&&this._attribute(),a=this._elseif_statement(a));let o=null;return this._match(i.keywords.else)&&(this._check(i.tokens.attr)&&this._attribute(),o=this._compound_statement()),new fc(e,r,a,o)}_match_elseif(){return this._tokens[this._current].type===i.keywords.else&&this._tokens[this._current+1].type===i.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const r=this._optional_paren_expression(),a=this._compound_statement();return e.push(new $c(r,a)),this._match_elseif()&&(this._check(i.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(i.keywords.return))return null;const e=this._short_circuit_or_expression();return new dc(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(i.tokens.or_or);)e=new me(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(i.tokens.and_and);)e=new me(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(i.tokens.or);)e=new me(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(i.tokens.xor);)e=new me(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(i.tokens.and);)e=new me(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([i.tokens.equal_equal,i.tokens.not_equal])?new me(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([i.tokens.less_than,i.tokens.greater_than,i.tokens.less_than_equal,i.tokens.greater_than_equal]);)e=new me(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([i.tokens.shift_left,i.tokens.shift_right]);)e=new me(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([i.tokens.plus,i.tokens.minus]);)e=new me(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([i.tokens.star,i.tokens.forward_slash,i.tokens.modulo]);)e=new me(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([i.tokens.minus,i.tokens.bang,i.tokens.tilde,i.tokens.star,i.tokens.and])?new Ec(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),r=this._postfix_expression();return r&&(e.postfix=r),e}_postfix_expression(){if(this._match(i.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(i.tokens.bracket_right,"Expected ']'.");const r=new xc(e),a=this._postfix_expression();return a&&(r.postfix=a),r}if(this._match(i.tokens.period)){const e=this._consume(i.tokens.ident,"Expected member name."),r=this._postfix_expression(),a=new Pn(e.lexeme);return r&&(a.postfix=r),a}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(i.tokens.ident)){const a=this._previous().toString();if(this._check(i.tokens.paren_left)){const o=this._argument_expression_list(),f=this._getStruct(a);return f!=null?new De(f,o):new ss(a,o)}if(this._context.constants.has(a)){const o=this._context.constants.get(a);return new On(a,o.value)}return new Jt(a)}if(this._match(i.const_literal))return new Bn(parseFloat(this._previous().toString()));if(this._check(i.tokens.paren_left))return this._paren_expression();if(this._match(i.keywords.bitcast)){this._consume(i.tokens.less_than,"Expected '<'.");const a=this._type_decl();this._consume(i.tokens.greater_than,"Expected '>'.");const o=this._paren_expression();return new wc(a,o)}const e=this._type_decl(),r=this._argument_expression_list();return new kc(e,r)}_argument_expression_list(){if(!this._match(i.tokens.paren_left))return null;const e=[];do{if(this._check(i.tokens.paren_right))break;const r=this._short_circuit_or_expression();e.push(r)}while(this._match(i.tokens.comma));return this._consume(i.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(i.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(i.tokens.paren_right),new Rn([e])}_paren_expression(){this._consume(i.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(i.tokens.paren_right,"Expected ')'."),new Rn([e])}_struct_decl(){if(!this._match(i.keywords.struct))return null;const e=this._currentLine,r=this._consume(i.tokens.ident,"Expected name for struct.").toString();this._consume(i.tokens.brace_left,"Expected '{' for struct body.");const a=[];for(;!this._check(i.tokens.brace_right);){const y=this._attribute(),k=this._consume(i.tokens.ident,"Expected variable name.").toString();this._consume(i.tokens.colon,"Expected ':' for struct member type.");const x=this._attribute(),S=this._type_decl();S!=null&&(S.attributes=x),this._check(i.tokens.brace_right)?this._match(i.tokens.comma):this._consume(i.tokens.comma,"Expected ',' for struct member."),a.push(new zc(k,S,y))}this._consume(i.tokens.brace_right,"Expected '}' after struct body.");const o=this._currentLine,f=new $e(r,a,e,o);return this._context.structs.set(r,f),f}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(i.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(i.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(i.keywords.const))return null;const e=this._consume(i.tokens.ident,"Expected variable name");let r=null;if(this._match(i.tokens.colon)){const f=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=f)}let a=null;if(this._match(i.tokens.equal)){const f=this._short_circuit_or_expression();if(f instanceof De)a=f;else if(f instanceof On&&f.initializer instanceof De)a=f.initializer;else try{const y=f.evaluate(this._context);a=new Bn(y)}catch{a=f}}const o=new Vn(e.toString(),r,"","",a);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(i.keywords.let))return null;const e=this._consume(i.tokens.ident,"Expected variable name");let r=null;if(this._match(i.tokens.colon)){const o=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=o)}let a=null;return this._match(i.tokens.equal)&&(a=this._const_expression()),new Zt(e.toString(),r,"","",a)}_const_expression(){if(this._match(i.const_literal))return new Pn(this._previous().toString());const e=this._type_decl();this._consume(i.tokens.paren_left,"Expected '('.");let r=[];for(;!this._check(i.tokens.paren_right)&&(r.push(this._const_expression()),!!this._check(i.tokens.comma));)this._advance();return this._consume(i.tokens.paren_right,"Expected ')'."),new De(e,r)}_variable_decl(){if(!this._match(i.keywords.var))return null;let e="",r="";this._match(i.tokens.less_than)&&(e=this._consume(i.storage_class,"Expected storage_class.").toString(),this._match(i.tokens.comma)&&(r=this._consume(i.access_mode,"Expected access_mode.").toString()),this._consume(i.tokens.greater_than,"Expected '>'."));const a=this._consume(i.tokens.ident,"Expected variable name");let o=null;if(this._match(i.tokens.colon)){const f=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=f)}return new ze(a.toString(),o,e,r,null)}_override_decl(){if(!this._match(i.keywords.override))return null;const e=this._consume(i.tokens.ident,"Expected variable name");let r=null;if(this._match(i.tokens.colon)){const a=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=a)}return new Kn(e.toString(),r,null)}_diagnostic(){this._consume(i.tokens.paren_left,"Expected '('");const e=this._consume(i.tokens.ident,"Expected severity control name.");this._consume(i.tokens.comma,"Expected ','");const r=this._consume(i.tokens.ident,"Expected diagnostic rule name.");return this._consume(i.tokens.paren_right,"Expected ')'"),new mc(e.toString(),r.toString())}_enable_directive(){const e=this._consume(i.tokens.ident,"identity expected.");return new _c(e.toString())}_requires_directive(){const e=[this._consume(i.tokens.ident,"identity expected.").toString()];for(;this._match(i.tokens.comma);){const r=this._consume(i.tokens.ident,"identity expected.");e.push(r.toString())}return new pc(e)}_type_alias(){const e=this._consume(i.tokens.ident,"identity expected.");this._consume(i.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);const a=new ts(e.toString(),r);return this._context.aliases.set(a.name,a),a}_type_decl(){if(this._check([i.tokens.ident,...i.texel_format,i.keywords.bool,i.keywords.f32,i.keywords.i32,i.keywords.u32])){const a=this._advance(),o=a.toString();return this._context.structs.has(o)?this._context.structs.get(o):this._context.aliases.has(o)?this._context.aliases.get(o).type:new Ne(a.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(i.template_types)){let a=this._advance().toString(),o=null,f=null;return this._match(i.tokens.less_than)&&(o=this._type_decl(),f=null,this._match(i.tokens.comma)&&(f=this._consume(i.access_mode,"Expected access_mode for pointer").toString()),this._consume(i.tokens.greater_than,"Expected '>' for type.")),new rs(a,o,f)}if(this._match(i.keywords.ptr)){let a=this._previous().toString();this._consume(i.tokens.less_than,"Expected '<' for pointer.");const o=this._consume(i.storage_class,"Expected storage_class for pointer");this._consume(i.tokens.comma,"Expected ',' for pointer.");const f=this._type_decl();let y=null;return this._match(i.tokens.comma)&&(y=this._consume(i.access_mode,"Expected access_mode for pointer").toString()),this._consume(i.tokens.greater_than,"Expected '>' for pointer."),new bc(a,o.toString(),f,y)}const r=this._attribute();if(this._match(i.keywords.array)){let a=null,o=-1;const f=this._previous();let y=null;if(this._match(i.tokens.less_than)){a=this._type_decl(),this._context.aliases.has(a.name)&&(a=this._context.aliases.get(a.name).type);let x="";if(this._match(i.tokens.comma)){y=this._shift_expression();try{x=y.evaluate(this._context).toString(),y=null}catch{x="1"}}this._consume(i.tokens.greater_than,"Expected '>' for array."),o=x?parseInt(x):0}const k=new ns(f.toString(),r,a,o);return y&&this._deferArrayCountEval.push({arrayType:k,countNode:y}),k}return null}_texture_sampler_types(){if(this._match(i.sampler_type))return new Je(this._previous().toString(),null,null);if(this._match(i.depth_texture_type))return new Je(this._previous().toString(),null,null);if(this._match(i.sampled_texture_type)||this._match(i.multisampled_texture_type)){const e=this._previous();this._consume(i.tokens.less_than,"Expected '<' for sampler type.");const r=this._type_decl();return this._consume(i.tokens.greater_than,"Expected '>' for sampler type."),new Je(e.toString(),r,null)}if(this._match(i.storage_texture_type)){const e=this._previous();this._consume(i.tokens.less_than,"Expected '<' for sampler type.");const r=this._consume(i.texel_format,"Invalid texel format.").toString();this._consume(i.tokens.comma,"Expected ',' after texel format.");const a=this._consume(i.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(i.tokens.greater_than,"Expected '>' for sampler type."),new Je(e.toString(),r,a)}return null}_attribute(){let e=[];for(;this._match(i.tokens.attr);){const r=this._consume(i.attribute_name,"Expected attribute name"),a=new Gn(r.toString(),null);if(this._match(i.tokens.paren_left)){if(a.value=this._consume(i.literal_or_ident,"Expected attribute value").toString(),this._check(i.tokens.comma)){this._advance();do{const o=this._consume(i.literal_or_ident,"Expected attribute value").toString();a.value instanceof Array||(a.value=[a.value]),a.value.push(o)}while(this._match(i.tokens.comma))}this._consume(i.tokens.paren_right,"Expected ')'")}e.push(a)}for(;this._match(i.tokens.attr_left);){if(!this._check(i.tokens.attr_right))do{const r=this._consume(i.attribute_name,"Expected attribute name"),a=new Gn(r.toString(),null);if(this._match(i.tokens.paren_left)){if(a.value=[this._consume(i.literal_or_ident,"Expected attribute value").toString()],this._check(i.tokens.comma)){this._advance();do{const o=this._consume(i.literal_or_ident,"Expected attribute value").toString();a.value.push(o)}while(this._match(i.tokens.comma))}this._consume(i.tokens.paren_right,"Expected ')'")}e.push(a)}while(this._match(i.tokens.comma));this._consume(i.tokens.attr_right,"Expected ']]' after attribute declarations")}return e.length==0?null:e}}class We{constructor(e,r){this.name=e,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class Wn{constructor(e,r,a){this.name=e,this.type=r,this.attributes=a,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ct extends We{constructor(e,r){super(e,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Dt extends We{constructor(e,r){super(e,r),this.count=0,this.stride=0}get isArray(){return!0}}class jn extends We{constructor(e,r,a,o){super(e,a),this.format=r,this.access=o}get isTemplate(){return!0}}var ne;(function(c){c[c.Uniform=0]="Uniform",c[c.Storage=1]="Storage",c[c.Texture=2]="Texture",c[c.Sampler=3]="Sampler",c[c.StorageTexture=4]="StorageTexture"})(ne||(ne={}));class lt{constructor(e,r,a,o,f,y,k){this.name=e,this.type=r,this.group=a,this.binding=o,this.attributes=f,this.resourceType=y,this.access=k}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ic{constructor(e,r){this.name=e,this.type=r}}class ht{constructor(e,r){this.align=e,this.size=r}}class Fc{constructor(e,r,a,o){this.name=e,this.type=r,this.locationType=a,this.location=o,this.interpolation=null}}class Yn{constructor(e,r,a,o){this.name=e,this.type=r,this.locationType=a,this.location=o}}class qc{constructor(e,r=null){this.stage=null,this.inputs=[],this.outputs=[],this.resources=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=r}}class Cc{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class Lc{constructor(e,r,a,o){this.name=e,this.type=r,this.attributes=a,this.id=o}}class Uc{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class ye{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Cc,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const a=new Mc().parse(e);for(const o of a)o instanceof Ht&&this._functions.set(o.name,new Uc(o));for(const o of a)if(o instanceof $e){const f=this._getTypeInfo(o,null);f instanceof ct&&this.structs.push(f)}for(const o of a){if(o instanceof ts){this.aliases.push(this._getAliasInfo(o));continue}if(o instanceof Kn){const f=o,y=this._getAttributeNum(f.attributes,"id",0),k=f.type!=null?this._getTypeInfo(f.type,f.attributes):null;this.overrides.push(new Lc(f.name,k,f.attributes,y));continue}if(this._isUniformVar(o)){const f=o,y=this._getAttributeNum(f.attributes,"group",0),k=this._getAttributeNum(f.attributes,"binding",0),x=this._getTypeInfo(f.type,f.attributes),S=new lt(f.name,x,y,k,f.attributes,ne.Uniform,f.access);this.uniforms.push(S);continue}if(this._isStorageVar(o)){const f=o,y=this._getAttributeNum(f.attributes,"group",0),k=this._getAttributeNum(f.attributes,"binding",0),x=this._getTypeInfo(f.type,f.attributes),S=this._isStorageTexture(x),M=new lt(f.name,x,y,k,f.attributes,S?ne.StorageTexture:ne.Storage,f.access);this.storage.push(M);continue}if(this._isTextureVar(o)){const f=o,y=this._getAttributeNum(f.attributes,"group",0),k=this._getAttributeNum(f.attributes,"binding",0),x=this._getTypeInfo(f.type,f.attributes),S=this._isStorageTexture(x),M=new lt(f.name,x,y,k,f.attributes,S?ne.StorageTexture:ne.Texture,f.access);S?this.storage.push(M):this.textures.push(M);continue}if(this._isSamplerVar(o)){const f=o,y=this._getAttributeNum(f.attributes,"group",0),k=this._getAttributeNum(f.attributes,"binding",0),x=this._getTypeInfo(f.type,f.attributes),S=new lt(f.name,x,y,k,f.attributes,ne.Sampler,f.access);this.samplers.push(S);continue}if(o instanceof Ht){const f=this._getAttribute(o,"vertex"),y=this._getAttribute(o,"fragment"),k=this._getAttribute(o,"compute"),x=f||y||k,S=new qc(o.name,x==null?void 0:x.name);S.startLine=o.startLine,S.endLine=o.endLine,this.functions.push(S),this._functions.get(o.name).info=S,x&&(this._functions.get(o.name).inUse=!0,S.inUse=!0,S.resources=this._findResources(o,!!x),S.inputs=this._getInputs(o.args),S.outputs=this._getOutputs(o.returnType),this.entry[x.name].push(S));continue}}for(const o of this._functions.values())o.info&&(o.info.inUse=o.inUse,this._addCalls(o.node,o.info.calls));for(const o of this.uniforms)this._markStructsInUse(o.type);for(const o of this.storage)this._markStructsInUse(o.type)}_markStructsInUse(e){if(e.isStruct){e.inUse=!0;for(const r of e.members)this._markStructsInUse(r.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)this._markStructsInUse(e.format);else{const r=this._getAlias(e.name);r&&this._markStructsInUse(r)}}_addCalls(e,r){var a;for(const o of e.calls){const f=(a=this._functions.get(o.name))===null||a===void 0?void 0:a.info;f&&r.add(f)}}findResource(e,r){for(const a of this.uniforms)if(a.group==e&&a.binding==r)return a;for(const a of this.storage)if(a.group==e&&a.binding==r)return a;for(const a of this.textures)if(a.group==e&&a.binding==r)return a;for(const a of this.samplers)if(a.group==e&&a.binding==r)return a;return null}_findResource(e){for(const r of this.uniforms)if(r.name==e)return r;for(const r of this.storage)if(r.name==e)return r;for(const r of this.textures)if(r.name==e)return r;for(const r of this.samplers)if(r.name==e)return r;return null}_markStructsFromAST(e){const r=this._getTypeInfo(e,null);this._markStructsInUse(r)}_findResources(e,r){const a=[],o=this,f=[];return e.search(y=>{if(y instanceof ft)f.push({});else if(y instanceof dt)f.pop();else if(y instanceof ze){const k=y;r&&k.type!==null&&this._markStructsFromAST(k.type),f.length>0&&(f[f.length-1][k.name]=k)}else if(y instanceof De){const k=y;r&&k.type!==null&&this._markStructsFromAST(k.type)}else if(y instanceof Zt){const k=y;r&&k.type!==null&&this._markStructsFromAST(k.type),f.length>0&&(f[f.length-1][k.name]=k)}else if(y instanceof Jt){const k=y;if(f.length>0&&f[f.length-1][k.name])return;const x=o._findResource(k.name);x&&a.push(x)}else if(y instanceof ss){const k=y,x=o._functions.get(k.name);x&&(r&&(x.inUse=!0),e.calls.add(x.node),x.resources===null&&(x.resources=o._findResources(x.node,r)),a.push(...x.resources))}else if(y instanceof es){const k=y,x=o._functions.get(k.name);x&&(r&&(x.inUse=!0),e.calls.add(x.node),x.resources===null&&(x.resources=o._findResources(x.node,r)),a.push(...x.resources))}}),[...new Map(a.map(y=>[y.name,y])).values()]}getBindGroups(){const e=[];function r(a,o){a>=e.length&&(e.length=a+1),e[a]===void 0&&(e[a]=[]),o>=e[a].length&&(e[a].length=o+1)}for(const a of this.uniforms){r(a.group,a.binding);const o=e[a.group];o[a.binding]=a}for(const a of this.storage){r(a.group,a.binding);const o=e[a.group];o[a.binding]=a}for(const a of this.textures){r(a.group,a.binding);const o=e[a.group];o[a.binding]=a}for(const a of this.samplers){r(a.group,a.binding);const o=e[a.group];o[a.binding]=a}return e}_getOutputs(e,r=void 0){if(r===void 0&&(r=[]),e instanceof $e)this._getStructOutputs(e,r);else{const a=this._getOutputInfo(e);a!==null&&r.push(a)}return r}_getStructOutputs(e,r){for(const a of e.members)if(a.type instanceof $e)this._getStructOutputs(a.type,r);else{const o=this._getAttribute(a,"location")||this._getAttribute(a,"builtin");if(o!==null){const f=this._getTypeInfo(a.type,a.type.attributes),y=this._parseInt(o.value),k=new Yn(a.name,f,o.name,y);r.push(k)}}}_getOutputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const a=this._getTypeInfo(e,e.attributes),o=this._parseInt(r.value);return new Yn("",a,r.name,o)}return null}_getInputs(e,r=void 0){r===void 0&&(r=[]);for(const a of e)if(a.type instanceof $e)this._getStructInputs(a.type,r);else{const o=this._getInputInfo(a);o!==null&&r.push(o)}return r}_getStructInputs(e,r){for(const a of e.members)if(a.type instanceof $e)this._getStructInputs(a.type,r);else{const o=this._getInputInfo(a);o!==null&&r.push(o)}}_getInputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const a=this._getAttribute(e,"interpolation"),o=this._getTypeInfo(e.type,e.attributes),f=this._parseInt(r.value),y=new Fc(e.name,o,r.name,f);return a!==null&&(y.interpolation=this._parseString(a.value)),y}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const r=parseInt(e);return isNaN(r)?e:r}_getAlias(e){for(const r of this.aliases)if(r.name==e)return r.type;return null}_getAliasInfo(e){return new Ic(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,r){if(this._types.has(e))return this._types.get(e);if(e instanceof ns){const o=e,f=this._getTypeInfo(o.format,o.attributes),y=new Dt(o.name,r);return y.format=f,y.count=o.count,this._types.set(e,y),this._updateTypeInfo(y),y}if(e instanceof $e){const o=e,f=new ct(o.name,r);f.startLine=o.startLine,f.endLine=o.endLine;for(const y of o.members){const k=this._getTypeInfo(y.type,y.attributes);f.members.push(new Wn(y.name,k,y.attributes))}return this._types.set(e,f),this._updateTypeInfo(f),f}if(e instanceof Je){const o=e,f=o.format instanceof Ne,y=o.format?f?this._getTypeInfo(o.format,null):new We(o.format,null):null,k=new jn(o.name,y,r,o.access);return this._types.set(e,k),this._updateTypeInfo(k),k}if(e instanceof rs){const o=e,f=o.format?this._getTypeInfo(o.format,null):null,y=new jn(o.name,f,r,o.access);return this._types.set(e,y),this._updateTypeInfo(y),y}const a=new We(e.name,r);return this._types.set(e,a),this._updateTypeInfo(a),a}_updateTypeInfo(e){var r,a;const o=this._getTypeSize(e);if(e.size=(r=o==null?void 0:o.size)!==null&&r!==void 0?r:0,e instanceof Dt){const f=this._getTypeSize(e.format);e.stride=(a=f==null?void 0:f.size)!==null&&a!==void 0?a:0,this._updateTypeInfo(e.format)}e instanceof ct&&this._updateStructInfo(e)}_updateStructInfo(e){var r;let a=0,o=0,f=0,y=0;for(let k=0,x=e.members.length;k<x;++k){const S=e.members[k],M=this._getTypeSize(S);if(!M)continue;(r=this._getAlias(S.type.name))!==null&&r!==void 0||S.type;const q=M.align,X=M.size;a=this._roundUp(q,a+o),o=X,f=a,y=Math.max(y,q),S.offset=a,S.size=X,this._updateTypeInfo(S.type)}e.size=this._roundUp(y,f+o),e.align=y}_getTypeSize(e){var r;if(e==null)return null;const a=this._getAttributeNum(e.attributes,"size",0),o=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Wn&&(e=e.type),e instanceof We){const f=this._getAlias(e.name);f!==null&&(e=f)}{const f=ye._typeInfo[e.name];if(f!==void 0){const y=e.format==="f16"?2:1;return new ht(Math.max(o,f.align/y),Math.max(a,f.size/y))}}{const f=ye._typeInfo[e.name.substring(0,e.name.length-1)];if(f){const y=e.name[e.name.length-1]==="h"?2:1;return new ht(Math.max(o,f.align/y),Math.max(a,f.size/y))}}if(e instanceof Dt){let f=e,y=8,k=8;const x=this._getTypeSize(f.format);x!==null&&(k=x.size,y=x.align);const S=f.count,M=this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(y,k));return k=S*M,a&&(k=a),new ht(Math.max(o,y),Math.max(a,k))}if(e instanceof ct){let f=0,y=0,k=0,x=0,S=0;for(const M of e.members){const q=this._getTypeSize(M.type);q!==null&&(f=Math.max(q.align,f),k=this._roundUp(q.align,k+x),x=q.size,S=k)}return y=this._roundUp(f,S+x),new ht(Math.max(o,f),Math.max(a,y))}return null}_isUniformVar(e){return e instanceof ze&&e.storage=="uniform"}_isStorageVar(e){return e instanceof ze&&e.storage=="storage"}_isTextureVar(e){return e instanceof ze&&e.type!==null&&ye._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof ze&&e.type!==null&&ye._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,r){const a=e;if(!a||!a.attributes)return null;const o=a.attributes;for(let f of o)if(f.name==r)return f;return null}_getAttributeNum(e,r,a){if(e===null)return a;for(let o of e)if(o.name==r){let f=o!==null&&o.value!==null?o.value:a;return f instanceof Array&&(f=f[0]),typeof f=="number"?f:typeof f=="string"?parseInt(f):a}return a}_roundUp(e,r){return Math.ceil(r/e)*e}}ye._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};ye._textureTypes=i.any_texture_type.map(c=>c.name);ye._samplerTypes=i.sampler_type.map(c=>c.name);function Ge(c,e){return Object.fromEntries(e.map(r=>{const a=Rc(c,r,0);return[r.name,{typeDefinition:a,group:r.group,binding:r.binding,size:a.size}]}))}function os(c,e,r){return{fields:Object.fromEntries(e.members.map(o=>[o.name,{offset:o.offset,type:Kt(c,o.type,0)}])),size:e.size,offset:r}}function Vc(c){var e;if(c.name.includes("depth"))return"depth";switch((e=c.format)==null?void 0:e.name){case"f32":return"float";case"i32":return"sint";case"u32":return"uint";default:throw new Error("unknown texture sample type")}}function Xn(c){return c.name.includes("2d_array")?"2d-array":c.name.includes("cube_array")?"cube-array":c.name.includes("3d")?"3d":c.name.includes("1d")?"1d":c.name.includes("cube")?"cube":"2d"}function Pc(c){switch(c.access){case"read":return"read-only";case"write":return"write-only";case"read_write":return"read-write";default:throw new Error("unknonw storage texture access")}}function Oc(c){return c.name.endsWith("_comparison")?"comparison":"filtering"}function Bc(c,e){const{binding:r,access:a,type:o}=c;switch(c.resourceType){case ne.Uniform:return{binding:r,visibility:e,buffer:{...c.size&&{minBindingSize:c.size}}};case ne.Storage:return{binding:r,visibility:e,buffer:{type:a===""||a==="read"?"read-only-storage":"storage",...c.size&&{minBindingSize:c.size}}};case ne.Texture:{if(o.name==="texture_external")return{binding:r,visibility:e,externalTexture:{}};const f=o.name.includes("multisampled");return{binding:r,visibility:e,texture:{sampleType:Vc(o),viewDimension:Xn(o),multisampled:f}}}case ne.Sampler:return{binding:r,visibility:e,sampler:{type:Oc(o)}};case ne.StorageTexture:return{binding:r,visibility:e,storageTexture:{access:Pc(o),format:o.format.name,viewDimension:Xn(o)}};default:throw new Error("unknown resource type")}}function Wt(c,e){const r={};for(const a of c)r[a.name]={stage:e,resources:a.resources.map(o=>{const{name:f,group:y}=o;return{name:f,group:y,entry:Bc(o,e)}})};return r}function sl(c){const e=new ye(c),r=Object.fromEntries(e.structs.map(M=>[M.name,os(e,M,0)])),a=Ge(e,e.uniforms),o=Ge(e,e.storage.filter(M=>M.resourceType===ne.Storage)),f=Ge(e,e.storage.filter(M=>M.resourceType===ne.StorageTexture)),y=Ge(e,e.textures.filter(M=>M.type.name!=="texture_external")),k=Ge(e,e.textures.filter(M=>M.type.name==="texture_external")),x=Ge(e,e.samplers),S={...Wt(e.entry.vertex,GPUShaderStage.VERTEX),...Wt(e.entry.fragment,GPUShaderStage.FRAGMENT),...Wt(e.entry.compute,GPUShaderStage.COMPUTE)};return{externalTextures:k,samplers:x,structs:r,storages:o,storageTextures:f,textures:y,uniforms:a,entryPoints:S}}function jt(c,e=""){if(!c)throw new Error(e)}function Rc(c,e,r){switch(e.resourceType){case ne.Uniform:case ne.Storage:case ne.StorageTexture:return Kt(c,e.type,r);default:return{size:0,type:e.type.name}}}function Kt(c,e,r){if(e.isArray){jt(!e.isStruct,"struct array is invalid"),jt(!e.isStruct,"template array is invalid");const a=e;return{size:a.size,elementType:Kt(c,a.format,r),numElements:a.count}}else{if(e.isStruct)return jt(!e.isTemplate,"template struct is invalid"),os(c,e,r);{const a=e,o=e.isTemplate?`${a.name}<${a.format.name}>`:e.name;return{size:e.size,type:o}}}}const us=new Map([[Int8Array,{formats:["sint8","snorm8"],defaultForType:1}],[Uint8Array,{formats:["uint8","unorm8"],defaultForType:1}],[Int16Array,{formats:["sint16","snorm16"],defaultForType:1}],[Uint16Array,{formats:["uint16","unorm16"],defaultForType:1}],[Int32Array,{formats:["sint32","snorm32"],defaultForType:0}],[Uint32Array,{formats:["uint32","unorm32"],defaultForType:0}],[Float32Array,{formats:["float32","float32"],defaultForType:0}]]),Gc=new Map([...us.entries()].map(([c,{formats:[e,r]}])=>[[e,c],[r,c]]).flat());function er(c){return c==="indices"}function cs(c,e){if(Qe(c))return c;let r=c;if(Qe(r.data))return r.data;(Array.isArray(c)||typeof c=="number")&&(r={data:c});let a=r.type;return a||(er(e)?a=Uint32Array:a=Float32Array),new a(r.data)}function Dc(c){return c.length?c:c.data}const Wc=[{re:/coord|texture|uv/i,numComponents:2},{re:/color|colour/i,numComponents:4}];function jc(c){for(const{re:e,numComponents:r}of Wc)if(e.test(c))return r;return 3}function Yc(c,e){const r=jc(c);if(e%r>0)throw new Error(`Can not guess numComponents for attribute '${c}'. Tried ${r} but ${e} values is not evenly divisible by ${r}. You should specify it.`);return r}function Xc(c,e){return c.numComponents||Yc(e,Dc(c).length)}const Hc=/(\w+)(?:x(\d))$/;function ls(c){const e=Hc.exec(c),[r,a]=e?[e[1],parseInt(e[2])]:[c,1];return{Type:Gc.get(r),numComponents:a}}function Hn(c,e){const r=Object.getPrototypeOf(c).constructor;return new r(e)}function Zc(c,e={}){const r=e.interleave===void 0?!0:e.interleave,a=e.stepMode||"vertex",o=e.shaderLocation?Array.isArray(e.shaderLocation)?e.shaderLocation:[e.shaderLocation]:[0];let f=0;const y=[],k=[],x=[];return Object.keys(c).filter(S=>!er(S)).forEach(S=>{const M=c[S],q=cs(M,S),X=Xc(M,S),ie=X/4,oe=X/3,w=ie%1===0?4:oe%1===0?3:4;for(let F=0;F<X;F+=w){const Q=Math.min(w,X-F),ee=f;f+=Q*q.BYTES_PER_ELEMENT;const{defaultForType:ue,formats:ce}=us.get(Object.getPrototypeOf(q).constructor),Me=M.normalize,Ie=`${ce[typeof Me>"u"?ue:Me?1:0]}${Q>1?`x${Q}`:""}`,J=o.shift();o.length===0&&o.push(J+1),k.push({offset:ee,format:Ie,shaderLocation:J}),x.push({data:q,offset:F,stride:X})}r||(y.push({stepMode:a,arrayStride:f,attributes:k.slice()}),f=0,k.length=0)}),k.length&&y.push({stepMode:a,arrayStride:f,attributes:k}),{bufferLayouts:y,typedArrays:x}}function hs(c,e){return Qe(c)?{data:c,offset:0,stride:e}:c}function Jc(c,e,r,a){const o=new Map,f=y=>{const k=Object.getPrototypeOf(y).constructor,x=o.get(k);if(x)return x;const S=new k(a);return o.set(k,S),S};c.forEach((y,k)=>{const{offset:x,format:S}=y,{numComponents:M}=ls(S),{data:q,offset:X,stride:ie}=hs(e[k],M),oe=f(q);for(let w=0;w<q.length;w+=ie){const F=w/ie,Q=(x+F*r)/oe.BYTES_PER_ELEMENT,ee=w+X,ue=q.subarray(ee,ee+M);oe.set(ue,Q)}})}function al(c,e,r={}){const a=r.usage||0,{bufferLayouts:o,typedArrays:f}=Zc(e,r),y=[];let k=-1,x=0;for(const{attributes:q,arrayStride:X}of o){const ie=q,oe=ie[0],{numComponents:w}=ls(oe.format),{data:F,stride:Q}=hs(f[x],w);k<0&&(k=F.length/Q);const ee=X*k,ue=c.createBuffer({usage:a|GPUBufferUsage.VERTEX,size:ee,mappedAtCreation:!0}),ce=ue.getMappedRange();ie.length===1&&X===F.BYTES_PER_ELEMENT*w?Hn(F,ce).set(F):Jc(ie,f.slice(x),X,ce),ue.unmap(),y.push(ue),x+=ie.length}const S={numElements:k,bufferLayouts:o,buffers:y},M=Object.entries(e).find(([q])=>er(q));if(M){const q=cs(M[1],"indices"),X=c.createBuffer({size:q.byteLength,usage:GPUBufferUsage.INDEX|a,mappedAtCreation:!0});Hn(q,X.getMappedRange()).set(q),X.unmap(),S.indexBuffer=X,S.indexFormat=q instanceof Uint16Array?"uint16":"uint32",S.numElements=q.length}return S}export{el as _,rl as a,tl as b,al as c,sl as m};
