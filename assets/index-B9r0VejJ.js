import{a1 as y,a2 as te,a3 as me,a4 as ne,a5 as Ne,a6 as Gn,a7 as Jn,a8 as d,a9 as k,aa as $t,ab as Nt,ac as et,ad as Ae,ae as qt,af as tt,ag as Q,ah as ie,x as je,ai as Qn,aj as Ke,ak as Ut,al as j,am as nt,an as b,ao as R,ap as $,aq as ce,ar as v,as as it,at as ot,au as st,av as Vt,aw as _n,ax as Yn,ay as zt,az as Xn,aA as Ht,aB as Ge,aC as Zn,aD as ei,aE as ti,aF as ni,aG as ii,aH as oi,aI as si,aJ as ri,aK as li,aL as ci,aM as ai,aN as fi,aO as hi,aP as ui,aQ as di,aR as mi,aS as pi,aT as gi,aU as yi}from"./index-8W2lkcdb.js";const xi=t=>{let{state:e}=t,n=e.doc.lineAt(e.selection.main.from),i=lt(t.state,n.from);return i.line?bi(t):i.block?Ci(t):!1};function rt(t,e){return({state:n,dispatch:i})=>{if(n.readOnly)return!1;let o=t(e,n);return o?(i(n.update(o)),!0):!1}}const bi=rt(vi,0),Si=rt(jt,0),Ci=rt((t,e)=>jt(t,e,Ai(e)),0);function lt(t,e){let n=t.languageDataAt("commentTokens",e);return n.length?n[0]:{}}const le=50;function ki(t,{open:e,close:n},i,o){let s=t.sliceDoc(i-le,i),r=t.sliceDoc(o,o+le),l=/\s*$/.exec(s)[0].length,c=/^\s*/.exec(r)[0].length,a=s.length-l;if(s.slice(a-e.length,a)==e&&r.slice(c,c+n.length)==n)return{open:{pos:i-l,margin:l&&1},close:{pos:o+c,margin:c&&1}};let f,h;o-i<=2*le?f=h=t.sliceDoc(i,o):(f=t.sliceDoc(i,i+le),h=t.sliceDoc(o-le,o));let u=/^\s*/.exec(f)[0].length,m=/\s*$/.exec(h)[0].length,p=h.length-m-n.length;return f.slice(u,u+e.length)==e&&h.slice(p,p+n.length)==n?{open:{pos:i+u+e.length,margin:/\s/.test(f.charAt(u+e.length))?1:0},close:{pos:o-m-n.length,margin:/\s/.test(h.charAt(p-1))?1:0}}:null}function Ai(t){let e=[];for(let n of t.selection.ranges){let i=t.doc.lineAt(n.from),o=n.to<=i.to?i:t.doc.lineAt(n.to),s=e.length-1;s>=0&&e[s].to>i.from?e[s].to=o.to:e.push({from:i.from+/^\s*/.exec(i.text)[0].length,to:o.to})}return e}function jt(t,e,n=e.selection.ranges){let i=n.map(s=>lt(e,s.from).block);if(!i.every(s=>s))return null;let o=n.map((s,r)=>ki(e,i[r],s.from,s.to));if(t!=2&&!o.every(s=>s))return{changes:e.changes(n.map((s,r)=>o[r]?[]:[{from:s.from,insert:i[r].open+" "},{from:s.to,insert:" "+i[r].close}]))};if(t!=1&&o.some(s=>s)){let s=[];for(let r=0,l;r<o.length;r++)if(l=o[r]){let c=i[r],{open:a,close:f}=l;s.push({from:a.pos-c.open.length,to:a.pos+a.margin},{from:f.pos-f.margin,to:f.pos+c.close.length})}return{changes:s}}return null}function vi(t,e,n=e.selection.ranges){let i=[],o=-1;for(let{from:s,to:r}of n){let l=i.length,c=1e9,a=lt(e,s).line;if(a){for(let f=s;f<=r;){let h=e.doc.lineAt(f);if(h.from>o&&(s==r||r>h.from)){o=h.from;let u=/^\s*/.exec(h.text)[0].length,m=u==h.length,p=h.text.slice(u,u+a.length)==a?u:-1;u<h.text.length&&u<c&&(c=u),i.push({line:h,comment:p,token:a,indent:u,empty:m,single:!1})}f=h.to+1}if(c<1e9)for(let f=l;f<i.length;f++)i[f].indent<i[f].line.text.length&&(i[f].indent=c);i.length==l+1&&(i[l].single=!0)}}if(t!=2&&i.some(s=>s.comment<0&&(!s.empty||s.single))){let s=[];for(let{line:l,token:c,indent:a,empty:f,single:h}of i)(h||!f)&&s.push({from:l.from+a,insert:c+" "});let r=e.changes(s);return{changes:r,selection:e.selection.map(r,1)}}else if(t!=1&&i.some(s=>s.comment>=0)){let s=[];for(let{line:r,comment:l,token:c}of i)if(l>=0){let a=r.from+l,f=a+c.length;r.text[f-r.from]==" "&&f++,s.push({from:a,to:f})}return{changes:s}}return null}const Je=tt.define(),Mi=tt.define(),Li=te.define(),Kt=te.define({combine(t){return me(t,{minDepth:100,newGroupDelay:500,joinToEvent:(e,n)=>n},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,n)=>(i,o)=>e(i,o)||n(i,o)})}}),Gt=ne.define({create(){return P.empty},update(t,e){let n=e.state.facet(Kt),i=e.annotation(Je);if(i){let c=w.fromTransaction(e,i.selection),a=i.side,f=a==0?t.undone:t.done;return c?f=ve(f,f.length,n.minDepth,c):f=_t(f,e.startState.selection),new P(a==0?i.rest:f,a==0?f:i.rest)}let o=e.annotation(Mi);if((o=="full"||o=="before")&&(t=t.isolate()),e.annotation(Ne.addToHistory)===!1)return e.changes.empty?t:t.addMapping(e.changes.desc);let s=w.fromTransaction(e),r=e.annotation(Ne.time),l=e.annotation(Ne.userEvent);return s?t=t.addChanges(s,r,l,n,e):e.selection&&(t=t.addSelection(e.startState.selection,r,l,n.newGroupDelay)),(o=="full"||o=="after")&&(t=t.isolate()),t},toJSON(t){return{done:t.done.map(e=>e.toJSON()),undone:t.undone.map(e=>e.toJSON())}},fromJSON(t){return new P(t.done.map(w.fromJSON),t.undone.map(w.fromJSON))}});function wi(t={}){return[Gt,Kt.of(t),y.domEventHandlers({beforeinput(e,n){let i=e.inputType=="historyUndo"?Jt:e.inputType=="historyRedo"?Qe:null;return i?(e.preventDefault(),i(n)):!1}})]}function Te(t,e){return function({state:n,dispatch:i}){if(!e&&n.readOnly)return!1;let o=n.field(Gt,!1);if(!o)return!1;let s=o.pop(t,n,e);return s?(i(s),!0):!1}}const Jt=Te(0,!1),Qe=Te(1,!1),Di=Te(0,!0),Bi=Te(1,!0);class w{constructor(e,n,i,o,s){this.changes=e,this.effects=n,this.mapped=i,this.startSelection=o,this.selectionsAfter=s}setSelAfter(e){return new w(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,n,i;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(n=this.mapped)===null||n===void 0?void 0:n.toJSON(),startSelection:(i=this.startSelection)===null||i===void 0?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map(o=>o.toJSON())}}static fromJSON(e){return new w(e.changes&&Gn.fromJSON(e.changes),[],e.mapped&&Jn.fromJSON(e.mapped),e.startSelection&&d.fromJSON(e.startSelection),e.selectionsAfter.map(d.fromJSON))}static fromTransaction(e,n){let i=O;for(let o of e.startState.facet(Li)){let s=o(e);s.length&&(i=i.concat(s))}return!i.length&&e.changes.empty?null:new w(e.changes.invert(e.startState.doc),i,void 0,n||e.startState.selection,O)}static selection(e){return new w(void 0,O,void 0,void 0,e)}}function ve(t,e,n,i){let o=e+1>n+20?e-n-1:0,s=t.slice(o,e);return s.push(i),s}function Ii(t,e){let n=[],i=!1;return t.iterChangedRanges((o,s)=>n.push(o,s)),e.iterChangedRanges((o,s,r,l)=>{for(let c=0;c<n.length;){let a=n[c++],f=n[c++];l>=a&&r<=f&&(i=!0)}}),i}function Ri(t,e){return t.ranges.length==e.ranges.length&&t.ranges.filter((n,i)=>n.empty!=e.ranges[i].empty).length===0}function Qt(t,e){return t.length?e.length?t.concat(e):t:e}const O=[],Oi=200;function _t(t,e){if(t.length){let n=t[t.length-1],i=n.selectionsAfter.slice(Math.max(0,n.selectionsAfter.length-Oi));return i.length&&i[i.length-1].eq(e)?t:(i.push(e),ve(t,t.length-1,1e9,n.setSelAfter(i)))}else return[w.selection([e])]}function Ti(t){let e=t[t.length-1],n=t.slice();return n[t.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),n}function qe(t,e){if(!t.length)return t;let n=t.length,i=O;for(;n;){let o=Ei(t[n-1],e,i);if(o.changes&&!o.changes.empty||o.effects.length){let s=t.slice(0,n);return s[n-1]=o,s}else e=o.mapped,n--,i=o.selectionsAfter}return i.length?[w.selection(i)]:O}function Ei(t,e,n){let i=Qt(t.selectionsAfter.length?t.selectionsAfter.map(l=>l.map(e)):O,n);if(!t.changes)return w.selection(i);let o=t.changes.map(e),s=e.mapDesc(t.changes,!0),r=t.mapped?t.mapped.composeDesc(s):s;return new w(o,k.mapEffects(t.effects,e),r,t.startSelection.map(s),i)}const Pi=/^(input\.type|delete)($|\.)/;class P{constructor(e,n,i=0,o=void 0){this.done=e,this.undone=n,this.prevTime=i,this.prevUserEvent=o}isolate(){return this.prevTime?new P(this.done,this.undone):this}addChanges(e,n,i,o,s){let r=this.done,l=r[r.length-1];return l&&l.changes&&!l.changes.empty&&e.changes&&(!i||Pi.test(i))&&(!l.selectionsAfter.length&&n-this.prevTime<o.newGroupDelay&&o.joinToEvent(s,Ii(l.changes,e.changes))||i=="input.type.compose")?r=ve(r,r.length-1,o.minDepth,new w(e.changes.compose(l.changes),Qt(k.mapEffects(e.effects,l.changes),l.effects),l.mapped,l.startSelection,O)):r=ve(r,r.length,o.minDepth,e),new P(r,O,n,i)}addSelection(e,n,i,o){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:O;return s.length>0&&n-this.prevTime<o&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&Ri(s[s.length-1],e)?this:new P(_t(this.done,e),this.undone,n,i)}addMapping(e){return new P(qe(this.done,e),qe(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,n,i){let o=e==0?this.done:this.undone;if(o.length==0)return null;let s=o[o.length-1],r=s.selectionsAfter[0]||n.selection;if(i&&s.selectionsAfter.length)return n.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:Je.of({side:e,rest:Ti(o),selection:r}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let l=o.length==1?O:o.slice(0,o.length-1);return s.mapped&&(l=qe(l,s.mapped)),n.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:Je.of({side:e,rest:l,selection:r}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}P.empty=new P(O,O);const Fi=[{key:"Mod-z",run:Jt,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Qe,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Qe,preventDefault:!0},{key:"Mod-u",run:Di,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Bi,preventDefault:!0}];function oe(t,e){return d.create(t.ranges.map(e),t.mainIndex)}function F(t,e){return t.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function E({state:t,dispatch:e},n){let i=oe(t.selection,n);return i.eq(t.selection,!0)?!1:(e(F(t,i)),!0)}function Ee(t,e){return d.cursor(e?t.to:t.from)}function Yt(t,e){return E(t,n=>n.empty?t.moveByChar(n,e):Ee(n,e))}function A(t){return t.textDirectionAt(t.state.selection.main.head)==Ut.LTR}const Xt=t=>Yt(t,!A(t)),Zt=t=>Yt(t,A(t));function en(t,e){return E(t,n=>n.empty?t.moveByGroup(n,e):Ee(n,e))}const Wi=t=>en(t,!A(t)),$i=t=>en(t,A(t));function Ni(t,e,n){if(e.type.prop(n))return!0;let i=e.to-e.from;return i&&(i>2||/[^\s,.;:]/.test(t.sliceDoc(e.from,e.to)))||e.firstChild}function Pe(t,e,n){let i=ie(t).resolveInner(e.head),o=n?je.closedBy:je.openedBy;for(let c=e.head;;){let a=n?i.childAfter(c):i.childBefore(c);if(!a)break;Ni(t,a,o)?i=a:c=n?a.to:a.from}let s=i.type.prop(o),r,l;return s&&(r=n?Q(t,i.from,1):Q(t,i.to,-1))&&r.matched?l=n?r.end.to:r.end.from:l=n?i.to:i.from,d.cursor(l,n?-1:1)}const qi=t=>E(t,e=>Pe(t.state,e,!A(t))),Ui=t=>E(t,e=>Pe(t.state,e,A(t)));function tn(t,e){return E(t,n=>{if(!n.empty)return Ee(n,e);let i=t.moveVertically(n,e);return i.head!=n.head?i:t.moveToLineBoundary(n,e)})}const nn=t=>tn(t,!1),on=t=>tn(t,!0);function sn(t){let e=t.scrollDOM.clientHeight<t.scrollDOM.scrollHeight-2,n=0,i=0,o;if(e){for(let s of t.state.facet(y.scrollMargins)){let r=s(t);r!=null&&r.top&&(n=Math.max(r==null?void 0:r.top,n)),r!=null&&r.bottom&&(i=Math.max(r==null?void 0:r.bottom,i))}o=t.scrollDOM.clientHeight-n-i}else o=(t.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:n,marginBottom:i,selfScroll:e,height:Math.max(t.defaultLineHeight,o-5)}}function rn(t,e){let n=sn(t),{state:i}=t,o=oe(i.selection,r=>r.empty?t.moveVertically(r,e,n.height):Ee(r,e));if(o.eq(i.selection))return!1;let s;if(n.selfScroll){let r=t.coordsAtPos(i.selection.main.head),l=t.scrollDOM.getBoundingClientRect(),c=l.top+n.marginTop,a=l.bottom-n.marginBottom;r&&r.top>c&&r.bottom<a&&(s=y.scrollIntoView(o.main.head,{y:"start",yMargin:r.top-c}))}return t.dispatch(F(i,o),{effects:s}),!0}const gt=t=>rn(t,!1),_e=t=>rn(t,!0);function U(t,e,n){let i=t.lineBlockAt(e.head),o=t.moveToLineBoundary(e,n);if(o.head==e.head&&o.head!=(n?i.to:i.from)&&(o=t.moveToLineBoundary(e,n,!1)),!n&&o.head==i.from&&i.length){let s=/^\s*/.exec(t.state.sliceDoc(i.from,Math.min(i.from+100,i.to)))[0].length;s&&e.head!=i.from+s&&(o=d.cursor(i.from+s))}return o}const Vi=t=>E(t,e=>U(t,e,!0)),zi=t=>E(t,e=>U(t,e,!1)),Hi=t=>E(t,e=>U(t,e,!A(t))),ji=t=>E(t,e=>U(t,e,A(t))),Ki=t=>E(t,e=>d.cursor(t.lineBlockAt(e.head).from,1)),Gi=t=>E(t,e=>d.cursor(t.lineBlockAt(e.head).to,-1));function Ji(t,e,n){let i=!1,o=oe(t.selection,s=>{let r=Q(t,s.head,-1)||Q(t,s.head,1)||s.head>0&&Q(t,s.head-1,1)||s.head<t.doc.length&&Q(t,s.head+1,-1);if(!r||!r.end)return s;i=!0;let l=r.start.from==s.head?r.end.to:r.end.from;return d.cursor(l)});return i?(e(F(t,o)),!0):!1}const Qi=({state:t,dispatch:e})=>Ji(t,e);function T(t,e){let n=oe(t.state.selection,i=>{let o=e(i);return d.range(i.anchor,o.head,o.goalColumn,o.bidiLevel||void 0)});return n.eq(t.state.selection)?!1:(t.dispatch(F(t.state,n)),!0)}function ln(t,e){return T(t,n=>t.moveByChar(n,e))}const cn=t=>ln(t,!A(t)),an=t=>ln(t,A(t));function fn(t,e){return T(t,n=>t.moveByGroup(n,e))}const _i=t=>fn(t,!A(t)),Yi=t=>fn(t,A(t)),Xi=t=>T(t,e=>Pe(t.state,e,!A(t))),Zi=t=>T(t,e=>Pe(t.state,e,A(t)));function hn(t,e){return T(t,n=>t.moveVertically(n,e))}const un=t=>hn(t,!1),dn=t=>hn(t,!0);function mn(t,e){return T(t,n=>t.moveVertically(n,e,sn(t).height))}const yt=t=>mn(t,!1),xt=t=>mn(t,!0),eo=t=>T(t,e=>U(t,e,!0)),to=t=>T(t,e=>U(t,e,!1)),no=t=>T(t,e=>U(t,e,!A(t))),io=t=>T(t,e=>U(t,e,A(t))),oo=t=>T(t,e=>d.cursor(t.lineBlockAt(e.head).from)),so=t=>T(t,e=>d.cursor(t.lineBlockAt(e.head).to)),bt=({state:t,dispatch:e})=>(e(F(t,{anchor:0})),!0),St=({state:t,dispatch:e})=>(e(F(t,{anchor:t.doc.length})),!0),Ct=({state:t,dispatch:e})=>(e(F(t,{anchor:t.selection.main.anchor,head:0})),!0),kt=({state:t,dispatch:e})=>(e(F(t,{anchor:t.selection.main.anchor,head:t.doc.length})),!0),ro=({state:t,dispatch:e})=>(e(t.update({selection:{anchor:0,head:t.doc.length},userEvent:"select"})),!0),lo=({state:t,dispatch:e})=>{let n=Fe(t).map(({from:i,to:o})=>d.range(i,Math.min(o+1,t.doc.length)));return e(t.update({selection:d.create(n),userEvent:"select"})),!0},co=({state:t,dispatch:e})=>{let n=oe(t.selection,i=>{let o=ie(t),s=o.resolveStack(i.from,1);if(i.empty){let r=o.resolveStack(i.from,-1);r.node.from>=s.node.from&&r.node.to<=s.node.to&&(s=r)}for(let r=s;r;r=r.next){let{node:l}=r;if((l.from<i.from&&l.to>=i.to||l.to>i.to&&l.from<=i.from)&&r.next)return d.range(l.to,l.from)}return i});return n.eq(t.selection)?!1:(e(F(t,n)),!0)},ao=({state:t,dispatch:e})=>{let n=t.selection,i=null;return n.ranges.length>1?i=d.create([n.main]):n.main.empty||(i=d.create([d.cursor(n.main.head)])),i?(e(F(t,i)),!0):!1};function pe(t,e){if(t.state.readOnly)return!1;let n="delete.selection",{state:i}=t,o=i.changeByRange(s=>{let{from:r,to:l}=s;if(r==l){let c=e(s);c<r?(n="delete.backward",c=xe(t,c,!1)):c>r&&(n="delete.forward",c=xe(t,c,!0)),r=Math.min(r,c),l=Math.max(l,c)}else r=xe(t,r,!1),l=xe(t,l,!0);return r==l?{range:s}:{changes:{from:r,to:l},range:d.cursor(r,r<s.head?-1:1)}});return o.changes.empty?!1:(t.dispatch(i.update(o,{scrollIntoView:!0,userEvent:n,effects:n=="delete.selection"?y.announce.of(i.phrase("Selection deleted")):void 0})),!0)}function xe(t,e,n){if(t instanceof y)for(let i of t.state.facet(y.atomicRanges).map(o=>o(t)))i.between(e,e,(o,s)=>{o<e&&s>e&&(e=n?s:o)});return e}const pn=(t,e,n)=>pe(t,i=>{let o=i.from,{state:s}=t,r=s.doc.lineAt(o),l,c;if(n&&!e&&o>r.from&&o<r.from+200&&!/[^ \t]/.test(l=r.text.slice(0,o-r.from))){if(l[l.length-1]=="	")return o-1;let a=et(l,s.tabSize),f=a%Ke(s)||Ke(s);for(let h=0;h<f&&l[l.length-1-h]==" ";h++)o--;c=o}else c=j(r.text,o-r.from,e,e)+r.from,c==o&&r.number!=(e?s.doc.lines:1)?c+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(r.text.slice(c-r.from,o-r.from))&&(c=j(r.text,c-r.from,!1,!1)+r.from);return c}),Ye=t=>pn(t,!1,!0),gn=t=>pn(t,!0,!1),yn=(t,e)=>pe(t,n=>{let i=n.head,{state:o}=t,s=o.doc.lineAt(i),r=o.charCategorizer(i);for(let l=null;;){if(i==(e?s.to:s.from)){i==n.head&&s.number!=(e?o.doc.lines:1)&&(i+=e?1:-1);break}let c=j(s.text,i-s.from,e)+s.from,a=s.text.slice(Math.min(i,c)-s.from,Math.max(i,c)-s.from),f=r(a);if(l!=null&&f!=l)break;(a!=" "||i!=n.head)&&(l=f),i=c}return i}),xn=t=>yn(t,!1),fo=t=>yn(t,!0),ho=t=>pe(t,e=>{let n=t.lineBlockAt(e.head).to;return e.head<n?n:Math.min(t.state.doc.length,e.head+1)}),uo=t=>pe(t,e=>{let n=t.moveToLineBoundary(e,!1).head;return e.head>n?n:Math.max(0,e.head-1)}),mo=t=>pe(t,e=>{let n=t.moveToLineBoundary(e,!0).head;return e.head<n?n:Math.min(t.state.doc.length,e.head+1)}),po=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let n=t.changeByRange(i=>({changes:{from:i.from,to:i.to,insert:qt.of(["",""])},range:d.cursor(i.from)}));return e(t.update(n,{scrollIntoView:!0,userEvent:"input"})),!0},go=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let n=t.changeByRange(i=>{if(!i.empty||i.from==0||i.from==t.doc.length)return{range:i};let o=i.from,s=t.doc.lineAt(o),r=o==s.from?o-1:j(s.text,o-s.from,!1)+s.from,l=o==s.to?o+1:j(s.text,o-s.from,!0)+s.from;return{changes:{from:r,to:l,insert:t.doc.slice(o,l).append(t.doc.slice(r,o))},range:d.cursor(l)}});return n.changes.empty?!1:(e(t.update(n,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Fe(t){let e=[],n=-1;for(let i of t.selection.ranges){let o=t.doc.lineAt(i.from),s=t.doc.lineAt(i.to);if(!i.empty&&i.to==s.from&&(s=t.doc.lineAt(i.to-1)),n>=o.number){let r=e[e.length-1];r.to=s.to,r.ranges.push(i)}else e.push({from:o.from,to:s.to,ranges:[i]});n=s.number+1}return e}function bn(t,e,n){if(t.readOnly)return!1;let i=[],o=[];for(let s of Fe(t)){if(n?s.to==t.doc.length:s.from==0)continue;let r=t.doc.lineAt(n?s.to+1:s.from-1),l=r.length+1;if(n){i.push({from:s.to,to:r.to},{from:s.from,insert:r.text+t.lineBreak});for(let c of s.ranges)o.push(d.range(Math.min(t.doc.length,c.anchor+l),Math.min(t.doc.length,c.head+l)))}else{i.push({from:r.from,to:s.from},{from:s.to,insert:t.lineBreak+r.text});for(let c of s.ranges)o.push(d.range(c.anchor-l,c.head-l))}}return i.length?(e(t.update({changes:i,scrollIntoView:!0,selection:d.create(o,t.selection.mainIndex),userEvent:"move.line"})),!0):!1}const yo=({state:t,dispatch:e})=>bn(t,e,!1),xo=({state:t,dispatch:e})=>bn(t,e,!0);function Sn(t,e,n){if(t.readOnly)return!1;let i=[];for(let o of Fe(t))n?i.push({from:o.from,insert:t.doc.slice(o.from,o.to)+t.lineBreak}):i.push({from:o.to,insert:t.lineBreak+t.doc.slice(o.from,o.to)});return e(t.update({changes:i,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const bo=({state:t,dispatch:e})=>Sn(t,e,!1),So=({state:t,dispatch:e})=>Sn(t,e,!0),Co=t=>{if(t.state.readOnly)return!1;let{state:e}=t,n=e.changes(Fe(e).map(({from:o,to:s})=>(o>0?o--:s<e.doc.length&&s++,{from:o,to:s}))),i=oe(e.selection,o=>{let s;if(t.lineWrapping){let r=t.lineBlockAt(o.head),l=t.coordsAtPos(o.head,o.assoc||1);l&&(s=r.bottom+t.documentTop-l.bottom+t.defaultLineHeight/2)}return t.moveVertically(o,!0,s)}).map(n);return t.dispatch({changes:n,selection:i,scrollIntoView:!0,userEvent:"delete.line"}),!0};function ko(t,e){if(/\(\)|\[\]|\{\}/.test(t.sliceDoc(e-1,e+1)))return{from:e,to:e};let n=ie(t).resolveInner(e),i=n.childBefore(e),o=n.childAfter(e),s;return i&&o&&i.to<=e&&o.from>=e&&(s=i.type.prop(je.closedBy))&&s.indexOf(o.name)>-1&&t.doc.lineAt(i.to).from==t.doc.lineAt(o.from).from&&!/\S/.test(t.sliceDoc(i.to,o.from))?{from:i.to,to:o.from}:null}const Ao=Cn(!1),vo=Cn(!0);function Cn(t){return({state:e,dispatch:n})=>{if(e.readOnly)return!1;let i=e.changeByRange(o=>{let{from:s,to:r}=o,l=e.doc.lineAt(s),c=!t&&s==r&&ko(e,s);t&&(s=r=(r<=l.to?l:e.doc.lineAt(r)).to);let a=new $t(e,{simulateBreak:s,simulateDoubleBreak:!!c}),f=Nt(a,s);for(f==null&&(f=et(/^\s*/.exec(e.doc.lineAt(s).text)[0],e.tabSize));r<l.to&&/\s/.test(l.text[r-l.from]);)r++;c?{from:s,to:r}=c:s>l.from&&s<l.from+100&&!/\S/.test(l.text.slice(0,s))&&(s=l.from);let h=["",Ae(e,f)];return c&&h.push(Ae(e,a.lineIndent(l.from,-1))),{changes:{from:s,to:r,insert:qt.of(h)},range:d.cursor(s+1+h[1].length)}});return n(e.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}}function ct(t,e){let n=-1;return t.changeByRange(i=>{let o=[];for(let r=i.from;r<=i.to;){let l=t.doc.lineAt(r);l.number>n&&(i.empty||i.to>l.from)&&(e(l,o,i),n=l.number),r=l.to+1}let s=t.changes(o);return{changes:o,range:d.range(s.mapPos(i.anchor,1),s.mapPos(i.head,1))}})}const Mo=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let n=Object.create(null),i=new $t(t,{overrideIndentation:s=>{let r=n[s];return r??-1}}),o=ct(t,(s,r,l)=>{let c=Nt(i,s.from);if(c==null)return;/\S/.test(s.text)||(c=0);let a=/^\s*/.exec(s.text)[0],f=Ae(t,c);(a!=f||l.from<s.from+a.length)&&(n[s.from]=c,r.push({from:s.from,to:s.from+a.length,insert:f}))});return o.changes.empty||e(t.update(o,{userEvent:"indent"})),!0},Lo=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(ct(t,(n,i)=>{i.push({from:n.from,insert:t.facet(Qn)})}),{userEvent:"input.indent"})),!0),wo=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(ct(t,(n,i)=>{let o=/^\s*/.exec(n.text)[0];if(!o)return;let s=et(o,t.tabSize),r=0,l=Ae(t,Math.max(0,s-Ke(t)));for(;r<o.length&&r<l.length&&o.charCodeAt(r)==l.charCodeAt(r);)r++;i.push({from:n.from+r,to:n.from+o.length,insert:l.slice(r)})}),{userEvent:"delete.dedent"})),!0),Do=t=>(t.setTabFocusMode(),!0),Bo=[{key:"Ctrl-b",run:Xt,shift:cn,preventDefault:!0},{key:"Ctrl-f",run:Zt,shift:an},{key:"Ctrl-p",run:nn,shift:un},{key:"Ctrl-n",run:on,shift:dn},{key:"Ctrl-a",run:Ki,shift:oo},{key:"Ctrl-e",run:Gi,shift:so},{key:"Ctrl-d",run:gn},{key:"Ctrl-h",run:Ye},{key:"Ctrl-k",run:ho},{key:"Ctrl-Alt-h",run:xn},{key:"Ctrl-o",run:po},{key:"Ctrl-t",run:go},{key:"Ctrl-v",run:_e}],Io=[{key:"ArrowLeft",run:Xt,shift:cn,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:Wi,shift:_i,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:Hi,shift:no,preventDefault:!0},{key:"ArrowRight",run:Zt,shift:an,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:$i,shift:Yi,preventDefault:!0},{mac:"Cmd-ArrowRight",run:ji,shift:io,preventDefault:!0},{key:"ArrowUp",run:nn,shift:un,preventDefault:!0},{mac:"Cmd-ArrowUp",run:bt,shift:Ct},{mac:"Ctrl-ArrowUp",run:gt,shift:yt},{key:"ArrowDown",run:on,shift:dn,preventDefault:!0},{mac:"Cmd-ArrowDown",run:St,shift:kt},{mac:"Ctrl-ArrowDown",run:_e,shift:xt},{key:"PageUp",run:gt,shift:yt},{key:"PageDown",run:_e,shift:xt},{key:"Home",run:zi,shift:to,preventDefault:!0},{key:"Mod-Home",run:bt,shift:Ct},{key:"End",run:Vi,shift:eo,preventDefault:!0},{key:"Mod-End",run:St,shift:kt},{key:"Enter",run:Ao},{key:"Mod-a",run:ro},{key:"Backspace",run:Ye,shift:Ye},{key:"Delete",run:gn},{key:"Mod-Backspace",mac:"Alt-Backspace",run:xn},{key:"Mod-Delete",mac:"Alt-Delete",run:fo},{mac:"Mod-Backspace",run:uo},{mac:"Mod-Delete",run:mo}].concat(Bo.map(t=>({mac:t.key,run:t.run,shift:t.shift}))),Ro=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:qi,shift:Xi},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:Ui,shift:Zi},{key:"Alt-ArrowUp",run:yo},{key:"Shift-Alt-ArrowUp",run:bo},{key:"Alt-ArrowDown",run:xo},{key:"Shift-Alt-ArrowDown",run:So},{key:"Escape",run:ao},{key:"Mod-Enter",run:vo},{key:"Alt-l",mac:"Ctrl-l",run:lo},{key:"Mod-i",run:co,preventDefault:!0},{key:"Mod-[",run:wo},{key:"Mod-]",run:Lo},{key:"Mod-Alt-\\",run:Mo},{key:"Shift-Mod-k",run:Co},{key:"Shift-Mod-\\",run:Qi},{key:"Mod-/",run:xi},{key:"Alt-A",run:Si},{key:"Ctrl-m",mac:"Shift-Alt-m",run:Do}].concat(Io);function g(){var t=arguments[0];typeof t=="string"&&(t=document.createElement(t));var e=1,n=arguments[1];if(n&&typeof n=="object"&&n.nodeType==null&&!Array.isArray(n)){for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)){var o=n[i];typeof o=="string"?t.setAttribute(i,o):o!=null&&(t[i]=o)}e++}for(;e<arguments.length;e++)kn(t,arguments[e]);return t}function kn(t,e){if(typeof e=="string")t.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)t.appendChild(e);else if(Array.isArray(e))for(var n=0;n<e.length;n++)kn(t,e[n]);else throw new RangeError("Unsupported child node: "+e)}const At=typeof String.prototype.normalize=="function"?t=>t.normalize("NFKD"):t=>t;class Z{constructor(e,n,i=0,o=e.length,s,r){this.test=r,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(i,o),this.bufferStart=i,this.normalize=s?l=>s(At(l)):At,this.query=this.normalize(n)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return R(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let n=ot(e),i=this.bufferStart+this.bufferPos;this.bufferPos+=$(e);let o=this.normalize(n);for(let s=0,r=i;;s++){let l=o.charCodeAt(s),c=this.match(l,r,this.bufferPos+this.bufferStart);if(s==o.length-1){if(c)return this.value=c,this;break}r==i&&s<n.length&&n.charCodeAt(s)==l&&r++}}}match(e,n,i){let o=null;for(let s=0;s<this.matches.length;s+=2){let r=this.matches[s],l=!1;this.query.charCodeAt(r)==e&&(r==this.query.length-1?o={from:this.matches[s+1],to:i}:(this.matches[s]++,l=!0)),l||(this.matches.splice(s,2),s-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?o={from:n,to:i}:this.matches.push(1,n)),o&&this.test&&!this.test(o.from,o.to,this.buffer,this.bufferStart)&&(o=null),o}}typeof Symbol<"u"&&(Z.prototype[Symbol.iterator]=function(){return this});const An={from:-1,to:-1,match:/.*/.exec("")},at="gm"+(/x/.unicode==null?"":"u");class vn{constructor(e,n,i,o=0,s=e.length){if(this.text=e,this.to=s,this.curLine="",this.done=!1,this.value=An,/\\[sWDnr]|\n|\r|\[\^/.test(n))return new Mn(e,n,i,o,s);this.re=new RegExp(n,at+(i!=null&&i.ignoreCase?"i":"")),this.test=i==null?void 0:i.test,this.iter=e.iter();let r=e.lineAt(o);this.curLineStart=r.from,this.matchPos=Me(e,o),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let n=this.matchPos<=this.to&&this.re.exec(this.curLine);if(n){let i=this.curLineStart+n.index,o=i+n[0].length;if(this.matchPos=Me(this.text,o+(i==o?1:0)),i==this.curLineStart+this.curLine.length&&this.nextLine(),(i<o||i>this.value.to)&&(!this.test||this.test(i,o,n)))return this.value={from:i,to:o,match:n},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const Ue=new WeakMap;class Y{constructor(e,n){this.from=e,this.text=n}get to(){return this.from+this.text.length}static get(e,n,i){let o=Ue.get(e);if(!o||o.from>=i||o.to<=n){let l=new Y(n,e.sliceString(n,i));return Ue.set(e,l),l}if(o.from==n&&o.to==i)return o;let{text:s,from:r}=o;return r>n&&(s=e.sliceString(n,r)+s,r=n),o.to<i&&(s+=e.sliceString(o.to,i)),Ue.set(e,new Y(r,s)),new Y(n,s.slice(n-r,i-r))}}class Mn{constructor(e,n,i,o,s){this.text=e,this.to=s,this.done=!1,this.value=An,this.matchPos=Me(e,o),this.re=new RegExp(n,at+(i!=null&&i.ignoreCase?"i":"")),this.test=i==null?void 0:i.test,this.flat=Y.get(e,o,this.chunkEnd(o+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,n=this.re.exec(this.flat.text);if(n&&!n[0]&&n.index==e&&(this.re.lastIndex=e+1,n=this.re.exec(this.flat.text)),n){let i=this.flat.from+n.index,o=i+n[0].length;if((this.flat.to>=this.to||n.index+n[0].length<=this.flat.text.length-10)&&(!this.test||this.test(i,o,n)))return this.value={from:i,to:o,match:n},this.matchPos=Me(this.text,o+(i==o?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=Y.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(vn.prototype[Symbol.iterator]=Mn.prototype[Symbol.iterator]=function(){return this});function Oo(t){try{return new RegExp(t,at),!0}catch{return!1}}function Me(t,e){if(e>=t.length)return e;let n=t.lineAt(e),i;for(;e<n.to&&(i=n.text.charCodeAt(e-n.from))>=56320&&i<57344;)e++;return e}function Xe(t){let e=String(t.state.doc.lineAt(t.state.selection.main.head).number),n=g("input",{class:"cm-textfield",name:"line",value:e}),i=g("form",{class:"cm-gotoLine",onkeydown:s=>{s.keyCode==27?(s.preventDefault(),t.dispatch({effects:Le.of(!1)}),t.focus()):s.keyCode==13&&(s.preventDefault(),o())},onsubmit:s=>{s.preventDefault(),o()}},g("label",t.state.phrase("Go to line"),": ",n)," ",g("button",{class:"cm-button",type:"submit"},t.state.phrase("go")));function o(){let s=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(n.value);if(!s)return;let{state:r}=t,l=r.doc.lineAt(r.selection.main.head),[,c,a,f,h]=s,u=f?+f.slice(1):0,m=a?+a:l.number;if(a&&h){let V=m/100;c&&(V=V*(c=="-"?-1:1)+l.number/r.doc.lines),m=Math.round(r.doc.lines*V)}else a&&c&&(m=m*(c=="-"?-1:1)+l.number);let p=r.doc.line(Math.max(1,Math.min(r.doc.lines,m))),C=d.cursor(p.from+Math.max(0,Math.min(u,p.length)));t.dispatch({effects:[Le.of(!1),y.scrollIntoView(C.from,{y:"center"})],selection:C}),t.focus()}return{dom:i}}const Le=k.define(),vt=ne.define({create(){return!0},update(t,e){for(let n of e.effects)n.is(Le)&&(t=n.value);return t},provide:t=>st.from(t,e=>e?Xe:null)}),To=t=>{let e=ce(t,Xe);if(!e){let n=[Le.of(!0)];t.state.field(vt,!1)==null&&n.push(k.appendConfig.of([vt,Eo])),t.dispatch({effects:n}),e=ce(t,Xe)}return e&&e.dom.querySelector("input").select(),!0},Eo=y.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),Po={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},Fo=te.define({combine(t){return me(t,Po,{highlightWordAroundCursor:(e,n)=>e||n,minSelectionLength:Math.min,maxMatches:Math.min})}});function Wo(t){return[Vo,Uo]}const $o=b.mark({class:"cm-selectionMatch"}),No=b.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function Mt(t,e,n,i){return(n==0||t(e.sliceDoc(n-1,n))!=v.Word)&&(i==e.doc.length||t(e.sliceDoc(i,i+1))!=v.Word)}function qo(t,e,n,i){return t(e.sliceDoc(n,n+1))==v.Word&&t(e.sliceDoc(i-1,i))==v.Word}const Uo=nt.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.selectionSet||t.docChanged||t.viewportChanged)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=t.state.facet(Fo),{state:n}=t,i=n.selection;if(i.ranges.length>1)return b.none;let o=i.main,s,r=null;if(o.empty){if(!e.highlightWordAroundCursor)return b.none;let c=n.wordAt(o.head);if(!c)return b.none;r=n.charCategorizer(o.head),s=n.sliceDoc(c.from,c.to)}else{let c=o.to-o.from;if(c<e.minSelectionLength||c>200)return b.none;if(e.wholeWords){if(s=n.sliceDoc(o.from,o.to),r=n.charCategorizer(o.head),!(Mt(r,n,o.from,o.to)&&qo(r,n,o.from,o.to)))return b.none}else if(s=n.sliceDoc(o.from,o.to),!s)return b.none}let l=[];for(let c of t.visibleRanges){let a=new Z(n.doc,s,c.from,c.to);for(;!a.next().done;){let{from:f,to:h}=a.value;if((!r||Mt(r,n,f,h))&&(o.empty&&f<=o.from&&h>=o.to?l.push(No.range(f,h)):(f>=o.to||h<=o.from)&&l.push($o.range(f,h)),l.length>e.maxMatches))return b.none}}return b.set(l)}},{decorations:t=>t.decorations}),Vo=y.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),zo=({state:t,dispatch:e})=>{let{selection:n}=t,i=d.create(n.ranges.map(o=>t.wordAt(o.head)||d.cursor(o.head)),n.mainIndex);return i.eq(n)?!1:(e(t.update({selection:i})),!0)};function Ho(t,e){let{main:n,ranges:i}=t.selection,o=t.wordAt(n.head),s=o&&o.from==n.from&&o.to==n.to;for(let r=!1,l=new Z(t.doc,e,i[i.length-1].to);;)if(l.next(),l.done){if(r)return null;l=new Z(t.doc,e,0,Math.max(0,i[i.length-1].from-1)),r=!0}else{if(r&&i.some(c=>c.from==l.value.from))continue;if(s){let c=t.wordAt(l.value.from);if(!c||c.from!=l.value.from||c.to!=l.value.to)continue}return l.value}}const jo=({state:t,dispatch:e})=>{let{ranges:n}=t.selection;if(n.some(s=>s.from===s.to))return zo({state:t,dispatch:e});let i=t.sliceDoc(n[0].from,n[0].to);if(t.selection.ranges.some(s=>t.sliceDoc(s.from,s.to)!=i))return!1;let o=Ho(t,i);return o?(e(t.update({selection:t.selection.addRange(d.range(o.from,o.to),!1),effects:y.scrollIntoView(o.to)})),!0):!1},se=te.define({combine(t){return me(t,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new is(e),scrollToMatch:e=>y.scrollIntoView(e)})}});class Ln{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||Oo(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(n,i)=>i=="n"?`
`:i=="r"?"\r":i=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new Qo(this):new Go(this)}getCursor(e,n=0,i){let o=e.doc?e:Vt.create({doc:e});return i==null&&(i=o.doc.length),this.regexp?J(this,o,n,i):G(this,o,n,i)}}class wn{constructor(e){this.spec=e}}function G(t,e,n,i){return new Z(e.doc,t.unquoted,n,i,t.caseSensitive?void 0:o=>o.toLowerCase(),t.wholeWord?Ko(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function Ko(t,e){return(n,i,o,s)=>((s>n||s+o.length<i)&&(s=Math.max(0,n-2),o=t.sliceString(s,Math.min(t.length,i+2))),(e(we(o,n-s))!=v.Word||e(De(o,n-s))!=v.Word)&&(e(De(o,i-s))!=v.Word||e(we(o,i-s))!=v.Word))}class Go extends wn{constructor(e){super(e)}nextMatch(e,n,i){let o=G(this.spec,e,i,e.doc.length).nextOverlapping();return o.done&&(o=G(this.spec,e,0,n).nextOverlapping()),o.done?null:o.value}prevMatchInRange(e,n,i){for(let o=i;;){let s=Math.max(n,o-1e4-this.spec.unquoted.length),r=G(this.spec,e,s,o),l=null;for(;!r.nextOverlapping().done;)l=r.value;if(l)return l;if(s==n)return null;o-=1e4}}prevMatch(e,n,i){return this.prevMatchInRange(e,0,n)||this.prevMatchInRange(e,i,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,n){let i=G(this.spec,e,0,e.doc.length),o=[];for(;!i.next().done;){if(o.length>=n)return null;o.push(i.value)}return o}highlight(e,n,i,o){let s=G(this.spec,e,Math.max(0,n-this.spec.unquoted.length),Math.min(i+this.spec.unquoted.length,e.doc.length));for(;!s.next().done;)o(s.value.from,s.value.to)}}function J(t,e,n,i){return new vn(e.doc,t.search,{ignoreCase:!t.caseSensitive,test:t.wholeWord?Jo(e.charCategorizer(e.selection.main.head)):void 0},n,i)}function we(t,e){return t.slice(j(t,e,!1),e)}function De(t,e){return t.slice(e,j(t,e))}function Jo(t){return(e,n,i)=>!i[0].length||(t(we(i.input,i.index))!=v.Word||t(De(i.input,i.index))!=v.Word)&&(t(De(i.input,i.index+i[0].length))!=v.Word||t(we(i.input,i.index+i[0].length))!=v.Word)}class Qo extends wn{nextMatch(e,n,i){let o=J(this.spec,e,i,e.doc.length).next();return o.done&&(o=J(this.spec,e,0,n).next()),o.done?null:o.value}prevMatchInRange(e,n,i){for(let o=1;;o++){let s=Math.max(n,i-o*1e4),r=J(this.spec,e,s,i),l=null;for(;!r.next().done;)l=r.value;if(l&&(s==n||l.from>s+10))return l;if(s==n)return null}}prevMatch(e,n,i){return this.prevMatchInRange(e,0,n)||this.prevMatchInRange(e,i,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&\d+])/g,(n,i)=>i=="$"?"$":i=="&"?e.match[0]:i!="0"&&+i<e.match.length?e.match[i]:n)}matchAll(e,n){let i=J(this.spec,e,0,e.doc.length),o=[];for(;!i.next().done;){if(o.length>=n)return null;o.push(i.value)}return o}highlight(e,n,i,o){let s=J(this.spec,e,Math.max(0,n-250),Math.min(i+250,e.doc.length));for(;!s.next().done;)o(s.value.from,s.value.to)}}const ae=k.define(),ft=k.define(),N=ne.define({create(t){return new Ve(Ze(t).create(),null)},update(t,e){for(let n of e.effects)n.is(ae)?t=new Ve(n.value.create(),t.panel):n.is(ft)&&(t=new Ve(t.query,n.value?ht:null));return t},provide:t=>st.from(t,e=>e.panel)});class Ve{constructor(e,n){this.query=e,this.panel=n}}const _o=b.mark({class:"cm-searchMatch"}),Yo=b.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Xo=nt.fromClass(class{constructor(t){this.view=t,this.decorations=this.highlight(t.state.field(N))}update(t){let e=t.state.field(N);(e!=t.startState.field(N)||t.docChanged||t.selectionSet||t.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:t,panel:e}){if(!e||!t.spec.valid)return b.none;let{view:n}=this,i=new _n;for(let o=0,s=n.visibleRanges,r=s.length;o<r;o++){let{from:l,to:c}=s[o];for(;o<r-1&&c>s[o+1].from-2*250;)c=s[++o].to;t.highlight(n.state,l,c,(a,f)=>{let h=n.state.selection.ranges.some(u=>u.from==a&&u.to==f);i.add(a,f,h?Yo:_o)})}return i.finish()}},{decorations:t=>t.decorations});function ge(t){return e=>{let n=e.state.field(N,!1);return n&&n.query.spec.valid?t(e,n):In(e)}}const Be=ge((t,{query:e})=>{let{to:n}=t.state.selection.main,i=e.nextMatch(t.state,n,n);if(!i)return!1;let o=d.single(i.from,i.to),s=t.state.facet(se);return t.dispatch({selection:o,effects:[ut(t,i),s.scrollToMatch(o.main,t)],userEvent:"select.search"}),Bn(t),!0}),Ie=ge((t,{query:e})=>{let{state:n}=t,{from:i}=n.selection.main,o=e.prevMatch(n,i,i);if(!o)return!1;let s=d.single(o.from,o.to),r=t.state.facet(se);return t.dispatch({selection:s,effects:[ut(t,o),r.scrollToMatch(s.main,t)],userEvent:"select.search"}),Bn(t),!0}),Zo=ge((t,{query:e})=>{let n=e.matchAll(t.state,1e3);return!n||!n.length?!1:(t.dispatch({selection:d.create(n.map(i=>d.range(i.from,i.to))),userEvent:"select.search.matches"}),!0)}),es=({state:t,dispatch:e})=>{let n=t.selection;if(n.ranges.length>1||n.main.empty)return!1;let{from:i,to:o}=n.main,s=[],r=0;for(let l=new Z(t.doc,t.sliceDoc(i,o));!l.next().done;){if(s.length>1e3)return!1;l.value.from==i&&(r=s.length),s.push(d.range(l.value.from,l.value.to))}return e(t.update({selection:d.create(s,r),userEvent:"select.search.matches"})),!0},Lt=ge((t,{query:e})=>{let{state:n}=t,{from:i,to:o}=n.selection.main;if(n.readOnly)return!1;let s=e.nextMatch(n,i,i);if(!s)return!1;let r=[],l,c,a=[];if(s.from==i&&s.to==o&&(c=n.toText(e.getReplacement(s)),r.push({from:s.from,to:s.to,insert:c}),s=e.nextMatch(n,s.from,s.to),a.push(y.announce.of(n.phrase("replaced match on line $",n.doc.lineAt(i).number)+"."))),s){let f=r.length==0||r[0].from>=s.to?0:s.to-s.from-c.length;l=d.single(s.from-f,s.to-f),a.push(ut(t,s)),a.push(n.facet(se).scrollToMatch(l.main,t))}return t.dispatch({changes:r,selection:l,effects:a,userEvent:"input.replace"}),!0}),ts=ge((t,{query:e})=>{if(t.state.readOnly)return!1;let n=e.matchAll(t.state,1e9).map(o=>{let{from:s,to:r}=o;return{from:s,to:r,insert:e.getReplacement(o)}});if(!n.length)return!1;let i=t.state.phrase("replaced $ matches",n.length)+".";return t.dispatch({changes:n,effects:y.announce.of(i),userEvent:"input.replace.all"}),!0});function ht(t){return t.state.facet(se).createPanel(t)}function Ze(t,e){var n,i,o,s,r;let l=t.selection.main,c=l.empty||l.to>l.from+100?"":t.sliceDoc(l.from,l.to);if(e&&!c)return e;let a=t.facet(se);return new Ln({search:((n=e==null?void 0:e.literal)!==null&&n!==void 0?n:a.literal)?c:c.replace(/\n/g,"\\n"),caseSensitive:(i=e==null?void 0:e.caseSensitive)!==null&&i!==void 0?i:a.caseSensitive,literal:(o=e==null?void 0:e.literal)!==null&&o!==void 0?o:a.literal,regexp:(s=e==null?void 0:e.regexp)!==null&&s!==void 0?s:a.regexp,wholeWord:(r=e==null?void 0:e.wholeWord)!==null&&r!==void 0?r:a.wholeWord})}function Dn(t){let e=ce(t,ht);return e&&e.dom.querySelector("[main-field]")}function Bn(t){let e=Dn(t);e&&e==t.root.activeElement&&e.select()}const In=t=>{let e=t.state.field(N,!1);if(e&&e.panel){let n=Dn(t);if(n&&n!=t.root.activeElement){let i=Ze(t.state,e.query.spec);i.valid&&t.dispatch({effects:ae.of(i)}),n.focus(),n.select()}}else t.dispatch({effects:[ft.of(!0),e?ae.of(Ze(t.state,e.query.spec)):k.appendConfig.of(ss)]});return!0},Rn=t=>{let e=t.state.field(N,!1);if(!e||!e.panel)return!1;let n=ce(t,ht);return n&&n.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:ft.of(!1)}),!0},ns=[{key:"Mod-f",run:In,scope:"editor search-panel"},{key:"F3",run:Be,shift:Ie,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:Be,shift:Ie,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:Rn,scope:"editor search-panel"},{key:"Mod-Shift-l",run:es},{key:"Mod-Alt-g",run:To},{key:"Mod-d",run:jo,preventDefault:!0}];class is{constructor(e){this.view=e;let n=this.query=e.state.field(N).query.spec;this.commit=this.commit.bind(this),this.searchField=g("input",{value:n.search,placeholder:D(e,"Find"),"aria-label":D(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=g("input",{value:n.replace,placeholder:D(e,"Replace"),"aria-label":D(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=g("input",{type:"checkbox",name:"case",form:"",checked:n.caseSensitive,onchange:this.commit}),this.reField=g("input",{type:"checkbox",name:"re",form:"",checked:n.regexp,onchange:this.commit}),this.wordField=g("input",{type:"checkbox",name:"word",form:"",checked:n.wholeWord,onchange:this.commit});function i(o,s,r){return g("button",{class:"cm-button",name:o,onclick:s,type:"button"},r)}this.dom=g("div",{onkeydown:o=>this.keydown(o),class:"cm-search"},[this.searchField,i("next",()=>Be(e),[D(e,"next")]),i("prev",()=>Ie(e),[D(e,"previous")]),i("select",()=>Zo(e),[D(e,"all")]),g("label",null,[this.caseField,D(e,"match case")]),g("label",null,[this.reField,D(e,"regexp")]),g("label",null,[this.wordField,D(e,"by word")]),...e.state.readOnly?[]:[g("br"),this.replaceField,i("replace",()=>Lt(e),[D(e,"replace")]),i("replaceAll",()=>ts(e),[D(e,"replace all")])],g("button",{name:"close",onclick:()=>Rn(e),"aria-label":D(e,"close"),type:"button"},["Ã—"])])}commit(){let e=new Ln({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:ae.of(e)}))}keydown(e){Yn(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?Ie:Be)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),Lt(this.view))}update(e){for(let n of e.transactions)for(let i of n.effects)i.is(ae)&&!i.value.eq(this.query)&&this.setQuery(i.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(se).top}}function D(t,e){return t.state.phrase(e)}const be=30,Se=/[\s\.,:;?!]/;function ut(t,{from:e,to:n}){let i=t.state.doc.lineAt(e),o=t.state.doc.lineAt(n).to,s=Math.max(i.from,e-be),r=Math.min(o,n+be),l=t.state.sliceDoc(s,r);if(s!=i.from){for(let c=0;c<be;c++)if(!Se.test(l[c+1])&&Se.test(l[c])){l=l.slice(c);break}}if(r!=o){for(let c=l.length-1;c>l.length-be;c--)if(!Se.test(l[c-1])&&Se.test(l[c])){l=l.slice(0,c);break}}return y.announce.of(`${t.state.phrase("current match")}. ${l} ${t.state.phrase("on line")} ${i.number}.`)}const os=y.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),ss=[N,it.low(Xo),os];class On{constructor(e,n,i,o){this.state=e,this.pos=n,this.explicit=i,this.view=o,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let n=ie(this.state).resolveInner(this.pos,-1);for(;n&&e.indexOf(n.name)<0;)n=n.parent;return n?{from:n.from,to:this.pos,text:this.state.sliceDoc(n.from,this.pos),type:n.type}:null}matchBefore(e){let n=this.state.doc.lineAt(this.pos),i=Math.max(n.from,this.pos-250),o=n.text.slice(i-n.from,this.pos-n.from),s=o.search(Tn(e,!1));return s<0?null:{from:i+s,to:this.pos,text:o.slice(s)}}get aborted(){return this.abortListeners==null}addEventListener(e,n,i){e=="abort"&&this.abortListeners&&(this.abortListeners.push(n),i&&i.onDocChange&&(this.abortOnDocChange=!0))}}function wt(t){let e=Object.keys(t).join(""),n=/\w/.test(e);return n&&(e=e.replace(/\w/g,"")),`[${n?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function rs(t){let e=Object.create(null),n=Object.create(null);for(let{label:o}of t){e[o[0]]=!0;for(let s=1;s<o.length;s++)n[o[s]]=!0}let i=wt(e)+wt(n)+"*$";return[new RegExp("^"+i),new RegExp(i)]}function ls(t){let e=t.map(o=>typeof o=="string"?{label:o}:o),[n,i]=e.every(o=>/^\w+$/.test(o.label))?[/\w*$/,/\w+$/]:rs(e);return o=>{let s=o.matchBefore(i);return s||o.explicit?{from:s?s.from:o.pos,options:e,validFor:n}:null}}class Dt{constructor(e,n,i,o){this.completion=e,this.source=n,this.match=i,this.score=o}}function q(t){return t.selection.main.from}function Tn(t,e){var n;let{source:i}=t,o=e&&i[0]!="^",s=i[i.length-1]!="$";return!o&&!s?t:new RegExp(`${o?"^":""}(?:${i})${s?"$":""}`,(n=t.flags)!==null&&n!==void 0?n:t.ignoreCase?"i":"")}const En=tt.define();function cs(t,e,n,i){let{main:o}=t.selection,s=n-o.from,r=i-o.from;return Object.assign(Object.assign({},t.changeByRange(l=>{if(l!=o&&n!=i&&t.sliceDoc(l.from+s,l.from+r)!=t.sliceDoc(n,i))return{range:l};let c=t.toText(e);return{changes:{from:l.from+s,to:i==o.from?l.to:l.from+r,insert:c},range:d.cursor(l.from+s+c.length)}})),{scrollIntoView:!0,userEvent:"input.complete"})}const Bt=new WeakMap;function as(t){if(!Array.isArray(t))return t;let e=Bt.get(t);return e||Bt.set(t,e=ls(t)),e}const Re=k.define(),fe=k.define();class fs{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let n=0;n<e.length;){let i=R(e,n),o=$(i);this.chars.push(i);let s=e.slice(n,n+o),r=s.toUpperCase();this.folded.push(R(r==s?s.toLowerCase():r,0)),n+=o}this.astral=e.length!=this.chars.length}ret(e,n){return this.score=e,this.matched=n,this}match(e){if(this.pattern.length==0)return this.ret(-100,[]);if(e.length<this.pattern.length)return null;let{chars:n,folded:i,any:o,precise:s,byWord:r}=this;if(n.length==1){let x=R(e,0),K=$(x),W=K==e.length?0:-100;if(x!=n[0])if(x==i[0])W+=-200;else return null;return this.ret(W,[0,K])}let l=e.indexOf(this.pattern);if(l==0)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let c=n.length,a=0;if(l<0){for(let x=0,K=Math.min(e.length,200);x<K&&a<c;){let W=R(e,x);(W==n[a]||W==i[a])&&(o[a++]=x),x+=$(W)}if(a<c)return null}let f=0,h=0,u=!1,m=0,p=-1,C=-1,V=/[a-z]/.test(e),re=!0;for(let x=0,K=Math.min(e.length,200),W=0;x<K&&h<c;){let M=R(e,x);l<0&&(f<c&&M==n[f]&&(s[f++]=x),m<c&&(M==n[m]||M==i[m]?(m==0&&(p=x),C=x+1,m++):m=0));let ye,$e=M<255?M>=48&&M<=57||M>=97&&M<=122?2:M>=65&&M<=90?1:0:(ye=ot(M))!=ye.toLowerCase()?1:ye!=ye.toUpperCase()?2:0;(!x||$e==1&&V||W==0&&$e!=0)&&(n[h]==M||i[h]==M&&(u=!0)?r[h++]=x:r.length&&(re=!1)),W=$e,x+=$(M)}return h==c&&r[0]==0&&re?this.result(-100+(u?-200:0),r,e):m==c&&p==0?this.ret(-200-e.length+(C==e.length?0:-100),[0,C]):l>-1?this.ret(-700-e.length,[l,l+this.pattern.length]):m==c?this.ret(-900-e.length,[p,C]):h==c?this.result(-100+(u?-200:0)+-700+(re?0:-1100),r,e):n.length==2?null:this.result((o[0]?-700:0)+-200+-1100,o,e)}result(e,n,i){let o=[],s=0;for(let r of n){let l=r+(this.astral?$(R(i,r)):1);s&&o[s-1]==r?o[s-1]=l:(o[s++]=r,o[s++]=l)}return this.ret(e-i.length,o)}}class hs{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let n=e.slice(0,this.pattern.length),i=n==this.pattern?0:n.toLowerCase()==this.folded?-200:null;return i==null?null:(this.matched=[0,n.length],this.score=i+(e.length==this.pattern.length?0:-100),this)}}const S=te.define({combine(t){return me(t,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:us,filterStrict:!1,compareCompletions:(e,n)=>e.label.localeCompare(n.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,n)=>e&&n,closeOnBlur:(e,n)=>e&&n,icons:(e,n)=>e&&n,tooltipClass:(e,n)=>i=>It(e(i),n(i)),optionClass:(e,n)=>i=>It(e(i),n(i)),addToOptions:(e,n)=>e.concat(n),filterStrict:(e,n)=>e||n})}});function It(t,e){return t?e?t+" "+e:t:e}function us(t,e,n,i,o,s){let r=t.textDirection==Ut.RTL,l=r,c=!1,a="top",f,h,u=e.left-o.left,m=o.right-e.right,p=i.right-i.left,C=i.bottom-i.top;if(l&&u<Math.min(p,m)?l=!1:!l&&m<Math.min(p,u)&&(l=!0),p<=(l?u:m))f=Math.max(o.top,Math.min(n.top,o.bottom-C))-e.top,h=Math.min(400,l?u:m);else{c=!0,h=Math.min(400,(r?e.right:o.right-e.left)-30);let x=o.bottom-e.bottom;x>=C||x>e.top?f=n.bottom-e.top:(a="bottom",f=e.bottom-n.top)}let V=(e.bottom-e.top)/s.offsetHeight,re=(e.right-e.left)/s.offsetWidth;return{style:`${a}: ${f/V}px; max-width: ${h/re}px`,class:"cm-completionInfo-"+(c?r?"left-narrow":"right-narrow":l?"left":"right")}}function ds(t){let e=t.addToOptions.slice();return t.icons&&e.push({render(n){let i=document.createElement("div");return i.classList.add("cm-completionIcon"),n.type&&i.classList.add(...n.type.split(/\s+/g).map(o=>"cm-completionIcon-"+o)),i.setAttribute("aria-hidden","true"),i},position:20}),e.push({render(n,i,o,s){let r=document.createElement("span");r.className="cm-completionLabel";let l=n.displayLabel||n.label,c=0;for(let a=0;a<s.length;){let f=s[a++],h=s[a++];f>c&&r.appendChild(document.createTextNode(l.slice(c,f)));let u=r.appendChild(document.createElement("span"));u.appendChild(document.createTextNode(l.slice(f,h))),u.className="cm-completionMatchedText",c=h}return c<l.length&&r.appendChild(document.createTextNode(l.slice(c))),r},position:50},{render(n){if(!n.detail)return null;let i=document.createElement("span");return i.className="cm-completionDetail",i.textContent=n.detail,i},position:80}),e.sort((n,i)=>n.position-i.position).map(n=>n.render)}function ze(t,e,n){if(t<=n)return{from:0,to:t};if(e<0&&(e=0),e<=t>>1){let o=Math.floor(e/n);return{from:o*n,to:(o+1)*n}}let i=Math.floor((t-e)/n);return{from:t-(i+1)*n,to:t-i*n}}class ms{constructor(e,n,i){this.view=e,this.stateField=n,this.applyCompletion=i,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:c=>this.placeInfo(c),key:this},this.space=null,this.currentClass="";let o=e.state.field(n),{options:s,selected:r}=o.open,l=e.state.facet(S);this.optionContent=ds(l),this.optionClass=l.optionClass,this.tooltipClass=l.tooltipClass,this.range=ze(s.length,r,l.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",c=>{let{options:a}=e.state.field(n).open;for(let f=c.target,h;f&&f!=this.dom;f=f.parentNode)if(f.nodeName=="LI"&&(h=/-(\d+)$/.exec(f.id))&&+h[1]<a.length){this.applyCompletion(e,a[+h[1]]),c.preventDefault();return}}),this.dom.addEventListener("focusout",c=>{let a=e.state.field(this.stateField,!1);a&&a.tooltip&&e.state.facet(S).closeOnBlur&&c.relatedTarget!=e.contentDOM&&e.dispatch({effects:fe.of(null)})}),this.showOptions(s,o.id)}mount(){this.updateSel()}showOptions(e,n){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,n,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var n;let i=e.state.field(this.stateField),o=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),i!=o){let{options:s,selected:r,disabled:l}=i.open;(!o.open||o.open.options!=s)&&(this.range=ze(s.length,r,e.state.facet(S).maxRenderedOptions),this.showOptions(s,i.id)),this.updateSel(),l!=((n=o.open)===null||n===void 0?void 0:n.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!l)}}updateTooltipClass(e){let n=this.tooltipClass(e);if(n!=this.currentClass){for(let i of this.currentClass.split(" "))i&&this.dom.classList.remove(i);for(let i of n.split(" "))i&&this.dom.classList.add(i);this.currentClass=n}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),n=e.open;if((n.selected>-1&&n.selected<this.range.from||n.selected>=this.range.to)&&(this.range=ze(n.options.length,n.selected,this.view.state.facet(S).maxRenderedOptions),this.showOptions(n.options,e.id)),this.updateSelectedOption(n.selected)){this.destroyInfo();let{completion:i}=n.options[n.selected],{info:o}=i;if(!o)return;let s=typeof o=="string"?document.createTextNode(o):o(i);if(!s)return;"then"in s?s.then(r=>{r&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(r,i)}).catch(r=>Ge(this.view.state,r,"completion info")):this.addInfoPane(s,i)}}addInfoPane(e,n){this.destroyInfo();let i=this.info=document.createElement("div");if(i.className="cm-tooltip cm-completionInfo",e.nodeType!=null)i.appendChild(e),this.infoDestroy=null;else{let{dom:o,destroy:s}=e;i.appendChild(o),this.infoDestroy=s||null}this.dom.appendChild(i),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let n=null;for(let i=this.list.firstChild,o=this.range.from;i;i=i.nextSibling,o++)i.nodeName!="LI"||!i.id?o--:o==e?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),n=i):i.hasAttribute("aria-selected")&&i.removeAttribute("aria-selected");return n&&gs(this.list,n),n}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let n=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),o=e.getBoundingClientRect(),s=this.space;if(!s){let r=this.dom.ownerDocument.defaultView||window;s={left:0,top:0,right:r.innerWidth,bottom:r.innerHeight}}return o.top>Math.min(s.bottom,n.bottom)-10||o.bottom<Math.max(s.top,n.top)+10?null:this.view.state.facet(S).positionInfo(this.view,n,o,i,s,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,n,i){const o=document.createElement("ul");o.id=n,o.setAttribute("role","listbox"),o.setAttribute("aria-expanded","true"),o.setAttribute("aria-label",this.view.state.phrase("Completions"));let s=null;for(let r=i.from;r<i.to;r++){let{completion:l,match:c}=e[r],{section:a}=l;if(a){let u=typeof a=="string"?a:a.name;if(u!=s&&(r>i.from||i.from==0))if(s=u,typeof a!="string"&&a.header)o.appendChild(a.header(a));else{let m=o.appendChild(document.createElement("completion-section"));m.textContent=u}}const f=o.appendChild(document.createElement("li"));f.id=n+"-"+r,f.setAttribute("role","option");let h=this.optionClass(l);h&&(f.className=h);for(let u of this.optionContent){let m=u(l,this.view.state,this.view,c);m&&f.appendChild(m)}}return i.from&&o.classList.add("cm-completionListIncompleteTop"),i.to<e.length&&o.classList.add("cm-completionListIncompleteBottom"),o}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function ps(t,e){return n=>new ms(n,t,e)}function gs(t,e){let n=t.getBoundingClientRect(),i=e.getBoundingClientRect(),o=n.height/t.offsetHeight;i.top<n.top?t.scrollTop-=(n.top-i.top)/o:i.bottom>n.bottom&&(t.scrollTop+=(i.bottom-n.bottom)/o)}function Rt(t){return(t.boost||0)*100+(t.apply?10:0)+(t.info?5:0)+(t.type?1:0)}function ys(t,e){let n=[],i=null,o=a=>{n.push(a);let{section:f}=a.completion;if(f){i||(i=[]);let h=typeof f=="string"?f:f.name;i.some(u=>u.name==h)||i.push(typeof f=="string"?{name:h}:f)}},s=e.facet(S);for(let a of t)if(a.hasResult()){let f=a.result.getMatch;if(a.result.filter===!1)for(let h of a.result.options)o(new Dt(h,a.source,f?f(h):[],1e9-n.length));else{let h=e.sliceDoc(a.from,a.to),u,m=s.filterStrict?new hs(h):new fs(h);for(let p of a.result.options)if(u=m.match(p.label)){let C=p.displayLabel?f?f(p,u.matched):[]:u.matched;o(new Dt(p,a.source,C,u.score+(p.boost||0)))}}}if(i){let a=Object.create(null),f=0,h=(u,m)=>{var p,C;return((p=u.rank)!==null&&p!==void 0?p:1e9)-((C=m.rank)!==null&&C!==void 0?C:1e9)||(u.name<m.name?-1:1)};for(let u of i.sort(h))f-=1e5,a[u.name]=f;for(let u of n){let{section:m}=u.completion;m&&(u.score+=a[typeof m=="string"?m:m.name])}}let r=[],l=null,c=s.compareCompletions;for(let a of n.sort((f,h)=>h.score-f.score||c(f.completion,h.completion))){let f=a.completion;!l||l.label!=f.label||l.detail!=f.detail||l.type!=null&&f.type!=null&&l.type!=f.type||l.apply!=f.apply||l.boost!=f.boost?r.push(a):Rt(a.completion)>Rt(l)&&(r[r.length-1]=a),l=a.completion}return r}class _{constructor(e,n,i,o,s,r){this.options=e,this.attrs=n,this.tooltip=i,this.timestamp=o,this.selected=s,this.disabled=r}setSelected(e,n){return e==this.selected||e>=this.options.length?this:new _(this.options,Ot(n,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,n,i,o,s){let r=ys(e,n);if(!r.length)return o&&e.some(c=>c.state==1)?new _(o.options,o.attrs,o.tooltip,o.timestamp,o.selected,!0):null;let l=n.facet(S).selectOnOpen?0:-1;if(o&&o.selected!=l&&o.selected!=-1){let c=o.options[o.selected].completion;for(let a=0;a<r.length;a++)if(r[a].completion==c){l=a;break}}return new _(r,Ot(i,l),{pos:e.reduce((c,a)=>a.hasResult()?Math.min(c,a.from):c,1e8),create:As,above:s.aboveCursor},o?o.timestamp:Date.now(),l,!1)}map(e){return new _(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}}class Oe{constructor(e,n,i){this.active=e,this.id=n,this.open=i}static start(){return new Oe(Cs,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:n}=e,i=n.facet(S),s=(i.override||n.languageDataAt("autocomplete",q(n)).map(as)).map(l=>(this.active.find(a=>a.source==l)||new B(l,this.active.some(a=>a.state!=0)?1:0)).update(e,i));s.length==this.active.length&&s.every((l,c)=>l==this.active[c])&&(s=this.active);let r=this.open;r&&e.docChanged&&(r=r.map(e.changes)),e.selection||s.some(l=>l.hasResult()&&e.changes.touchesRange(l.from,l.to))||!xs(s,this.active)?r=_.build(s,n,this.id,r,i):r&&r.disabled&&!s.some(l=>l.state==1)&&(r=null),!r&&s.every(l=>l.state!=1)&&s.some(l=>l.hasResult())&&(s=s.map(l=>l.hasResult()?new B(l.source,0):l));for(let l of e.effects)l.is(Wn)&&(r=r&&r.setSelected(l.value,this.id));return s==this.active&&r==this.open?this:new Oe(s,this.id,r)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?bs:Ss}}function xs(t,e){if(t==e)return!0;for(let n=0,i=0;;){for(;n<t.length&&!t[n].hasResult;)n++;for(;i<e.length&&!e[i].hasResult;)i++;let o=n==t.length,s=i==e.length;if(o||s)return o==s;if(t[n++].result!=e[i++].result)return!1}}const bs={"aria-autocomplete":"list"},Ss={};function Ot(t,e){let n={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":t};return e>-1&&(n["aria-activedescendant"]=t+"-"+e),n}const Cs=[];function Pn(t,e){if(t.isUserEvent("input.complete")){let i=t.annotation(En);if(i&&e.activateOnCompletion(i))return 12}let n=t.isUserEvent("input.type");return n&&e.activateOnTyping?5:n?1:t.isUserEvent("delete.backward")?2:t.selection?8:t.docChanged?16:0}class B{constructor(e,n,i=-1){this.source=e,this.state=n,this.explicitPos=i}hasResult(){return!1}update(e,n){let i=Pn(e,n),o=this;(i&8||i&16&&this.touches(e))&&(o=new B(o.source,0)),i&4&&o.state==0&&(o=new B(this.source,1)),o=o.updateFor(e,i);for(let s of e.effects)if(s.is(Re))o=new B(o.source,1,s.value?q(e.state):-1);else if(s.is(fe))o=new B(o.source,0);else if(s.is(Fn))for(let r of s.value)r.source==o.source&&(o=r);return o}updateFor(e,n){return this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new B(this.source,this.state,e.mapPos(this.explicitPos))}touches(e){return e.changes.touchesRange(q(e.state))}}class X extends B{constructor(e,n,i,o,s){super(e,2,n),this.result=i,this.from=o,this.to=s}hasResult(){return!0}updateFor(e,n){var i;if(!(n&3))return this.map(e.changes);let o=this.result;o.map&&!e.changes.empty&&(o=o.map(o,e.changes));let s=e.changes.mapPos(this.from),r=e.changes.mapPos(this.to,1),l=q(e.state);if((this.explicitPos<0?l<=s:l<this.from)||l>r||!o||n&2&&q(e.startState)==this.from)return new B(this.source,n&4?1:0);let c=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos);return ks(o.validFor,e.state,s,r)?new X(this.source,c,o,s,r):o.update&&(o=o.update(o,s,r,new On(e.state,l,c>=0)))?new X(this.source,c,o,o.from,(i=o.to)!==null&&i!==void 0?i:q(e.state)):new B(this.source,1,c)}map(e){return e.empty?this:(this.result.map?this.result.map(this.result,e):this.result)?new X(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new B(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}}function ks(t,e,n,i){if(!t)return!1;let o=e.sliceDoc(n,i);return typeof t=="function"?t(o,n,i,e):Tn(t,!0).test(o)}const Fn=k.define({map(t,e){return t.map(n=>n.map(e))}}),Wn=k.define(),L=ne.define({create(){return Oe.start()},update(t,e){return t.update(e)},provide:t=>[Xn.from(t,e=>e.tooltip),y.contentAttributes.from(t,e=>e.attrs)]});function dt(t,e){const n=e.completion.apply||e.completion.label;let i=t.state.field(L).active.find(o=>o.source==e.source);return i instanceof X?(typeof n=="string"?t.dispatch(Object.assign(Object.assign({},cs(t.state,n,i.from,i.to)),{annotations:En.of(e.completion)})):n(t,e.completion,i.from,i.to),!0):!1}const As=ps(L,dt);function Ce(t,e="option"){return n=>{let i=n.state.field(L,!1);if(!i||!i.open||i.open.disabled||Date.now()-i.open.timestamp<n.state.facet(S).interactionDelay)return!1;let o=1,s;e=="page"&&(s=Ht(n,i.open.tooltip))&&(o=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let{length:r}=i.open.options,l=i.open.selected>-1?i.open.selected+o*(t?1:-1):t?0:r-1;return l<0?l=e=="page"?0:r-1:l>=r&&(l=e=="page"?r-1:0),n.dispatch({effects:Wn.of(l)}),!0}}const vs=t=>{let e=t.state.field(L,!1);return t.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<t.state.facet(S).interactionDelay?!1:dt(t,e.open.options[e.open.selected])},Tt=t=>t.state.field(L,!1)?(t.dispatch({effects:Re.of(!0)}),!0):!1,Ms=t=>{let e=t.state.field(L,!1);return!e||!e.active.some(n=>n.state!=0)?!1:(t.dispatch({effects:fe.of(null)}),!0)};class Ls{constructor(e,n){this.active=e,this.context=n,this.time=Date.now(),this.updates=[],this.done=void 0}}const ws=50,Ds=1e3,Bs=nt.fromClass(class{constructor(t){this.view=t,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let e of t.state.field(L).active)e.state==1&&this.startQuery(e)}update(t){let e=t.state.field(L),n=t.state.facet(S);if(!t.selectionSet&&!t.docChanged&&t.startState.field(L)==e)return;let i=t.transactions.some(s=>{let r=Pn(s,n);return r&8||(s.selection||s.docChanged)&&!(r&3)});for(let s=0;s<this.running.length;s++){let r=this.running[s];if(i||r.context.abortOnDocChange&&t.docChanged||r.updates.length+t.transactions.length>ws&&Date.now()-r.time>Ds){for(let l of r.context.abortListeners)try{l()}catch(c){Ge(this.view.state,c)}r.context.abortListeners=null,this.running.splice(s--,1)}else r.updates.push(...t.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),t.transactions.some(s=>s.effects.some(r=>r.is(Re)))&&(this.pendingStart=!0);let o=this.pendingStart?50:n.activateOnTypingDelay;if(this.debounceUpdate=e.active.some(s=>s.state==1&&!this.running.some(r=>r.active.source==s.source))?setTimeout(()=>this.startUpdate(),o):-1,this.composing!=0)for(let s of t.transactions)s.isUserEvent("input.type")?this.composing=2:this.composing==2&&s.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:t}=this.view,e=t.field(L);for(let n of e.active)n.state==1&&!this.running.some(i=>i.active.source==n.source)&&this.startQuery(n)}startQuery(t){let{state:e}=this.view,n=q(e),i=new On(e,n,t.explicitPos==n,this.view),o=new Ls(t,i);this.running.push(o),Promise.resolve(t.source(i)).then(s=>{o.context.aborted||(o.done=s||null,this.scheduleAccept())},s=>{this.view.dispatch({effects:fe.of(null)}),Ge(this.view.state,s)})}scheduleAccept(){this.running.every(t=>t.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(S).updateSyncTime))}accept(){var t;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],n=this.view.state.facet(S);for(let i=0;i<this.running.length;i++){let o=this.running[i];if(o.done===void 0)continue;if(this.running.splice(i--,1),o.done){let r=new X(o.active.source,o.active.explicitPos,o.done,o.done.from,(t=o.done.to)!==null&&t!==void 0?t:q(o.updates.length?o.updates[0].startState:this.view.state));for(let l of o.updates)r=r.update(l,n);if(r.hasResult()){e.push(r);continue}}let s=this.view.state.field(L).active.find(r=>r.source==o.active.source);if(s&&s.state==1)if(o.done==null){let r=new B(o.active.source,0);for(let l of o.updates)r=r.update(l,n);r.state!=1&&e.push(r)}else this.startQuery(s)}e.length&&this.view.dispatch({effects:Fn.of(e)})}},{eventHandlers:{blur(t){let e=this.view.state.field(L,!1);if(e&&e.tooltip&&this.view.state.facet(S).closeOnBlur){let n=e.open&&Ht(this.view,e.open.tooltip);(!n||!n.dom.contains(t.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:fe.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:Re.of(!1)}),20),this.composing=0}}}),Is=typeof navigator=="object"&&/Win/.test(navigator.platform),Rs=it.highest(y.domEventHandlers({keydown(t,e){let n=e.state.field(L,!1);if(!n||!n.open||n.open.disabled||n.open.selected<0||t.key.length>1||t.ctrlKey&&!(Is&&t.altKey)||t.metaKey)return!1;let i=n.open.options[n.open.selected],o=n.active.find(r=>r.source==i.source),s=i.completion.commitCharacters||o.result.commitCharacters;return s&&s.indexOf(t.key)>-1&&dt(e,i),!1}})),Os=y.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"Â·Â·Â·"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'Æ’'"}},".cm-completionIcon-class":{"&:after":{content:"'â—‹'"}},".cm-completionIcon-interface":{"&:after":{content:"'â—Œ'"}},".cm-completionIcon-variable":{"&:after":{content:"'ð‘¥'"}},".cm-completionIcon-constant":{"&:after":{content:"'ð¶'"}},".cm-completionIcon-type":{"&:after":{content:"'ð‘¡'"}},".cm-completionIcon-enum":{"&:after":{content:"'âˆª'"}},".cm-completionIcon-property":{"&:after":{content:"'â–¡'"}},".cm-completionIcon-keyword":{"&:after":{content:"'ðŸ”‘ï¸Ž'"}},".cm-completionIcon-namespace":{"&:after":{content:"'â–¢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),he={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},H=k.define({map(t,e){let n=e.mapPos(t,-1,Zn.TrackAfter);return n??void 0}}),mt=new class extends ei{};mt.startSide=1;mt.endSide=-1;const $n=ne.define({create(){return ti.empty},update(t,e){if(t=t.map(e.changes),e.selection){let n=e.state.doc.lineAt(e.selection.main.head);t=t.update({filter:i=>i>=n.from&&i<=n.to})}for(let n of e.effects)n.is(H)&&(t=t.update({add:[mt.range(n.value,n.value+1)]}));return t}});function Ts(){return[Ps,$n]}const He="()[]{}<>";function Nn(t){for(let e=0;e<He.length;e+=2)if(He.charCodeAt(e)==t)return He.charAt(e+1);return ot(t<128?t:t+1)}function qn(t,e){return t.languageDataAt("closeBrackets",e)[0]||he}const Es=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),Ps=y.inputHandler.of((t,e,n,i)=>{if((Es?t.composing:t.compositionStarted)||t.state.readOnly)return!1;let o=t.state.selection.main;if(i.length>2||i.length==2&&$(R(i,0))==1||e!=o.from||n!=o.to)return!1;let s=$s(t.state,i);return s?(t.dispatch(s),!0):!1}),Fs=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=qn(t,t.selection.main.head).brackets||he.brackets,o=null,s=t.changeByRange(r=>{if(r.empty){let l=Ns(t.doc,r.head);for(let c of i)if(c==l&&We(t.doc,r.head)==Nn(R(c,0)))return{changes:{from:r.head-c.length,to:r.head+c.length},range:d.cursor(r.head-c.length)}}return{range:o=r}});return o||e(t.update(s,{scrollIntoView:!0,userEvent:"delete.backward"})),!o},Ws=[{key:"Backspace",run:Fs}];function $s(t,e){let n=qn(t,t.selection.main.head),i=n.brackets||he.brackets;for(let o of i){let s=Nn(R(o,0));if(e==o)return s==o?Vs(t,o,i.indexOf(o+o+o)>-1,n):qs(t,o,s,n.before||he.before);if(e==s&&Un(t,t.selection.main.from))return Us(t,o,s)}return null}function Un(t,e){let n=!1;return t.field($n).between(0,t.doc.length,i=>{i==e&&(n=!0)}),n}function We(t,e){let n=t.sliceString(e,e+2);return n.slice(0,$(R(n,0)))}function Ns(t,e){let n=t.sliceString(e-2,e);return $(R(n,0))==n.length?n:n.slice(1)}function qs(t,e,n,i){let o=null,s=t.changeByRange(r=>{if(!r.empty)return{changes:[{insert:e,from:r.from},{insert:n,from:r.to}],effects:H.of(r.to+e.length),range:d.range(r.anchor+e.length,r.head+e.length)};let l=We(t.doc,r.head);return!l||/\s/.test(l)||i.indexOf(l)>-1?{changes:{insert:e+n,from:r.head},effects:H.of(r.head+e.length),range:d.cursor(r.head+e.length)}:{range:o=r}});return o?null:t.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function Us(t,e,n){let i=null,o=t.changeByRange(s=>s.empty&&We(t.doc,s.head)==n?{changes:{from:s.head,to:s.head+n.length,insert:n},range:d.cursor(s.head+n.length)}:i={range:s});return i?null:t.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function Vs(t,e,n,i){let o=i.stringPrefixes||he.stringPrefixes,s=null,r=t.changeByRange(l=>{if(!l.empty)return{changes:[{insert:e,from:l.from},{insert:e,from:l.to}],effects:H.of(l.to+e.length),range:d.range(l.anchor+e.length,l.head+e.length)};let c=l.head,a=We(t.doc,c),f;if(a==e){if(Et(t,c))return{changes:{insert:e+e,from:c},effects:H.of(c+e.length),range:d.cursor(c+e.length)};if(Un(t,c)){let u=n&&t.sliceDoc(c,c+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:c,to:c+u.length,insert:u},range:d.cursor(c+u.length)}}}else{if(n&&t.sliceDoc(c-2*e.length,c)==e+e&&(f=Pt(t,c-2*e.length,o))>-1&&Et(t,f))return{changes:{insert:e+e+e+e,from:c},effects:H.of(c+e.length),range:d.cursor(c+e.length)};if(t.charCategorizer(c)(a)!=v.Word&&Pt(t,c,o)>-1&&!zs(t,c,e,o))return{changes:{insert:e+e,from:c},effects:H.of(c+e.length),range:d.cursor(c+e.length)}}return{range:s=l}});return s?null:t.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function Et(t,e){let n=ie(t).resolveInner(e+1);return n.parent&&n.from==e}function zs(t,e,n,i){let o=ie(t).resolveInner(e,-1),s=i.reduce((r,l)=>Math.max(r,l.length),0);for(let r=0;r<5;r++){let l=t.sliceDoc(o.from,Math.min(o.to,o.from+n.length+s)),c=l.indexOf(n);if(!c||c>-1&&i.indexOf(l.slice(0,c))>-1){let f=o.firstChild;for(;f&&f.from==o.from&&f.to-f.from>n.length+c;){if(t.sliceDoc(f.to-n.length,f.to)==n)return!1;f=f.firstChild}return!0}let a=o.to==e&&o.parent;if(!a)break;o=a}return!1}function Pt(t,e,n){let i=t.charCategorizer(e);if(i(t.sliceDoc(e-1,e))!=v.Word)return e;for(let o of n){let s=e-o.length;if(t.sliceDoc(s,e)==o&&i(t.sliceDoc(s-1,s))!=v.Word)return s}return-1}function Hs(t={}){return[Rs,L,S.of(t),Bs,js,Os]}const Vn=[{key:"Ctrl-Space",run:Tt},{mac:"Alt-`",run:Tt},{key:"Escape",run:Ms},{key:"ArrowDown",run:Ce(!0)},{key:"ArrowUp",run:Ce(!1)},{key:"PageDown",run:Ce(!0,"page")},{key:"PageUp",run:Ce(!1,"page")},{key:"Enter",run:vs}],js=it.highest(zt.computeN([S],t=>t.facet(S).defaultKeymap?[Vn]:[]));class Ks{constructor(e,n,i){this.from=e,this.to=n,this.diagnostic=i}}class z{constructor(e,n,i){this.diagnostics=e,this.panel=n,this.selected=i}static init(e,n,i){let o=e,s=i.facet(ue).markerFilter;s&&(o=s(o,i));let r=b.set(o.map(l=>l.from==l.to||l.from==l.to-1&&i.doc.lineAt(l.from).to==l.from?b.widget({widget:new tr(l),diagnostic:l}).range(l.from):b.mark({attributes:{class:"cm-lintRange cm-lintRange-"+l.severity+(l.markClass?" "+l.markClass:"")},diagnostic:l}).range(l.from,l.to)),!0);return new z(r,n,ee(r))}}function ee(t,e=null,n=0){let i=null;return t.between(n,1e9,(o,s,{spec:r})=>{if(!(e&&r.diagnostic!=e))return i=new Ks(o,s,r.diagnostic),!1}),i}function Gs(t,e){let n=e.pos,i=e.end||n,o=t.state.facet(ue).hideOn(t,n,i);if(o!=null)return o;let s=t.startState.doc.lineAt(e.pos);return!!(t.effects.some(r=>r.is(zn))||t.changes.touchesRange(s.from,Math.max(s.to,i)))}function Js(t,e){return t.field(I,!1)?e:e.concat(k.appendConfig.of(or))}const zn=k.define(),pt=k.define(),Hn=k.define(),I=ne.define({create(){return new z(b.none,null,null)},update(t,e){if(e.docChanged&&t.diagnostics.size){let n=t.diagnostics.map(e.changes),i=null,o=t.panel;if(t.selected){let s=e.changes.mapPos(t.selected.from,1);i=ee(n,t.selected.diagnostic,s)||ee(n,null,s)}!n.size&&o&&e.state.facet(ue).autoPanel&&(o=null),t=new z(n,o,i)}for(let n of e.effects)if(n.is(zn)){let i=e.state.facet(ue).autoPanel?n.value.length?de.open:null:t.panel;t=z.init(n.value,i,e.state)}else n.is(pt)?t=new z(t.diagnostics,n.value?de.open:null,t.selected):n.is(Hn)&&(t=new z(t.diagnostics,t.panel,n.value));return t},provide:t=>[st.from(t,e=>e.panel),y.decorations.from(t,e=>e.diagnostics)]}),Qs=b.mark({class:"cm-lintRange cm-lintRange-active"});function _s(t,e,n){let{diagnostics:i}=t.state.field(I),o=[],s=2e8,r=0;i.between(e-(n<0?1:0),e+(n>0?1:0),(c,a,{spec:f})=>{e>=c&&e<=a&&(c==a||(e>c||n>0)&&(e<a||n<0))&&(o.push(f.diagnostic),s=Math.min(c,s),r=Math.max(a,r))});let l=t.state.facet(ue).tooltipFilter;return l&&(o=l(o,t.state)),o.length?{pos:s,end:r,above:t.state.doc.lineAt(s).to<r,create(){return{dom:Ys(t,o)}}}:null}function Ys(t,e){return g("ul",{class:"cm-tooltip-lint"},e.map(n=>Kn(t,n,!1)))}const Xs=t=>{let e=t.state.field(I,!1);(!e||!e.panel)&&t.dispatch({effects:Js(t.state,[pt.of(!0)])});let n=ce(t,de.open);return n&&n.dom.querySelector(".cm-panel-lint ul").focus(),!0},Ft=t=>{let e=t.state.field(I,!1);return!e||!e.panel?!1:(t.dispatch({effects:pt.of(!1)}),!0)},Zs=t=>{let e=t.state.field(I,!1);if(!e)return!1;let n=t.state.selection.main,i=e.diagnostics.iter(n.to+1);return!i.value&&(i=e.diagnostics.iter(0),!i.value||i.from==n.from&&i.to==n.to)?!1:(t.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0}),!0)},er=[{key:"Mod-Shift-m",run:Xs,preventDefault:!0},{key:"F8",run:Zs}],ue=te.define({combine(t){return Object.assign({sources:t.map(e=>e.source).filter(e=>e!=null)},me(t.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{needsRefresh:(e,n)=>e?n?i=>e(i)||n(i):e:n}))}});function jn(t){let e=[];if(t)e:for(let{name:n}of t){for(let i=0;i<n.length;i++){let o=n[i];if(/[a-zA-Z]/.test(o)&&!e.some(s=>s.toLowerCase()==o.toLowerCase())){e.push(o);continue e}}e.push("")}return e}function Kn(t,e,n){var i;let o=n?jn(e.actions):[];return g("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},g("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage(t):e.message),(i=e.actions)===null||i===void 0?void 0:i.map((s,r)=>{let l=!1,c=u=>{if(u.preventDefault(),l)return;l=!0;let m=ee(t.state.field(I).diagnostics,e);m&&s.apply(t,m.from,m.to)},{name:a}=s,f=o[r]?a.indexOf(o[r]):-1,h=f<0?a:[a.slice(0,f),g("u",a.slice(f,f+1)),a.slice(f+1)];return g("button",{type:"button",class:"cm-diagnosticAction",onclick:c,onmousedown:c,"aria-label":` Action: ${a}${f<0?"":` (access key "${o[r]})"`}.`},h)}),e.source&&g("div",{class:"cm-diagnosticSource"},e.source))}class tr extends ii{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return g("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class Wt{constructor(e,n){this.diagnostic=n,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=Kn(e,n,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class de{constructor(e){this.view=e,this.items=[];let n=o=>{if(o.keyCode==27)Ft(this.view),this.view.focus();else if(o.keyCode==38||o.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(o.keyCode==40||o.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(o.keyCode==36)this.moveSelection(0);else if(o.keyCode==35)this.moveSelection(this.items.length-1);else if(o.keyCode==13)this.view.focus();else if(o.keyCode>=65&&o.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:s}=this.items[this.selectedIndex],r=jn(s.actions);for(let l=0;l<r.length;l++)if(r[l].toUpperCase().charCodeAt(0)==o.keyCode){let c=ee(this.view.state.field(I).diagnostics,s);c&&s.actions[l].apply(e,c.from,c.to)}}else return;o.preventDefault()},i=o=>{for(let s=0;s<this.items.length;s++)this.items[s].dom.contains(o.target)&&this.moveSelection(s)};this.list=g("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:n,onclick:i}),this.dom=g("div",{class:"cm-panel-lint"},this.list,g("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>Ft(this.view)},"Ã—")),this.update()}get selectedIndex(){let e=this.view.state.field(I).selected;if(!e)return-1;for(let n=0;n<this.items.length;n++)if(this.items[n].diagnostic==e.diagnostic)return n;return-1}update(){let{diagnostics:e,selected:n}=this.view.state.field(I),i=0,o=!1,s=null;for(e.between(0,this.view.state.doc.length,(r,l,{spec:c})=>{let a=-1,f;for(let h=i;h<this.items.length;h++)if(this.items[h].diagnostic==c.diagnostic){a=h;break}a<0?(f=new Wt(this.view,c.diagnostic),this.items.splice(i,0,f),o=!0):(f=this.items[a],a>i&&(this.items.splice(i,a-i),o=!0)),n&&f.diagnostic==n.diagnostic?f.dom.hasAttribute("aria-selected")||(f.dom.setAttribute("aria-selected","true"),s=f):f.dom.hasAttribute("aria-selected")&&f.dom.removeAttribute("aria-selected"),i++});i<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)o=!0,this.items.pop();this.items.length==0&&(this.items.push(new Wt(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),o=!0),s?(this.list.setAttribute("aria-activedescendant",s.id),this.view.requestMeasure({key:this,read:()=>({sel:s.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:r,panel:l})=>{let c=l.height/this.list.offsetHeight;r.top<l.top?this.list.scrollTop-=(l.top-r.top)/c:r.bottom>l.bottom&&(this.list.scrollTop+=(r.bottom-l.bottom)/c)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),o&&this.sync()}sync(){let e=this.list.firstChild;function n(){let i=e;e=i.nextSibling,i.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;e!=i.dom;)n();e=i.dom.nextSibling}else this.list.insertBefore(i.dom,e);for(;e;)n()}moveSelection(e){if(this.selectedIndex<0)return;let n=this.view.state.field(I),i=ee(n.diagnostics,this.items[e].diagnostic);i&&this.view.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0,effects:Hn.of(i)})}static open(e){return new de(e)}}function nr(t,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(t)}</svg>')`}function ke(t){return nr(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${t}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const ir=y.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:ke("#d11")},".cm-lintRange-warning":{backgroundImage:ke("orange")},".cm-lintRange-info":{backgroundImage:ke("#999")},".cm-lintRange-hint":{backgroundImage:ke("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}}),or=[I,y.decorations.compute([I],t=>{let{selected:e,panel:n}=t.field(I);return!e||!n||e.from==e.to?b.none:b.set([Qs.range(e.from,e.to)])}),ni(_s,{hideOn:Gs}),ir],rr=[oi(),si(),ri(),wi(),li(),ci(),ai(),Vt.allowMultipleSelections.of(!0),fi(),hi(yi,{fallback:!0}),ui(),Ts(),Hs(),di(),mi(),pi(),Wo(),zt.of([...Ws,...Ro,...ns,...Fi,...gi,...Vn,...er])];export{rr as b};
