import{w as te,r as V,c as B,i as _e,p as Pe,d as j,o as je,a as Ke,n as q,u as He,b as L,e as z,f as le,g as $,h as C,j as D,k as H,t as Y,F as ee,l as ue,v as ie,m as A,q as Ye,s as We,x as Qe,_ as Xe,y as Ze,S as Je}from"./index-3H7NfZbl.js";import{c as ke,o as F,w as De,h as Fe,i as et,u as tt,A as ne,a as de,s as nt,N as pe,b as R,v as at,d as ve,_ as $e,O as rt,e as ot,f as st,g as lt,r as T,m as ut,j as ge,k as G,l as it,n as ct,p as dt,x as we,I as ft,y as be,q as mt,t as pt,z as se,B as vt,P as gt,C as wt,D as bt,E as xt,F as ht,G as xe}from"./meshes-DnxT3L2C.js";function It(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function yt(){return/Android/gi.test(window.navigator.userAgent)}function St(){return It()||yt()}function J(e,u,s){ke.isServer||te(i=>{document.addEventListener(e,u,s),i(()=>document.removeEventListener(e,u,s))})}function Mt(e,u,s){ke.isServer||te(i=>{window.addEventListener(e,u,s),i(()=>window.removeEventListener(e,u,s))})}function _t(e,u,s=B(()=>!0)){function i(a,t){if(!s.value||a.defaultPrevented)return;let d=t(a);if(d===null||!d.getRootNode().contains(d))return;let f=function y(v){return typeof v=="function"?y(v()):Array.isArray(v)||v instanceof Set?v:[v]}(e);for(let y of f){if(y===null)continue;let v=y instanceof HTMLElement?y:F(y);if(v!=null&&v.contains(d)||a.composed&&a.composedPath().includes(v))return}return!De(d,Fe.Loose)&&d.tabIndex!==-1&&a.preventDefault(),u(a,d)}let c=V(null);J("pointerdown",a=>{var t,d;s.value&&(c.value=((d=(t=a.composedPath)==null?void 0:t.call(a))==null?void 0:d[0])||a.target)},!0),J("mousedown",a=>{var t,d;s.value&&(c.value=((d=(t=a.composedPath)==null?void 0:t.call(a))==null?void 0:d[0])||a.target)},!0),J("click",a=>{St()||c.value&&(i(a,()=>c.value),c.value=null)},!0),J("touchend",a=>i(a,()=>a.target instanceof HTMLElement?a.target:null),!0),Mt("blur",a=>i(a,()=>window.document.activeElement instanceof HTMLIFrameElement?window.document.activeElement:null),!0)}function he(e){return[e.screenX,e.screenY]}function Pt(){let e=V([-1,-1]);return{wasMoved(u){let s=he(u);return e.value[0]===s[0]&&e.value[1]===s[1]?!1:(e.value=s,!0)},update(u){e.value=he(u)}}}function kt({container:e,accept:u,walk:s,enabled:i}){te(()=>{let c=e.value;if(!c||i!==void 0&&!i.value)return;let a=et(e);if(!a)return;let t=Object.assign(f=>u(f),{acceptNode:u}),d=a.createTreeWalker(c,NodeFilter.SHOW_ELEMENT,t,!1);for(;d.nextNode();)s(d.currentNode)})}let Re=Symbol("Context");var W=(e=>(e[e.Open=1]="Open",e[e.Closed=2]="Closed",e[e.Closing=4]="Closing",e[e.Opening=8]="Opening",e))(W||{});function Dt(){return _e(Re,null)}function Ft(e){Pe(Re,e)}function $t(e){throw new Error("Unexpected object: "+e)}var U=(e=>(e[e.First=0]="First",e[e.Previous=1]="Previous",e[e.Next=2]="Next",e[e.Last=3]="Last",e[e.Specific=4]="Specific",e[e.Nothing=5]="Nothing",e))(U||{});function Rt(e,u){let s=u.resolveItems();if(s.length<=0)return null;let i=u.resolveActiveIndex(),c=i??-1;switch(e.focus){case 0:{for(let a=0;a<s.length;++a)if(!u.resolveDisabled(s[a],a,s))return a;return i}case 1:{c===-1&&(c=s.length);for(let a=c-1;a>=0;--a)if(!u.resolveDisabled(s[a],a,s))return a;return i}case 2:{for(let a=c+1;a<s.length;++a)if(!u.resolveDisabled(s[a],a,s))return a;return i}case 3:{for(let a=s.length-1;a>=0;--a)if(!u.resolveDisabled(s[a],a,s))return a;return i}case 4:{for(let a=0;a<s.length;++a)if(u.resolveId(s[a],a,s)===e.id)return a;return i}case 5:return null;default:$t(e)}}let Ie=/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g;function ye(e){var u,s;let i=(u=e.innerText)!=null?u:"",c=e.cloneNode(!0);if(!(c instanceof HTMLElement))return i;let a=!1;for(let d of c.querySelectorAll('[hidden],[aria-hidden],[role="img"]'))d.remove(),a=!0;let t=a?(s=c.innerText)!=null?s:"":i;return Ie.test(t)&&(t=t.replace(Ie,"")),t}function Et(e){let u=e.getAttribute("aria-label");if(typeof u=="string")return u.trim();let s=e.getAttribute("aria-labelledby");if(s){let i=s.split(" ").map(c=>{let a=document.getElementById(c);if(a){let t=a.getAttribute("aria-label");return typeof t=="string"?t.trim():ye(a).trim()}return null}).filter(Boolean);if(i.length>0)return i.join(", ")}return ye(e).trim()}function Tt(e){let u=V(""),s=V("");return()=>{let i=F(e);if(!i)return"";let c=i.innerText;if(u.value===c)return s.value;let a=Et(i).trim().toLowerCase();return u.value=c,s.value=a,a}}var Vt=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Vt||{}),Ut=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(Ut||{});function Ct(e){requestAnimationFrame(()=>requestAnimationFrame(e))}let Ee=Symbol("MenuContext");function ae(e){let u=_e(Ee,null);if(u===null){let s=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(s,ae),s}return u}let At=j({name:"Menu",props:{as:{type:[Object,String],default:"template"}},setup(e,{slots:u,attrs:s}){let i=V(1),c=V(null),a=V(null),t=V([]),d=V(""),f=V(null),y=V(1);function v(l=b=>b){let b=f.value!==null?t.value[f.value]:null,w=rt(l(t.value.slice()),h=>F(h.dataRef.domRef)),S=b?w.indexOf(b):null;return S===-1&&(S=null),{items:w,activeItemIndex:S}}let p={menuState:i,buttonRef:c,itemsRef:a,items:t,searchQuery:d,activeItemIndex:f,activationTrigger:y,closeMenu:()=>{i.value=1,f.value=null},openMenu:()=>i.value=0,goToItem(l,b,w){let S=v(),h=Rt(l===U.Specific?{focus:U.Specific,id:b}:{focus:l},{resolveItems:()=>S.items,resolveActiveIndex:()=>S.activeItemIndex,resolveId:_=>_.id,resolveDisabled:_=>_.dataRef.disabled});d.value="",f.value=h,y.value=w??1,t.value=S.items},search(l){let b=d.value!==""?0:1;d.value+=l.toLowerCase();let w=(f.value!==null?t.value.slice(f.value+b).concat(t.value.slice(0,f.value+b)):t.value).find(h=>h.dataRef.textValue.startsWith(d.value)&&!h.dataRef.disabled),S=w?t.value.indexOf(w):-1;S===-1||S===f.value||(f.value=S,y.value=1)},clearSearch(){d.value=""},registerItem(l,b){let w=v(S=>[...S,{id:l,dataRef:b}]);t.value=w.items,f.value=w.activeItemIndex,y.value=1},unregisterItem(l){let b=v(w=>{let S=w.findIndex(h=>h.id===l);return S!==-1&&w.splice(S,1),w});t.value=b.items,f.value=b.activeItemIndex,y.value=1}};return _t([c,a],(l,b)=>{var w;p.closeMenu(),De(b,Fe.Loose)||(l.preventDefault(),(w=F(c))==null||w.focus())},B(()=>i.value===0)),Pe(Ee,p),Ft(B(()=>tt(i.value,{0:W.Open,1:W.Closed}))),()=>{let l={open:i.value===0,close:p.closeMenu};return ne({ourProps:{},theirProps:e,slot:l,slots:u,attrs:s,name:"Menu"})}}}),Bt=j({name:"MenuButton",props:{disabled:{type:Boolean,default:!1},as:{type:[Object,String],default:"button"},id:{type:String,default:null}},setup(e,{attrs:u,slots:s,expose:i}){var c;let a=(c=e.id)!=null?c:`headlessui-menu-button-${de()}`,t=ae("MenuButton");i({el:t.buttonRef,$el:t.buttonRef});function d(p){switch(p.key){case R.Space:case R.Enter:case R.ArrowDown:p.preventDefault(),p.stopPropagation(),t.openMenu(),q(()=>{var l;(l=F(t.itemsRef))==null||l.focus({preventScroll:!0}),t.goToItem(U.First)});break;case R.ArrowUp:p.preventDefault(),p.stopPropagation(),t.openMenu(),q(()=>{var l;(l=F(t.itemsRef))==null||l.focus({preventScroll:!0}),t.goToItem(U.Last)});break}}function f(p){switch(p.key){case R.Space:p.preventDefault();break}}function y(p){e.disabled||(t.menuState.value===0?(t.closeMenu(),q(()=>{var l;return(l=F(t.buttonRef))==null?void 0:l.focus({preventScroll:!0})})):(p.preventDefault(),t.openMenu(),Ct(()=>{var l;return(l=F(t.itemsRef))==null?void 0:l.focus({preventScroll:!0})})))}let v=nt(B(()=>({as:e.as,type:u.type})),t.buttonRef);return()=>{var p;let l={open:t.menuState.value===0},{...b}=e,w={ref:t.buttonRef,id:a,type:v.value,"aria-haspopup":"menu","aria-controls":(p=F(t.itemsRef))==null?void 0:p.id,"aria-expanded":t.menuState.value===0,onKeydown:d,onKeyup:f,onClick:y};return ne({ourProps:w,theirProps:b,slot:l,attrs:u,slots:s,name:"MenuButton"})}}}),Ot=j({name:"MenuItems",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null}},setup(e,{attrs:u,slots:s,expose:i}){var c;let a=(c=e.id)!=null?c:`headlessui-menu-items-${de()}`,t=ae("MenuItems"),d=V(null);i({el:t.itemsRef,$el:t.itemsRef}),kt({container:B(()=>F(t.itemsRef)),enabled:B(()=>t.menuState.value===0),accept(l){return l.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:l.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(l){l.setAttribute("role","none")}});function f(l){var b;switch(d.value&&clearTimeout(d.value),l.key){case R.Space:if(t.searchQuery.value!=="")return l.preventDefault(),l.stopPropagation(),t.search(l.key);case R.Enter:if(l.preventDefault(),l.stopPropagation(),t.activeItemIndex.value!==null){let w=t.items.value[t.activeItemIndex.value];(b=F(w.dataRef.domRef))==null||b.click()}t.closeMenu(),$e(F(t.buttonRef));break;case R.ArrowDown:return l.preventDefault(),l.stopPropagation(),t.goToItem(U.Next);case R.ArrowUp:return l.preventDefault(),l.stopPropagation(),t.goToItem(U.Previous);case R.Home:case R.PageUp:return l.preventDefault(),l.stopPropagation(),t.goToItem(U.First);case R.End:case R.PageDown:return l.preventDefault(),l.stopPropagation(),t.goToItem(U.Last);case R.Escape:l.preventDefault(),l.stopPropagation(),t.closeMenu(),q(()=>{var w;return(w=F(t.buttonRef))==null?void 0:w.focus({preventScroll:!0})});break;case R.Tab:l.preventDefault(),l.stopPropagation(),t.closeMenu(),q(()=>at(F(t.buttonRef),l.shiftKey?ve.Previous:ve.Next));break;default:l.key.length===1&&(t.search(l.key),d.value=setTimeout(()=>t.clearSearch(),350));break}}function y(l){switch(l.key){case R.Space:l.preventDefault();break}}let v=Dt(),p=B(()=>v!==null?(v.value&W.Open)===W.Open:t.menuState.value===0);return()=>{var l,b;let w={open:t.menuState.value===0},{...S}=e,h={"aria-activedescendant":t.activeItemIndex.value===null||(l=t.items.value[t.activeItemIndex.value])==null?void 0:l.id,"aria-labelledby":(b=F(t.buttonRef))==null?void 0:b.id,id:a,onKeydown:f,onKeyup:y,role:"menu",tabIndex:0,ref:t.itemsRef};return ne({ourProps:h,theirProps:S,slot:w,attrs:u,slots:s,features:pe.RenderStrategy|pe.Static,visible:p.value,name:"MenuItems"})}}}),Lt=j({name:"MenuItem",inheritAttrs:!1,props:{as:{type:[Object,String],default:"template"},disabled:{type:Boolean,default:!1},id:{type:String,default:null}},setup(e,{slots:u,attrs:s,expose:i}){var c;let a=(c=e.id)!=null?c:`headlessui-menu-item-${de()}`,t=ae("MenuItem"),d=V(null);i({el:d,$el:d});let f=B(()=>t.activeItemIndex.value!==null?t.items.value[t.activeItemIndex.value].id===a:!1),y=Tt(d),v=B(()=>({disabled:e.disabled,get textValue(){return y()},domRef:d}));je(()=>t.registerItem(a,v)),Ke(()=>t.unregisterItem(a)),te(()=>{t.menuState.value===0&&f.value&&t.activationTrigger.value!==0&&q(()=>{var _,k;return(k=(_=F(d))==null?void 0:_.scrollIntoView)==null?void 0:k.call(_,{block:"nearest"})})});function p(_){if(e.disabled)return _.preventDefault();t.closeMenu(),$e(F(t.buttonRef))}function l(){if(e.disabled)return t.goToItem(U.Nothing);t.goToItem(U.Specific,a)}let b=Pt();function w(_){b.update(_)}function S(_){b.wasMoved(_)&&(e.disabled||f.value||t.goToItem(U.Specific,a,0))}function h(_){b.wasMoved(_)&&(e.disabled||f.value&&t.goToItem(U.Nothing))}return()=>{let{disabled:_,...k}=e,E={active:f.value,disabled:_,close:t.closeMenu};return ne({ourProps:{id:a,ref:d,role:"menuitem",tabIndex:_===!0?void 0:-1,"aria-disabled":_===!0?!0:void 0,onClick:p,onFocus:l,onPointerenter:w,onMouseenter:w,onPointermove:S,onMousemove:S,onPointerleave:h,onMouseleave:h},theirProps:{...s,...k},slot:E,attrs:s,slots:u,name:"MenuItem"})}}});const Nt=e=>u=>u.map(e),Gt=e=>e.length,qt=e=>Math.min(...e),zt=e=>qt(e.map(Gt)),jt=e=>(...u)=>Array.from({length:zt(u)},(s,i)=>e(...u.map(c=>c[i]))),Kt=jt,Te=Kt,Ht=Te(st),Yt=Te(lt),Wt=e=>(u,s)=>Nt(i=>e(i,s))(u),Se=Wt(ot),Qt=["onUpdate:modelValue"],Xt=["onUpdate:modelValue"],Zt=j({__name:"ExtentInput",props:{modelValue:{}},emits:["update:modelValue"],setup(e,{emit:u}){const c=He(e,"modelValue",u),a=(f,y)=>{c.value=[c.value[0].map((v,p)=>y==p?f[0]:v),c.value[1].map((v,p)=>y==p?f[1]:v)]},t=B(()=>T(0,c.value[0].length)),d=[{name:"-1, +1",value:[-1,1]},{name:"-π, +π",value:[-Math.PI,+Math.PI]},{name:"-π/2, +π/2",value:[-Math.PI/2,+Math.PI/2]}];return(f,y)=>(L(!0),z(ee,null,le(t.value,v=>(L(),z("div",{class:"flex flex-row items-center gap-2",key:v},[$(D(At),{as:"div",class:"relative inline-block text-left"},{default:C(()=>[$(D(Bt),{class:"w-8 text-xs text-right font-mono"},{default:C(()=>[H("x["+Y(v)+"]:",1)]),_:2},1024),$(D(Ot),{class:"absolute left-0 mt-2 w-32 origin-top-left divide-y divide-border bg-background-mute shadow-lg ring-1 ring-border-hover focus:outline-none z-50"},{default:C(()=>[(L(),z(ee,null,le(d,p=>$(D(Lt),{as:"div",class:"menu-item text-center",onClick:l=>a(p.value,v)},{default:C(()=>[H(Y(p.name),1)]),_:2},1032,["onClick"])),64))]),_:2},1024)]),_:2},1024),ue(A("input",{class:"w-16",type:"number",step:"0.1","onUpdate:modelValue":p=>D(c)[0][v]=p},null,8,Qt),[[ie,D(c)[0][v]]]),ue(A("input",{class:"w-16",type:"number",step:"0.1","onUpdate:modelValue":p=>D(c)[1][v]=p},null,8,Xt),[[ie,D(c)[1][v]]])]))),128))}}),Jt=(e,u)=>{const s=e.__vccOpts||e;for(const[i,c]of u)s[i]=c;return s},en=Jt(Zt,[["__scopeId","data-v-88993ee7"]]),tn=()=>`
const PI = radians(180.0);
const TAU = radians(360.0);

fn cosk(k: f32, x: f32) -> f32 {
  if (k > 0.0) {
    let rk = sqrt(k);
    return cos(rk*x);
  }
  if (k < 0.0) {
    let rk = sqrt(-k);
    return cosh(rk*x);
  }
  return 1.0;
}

fn sink(k: f32, x: f32) -> f32 {
  if (k > 0.0) {
    let rk = sqrt(k);
    return sin(rk*x)/rk;
  }
  if (k < 0.0) {
    let rk = sqrt(-k);
    return sinh(rk*x)/rk;
  }
  return x;
}

alias vec1f = array<f32, 1>;
`,nn=e=>{const u=/@plot\s+fn\s+(?<name>\w+)\s*\(\w+:\s*(?<domain>\w+)\)\s*->\s*(?<codomain>\w+)/g,s=[];let i;do i=u.exec(e),i&&i.groups&&s.push({name:i.groups.name,domain:{name:i.groups.domain},codomain:{name:i.groups.codomain}});while(i);return{functions:s}},ce=e=>{switch(e.name){case"vec1f":return 1;case"vec2f":return 2;case"vec3f":return 3;case"vec4f":return 4}return 0},Me=e=>[ce(e.domain),ce(e.codomain)],an={class:"flex flex-row items-center h-12 p-1 border-b-2 border-border"},rn=A("h1",{class:"px-2"},"Parametric Surface",-1),on=A("span",{class:"flex-grow"},null,-1),sn={class:"flex flex-row items-center justify-center overflow-hidden"},ln={class:"flex flex-col p-2"},un={class:"flex flex-row items-center text-heading text-lg gap-2 my-2"},cn=["onUpdate:modelValue"],dn={class:"text-text text-base"},fn=`@plot
fn f(x: vec2f) -> vec3f {
  return vec3f(x, sin(x[0])*cos(x[1]));
}`,mn=`
struct GlobalData {
  projection: mat4x4f,
  view: mat4x4f,
  time: f32,
}
`,pn=`
struct SurfaceData {
  model: mat4x4f,
  color: vec4f,
}
`,bn=j({__name:"ParametricSurfaceView",setup(e){const u=V({source:fn,options:{functions:[]}}),s=Ye(u),i=`
${mn}
${pn}

@group(0) @binding(0) var<uniform> uGlobal: GlobalData;
@group(0) @binding(1) var<uniform> uSurface: SurfaceData;
`,c=(n,[o,r])=>{const g=I=>{switch(I){case 1:return"vec1f(position.y)";case 2:return"position.yz";case 3:return"position.yzw";default:return"0.0"}};return`fn surface(position: vec4f) -> vec4f {
  return ${(I=>x=>{switch(I){case 1:return`vec4(1.0, ${x}[0], 0.0, 0.0)`;case 2:return`vec4(1.0, ${x}, 0.0)`;case 3:return`vec4(1.0, ${x})`;default:return"vec4(1.0, 0.0, 0.0, 0.0)"}})(r)(`${n}(${g(o)})`)};
}`},a=(n,o)=>`
${tn()}

struct VertexIn {
  @location(0) position: vec4f,
  @location(1) color: vec4f,
}

struct FragmentIn {
  @builtin(position) position: vec4f,
  @location(0) color: vec4f,
}

struct VaryingData {
  position: vec4f,
  color: vec4f,
}

${i}

${n}

${o}

fn fromVertexIn(in: VertexIn) -> VaryingData {
  return VaryingData(
    uGlobal.view * surface(uSurface.model * in.position),
    uSurface.color * in.color,
  );
}

fn toFragmentIn(in: VaryingData) -> FragmentIn {
  return FragmentIn(
    uGlobal.projection * in.position.yzwx,
    in.color,
  );
}

@vertex
fn vertexMain(in: VertexIn) -> FragmentIn {
  return toFragmentIn(fromVertexIn(in));
}

@fragment
fn fragmentMain(in: FragmentIn) -> @location(0) vec4f {
  return in.color;
}
`,t=V(null),d=ut(i),f=ge(d.uniforms.uGlobal);f.set({projection:G.perspective(Math.PI/4,1920/1080,.1,1e3),view:G.translation([0,0,-3])});const y={},v={alphaMode:"premultiplied",size:[1920,1080],autoResize:!1},p=n=>{const o={state:null,valid:!1,onCreate(r){console.log("Resource::onCreate"),!o.state&&(o.state=n.create(r))},onUpdate(r){var g,m;o.valid||((g=o.onDelete)==null||g.call(o,r),(m=o.onCreate)==null||m.call(o,r),o.valid=!0)},onDelete(r){console.log("Resource::onDelete"),o.state&&(n.delete(r,o.state),o.state=null)}};return o},l=n=>bt(n.map(o=>xt(-1,1,o))),b=n=>{const o=n.length,r=ht(n);switch(o){case 1:return T(0,n[0]-1).map(m=>[(m+0)*r[0],(m+1)*r[0]]);case 2:{const g=T(0,n[0]).flatMap(I=>T(0,n[1]-1).map(x=>[I*r[0]+(x+0)*r[1],I*r[0]+(x+1)*r[1]])),m=T(0,n[1]).flatMap(I=>T(0,n[0]-1).map(x=>[(x+0)*r[0]+I*r[1],(x+1)*r[0]+I*r[1]]));return xe(g,m)}case 3:{const g=T(0,n[0]).flatMap(x=>T(0,n[1]).flatMap(P=>T(0,n[2]-1).map(M=>[x*r[0]+P*r[1]+(M+0)*r[2],x*r[0]+P*r[1]+(M+1)*r[2]]))),m=T(0,n[0]).flatMap(x=>T(0,n[2]).flatMap(P=>T(0,n[1]-1).map(M=>[x*r[0]+(M+0)*r[1]+P*r[2],x*r[0]+(M+1)*r[1]+P*r[2]]))),I=T(0,n[1]).flatMap(x=>T(0,n[2]).flatMap(P=>T(0,n[0]-1).map(M=>[(M+0)*r[0]+x*r[1]+P*r[2],(M+1)*r[0]+x*r[1]+P*r[2]])));return xe(g,m,I)}}return[]},w=n=>{const o=l(n).map(m=>[1,m[0]??0,m[1]??0,m[2]??0]),r=se([1,1,1,1],o.length),g=b(n);return{position:{data:o.flat(1),type:Float32Array,numComponents:4},color:{data:r.flat(1),type:Float32Array,numComponents:4},indices:{data:g.flat(1),type:Uint32Array}}},S=n=>[[],[Math.pow(n,3*2)],[Math.pow(n,3),Math.pow(n,3)],[Math.pow(n,2),Math.pow(n,2),Math.pow(n,2)]],h=p({create({device:n}){return S(3).map(w).map(r=>({vertices:vt(n,r,{shaderLocation:0,stepMode:"vertex",interleave:!0}),topology:1}))},delete({device:n},o){}}),_=n=>{const o=Se(Ht(n[0],n[1]),2),r=Se(Yt(n[0],n[1]),2);return G.st(r,o)},k=p({create({device:n,format:o}){return{uniforms:n.createBuffer({size:f.arrayBuffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})}},delete({device:n},o){}}),E=p({create({device:n,format:o}){if(!k.state||!h.state||!t.value)return null;const{source:r,info:g}=t.value;return g.functions.map((m,I)=>{const[x,P]=Me(m),M=n.createShaderModule({code:a(r,c(m.name,[x,P]))}),{uniforms:O}=k.state,{vertices:Q}=h.state[x],K=n.createRenderPipeline({layout:"auto",vertex:{module:M,entryPoint:"vertexMain",buffers:Q.bufferLayouts},fragment:{module:M,entryPoint:"fragmentMain",targets:[{format:o}]},primitive:{topology:gt[1]}});y[I]=ge(d.uniforms.uSurface);const X=n.createBuffer({size:y[I].arrayBuffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),N=n.createBindGroup({layout:K.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:O}},{binding:1,resource:{buffer:X}}]});return{pipeline:K,bindGroup:N,uniforms:X}})},delete({device:n},o){}}),Ve={onCreate(n){var o,r,g;console.log("ParametricSurfaceView::onCreate"),(o=k.onUpdate)==null||o.call(k,n),k.state&&((r=h.onUpdate)==null||r.call(h,n),h.state&&((g=E.onUpdate)==null||g.call(E,n),E.state))},onRender(n){var O,Q,K;const{device:o,context:r,timestamp:g}=n;if((O=k.onUpdate)==null||O.call(k,n),!k.state||((Q=h.onUpdate)==null||Q.call(h,n),!h.state)||((K=E.onUpdate)==null||K.call(E,n),!E.state))return;const m=o.createCommandEncoder(),I=m.beginRenderPass({colorAttachments:[{clearValue:Float32Array.of(0,0,0,0),loadOp:"clear",storeOp:"store",view:r.getCurrentTexture().createView()}]});if(!t.value)return null;const{info:x}=t.value,{uniforms:P}=k.state;f.set({time:g/1e3}),o.queue.writeBuffer(P,0,f.arrayBuffer),x.functions.forEach((X,N)=>{const[Ne,vn]=Me(X),me=s.options.functions[N],{vertices:Z}=h.state[Ne],{pipeline:Ge,bindGroup:qe,uniforms:ze}=E.state[N];y[N].set({model:_(me.extent),color:wt(me.color).gl()}),o.queue.writeBuffer(ze,0,y[N].arrayBuffer),I.setPipeline(Ge),I.setBindGroup(0,qe),I.setVertexBuffer(0,Z.buffers[0]),I.setIndexBuffer(Z.indexBuffer,Z.indexFormat),I.drawIndexed(Z.numElements)}),I.end();const M=m.finish();o.queue.submit([M])},onDelete(n){var o,r,g;console.log("ParametricSurfaceView::Delete"),(o=E.onDelete)==null||o.call(E,n),(r=h.onDelete)==null||r.call(h,n),(g=k.onDelete)==null||g.call(k,n)}},re={down:!1},Ue={pointerdown:n=>{re.down=!0,n.target.setPointerCapture(n.pointerId)},pointermove:n=>{if(!re.down)return;const o=n.target,r=[o.width,o.height],g=Math.min(...r),m=[+n.movementX*4/g,+n.movementY*4/g,0];G.rotateZ(f.views.view,m[0],f.views.view),G.rotateY(f.views.view,m[1],f.views.view)},pointerup:n=>{re.down=!1},wheel:n=>{const o=n.deltaY/100;G.translate(f.views.view,[0,0,o],f.views.view)}},Ce=n=>({source:n.replaceAll("@plot","/*@plot*/"),info:nn(n)}),Ae=n=>{const o=ce(n.domain);return[se(-1,o),se(1,o)]},Be=({info:n})=>({functions:n.functions.map(o=>({name:o.name,color:"#ffffff",extent:Ae(o)}))}),Oe=(n,o)=>({functions:n.functions.map((r,g)=>{const m=o.functions[g];return{color:(m==null?void 0:m.color)??r.color,extent:[r.extent[0].map((I,x)=>{var P,M;return((M=(P=m==null?void 0:m.extent)==null?void 0:P[0])==null?void 0:M[x])??I}),r.extent[1].map((I,x)=>{var P,M;return((M=(P=m==null?void 0:m.extent)==null?void 0:P[1])==null?void 0:M[x])??I})]}})}),fe=n=>{const o=Ce(n.source);t.value=o,n.options=Oe(Be(o),n.options),E.valid=!1},Le=n=>{switch(n.key){case"Enter":return n.shiftKey;case"s":case"S":return n.ctrlKey||n.metaKey;default:return!1}};We(document,"keydown",n=>{Le(n)&&(n.stopPropagation(),n.preventDefault(),fe(s))}),Qe(u,fe,{immediate:!0});const oe=n=>{var o,r,g;return(g=(r=(o=t.value)==null?void 0:o.info)==null?void 0:r.functions)==null?void 0:g[n]};return(n,o)=>(L(),z(ee,null,[A("header",an,[rn,on,$(it,{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=r=>u.value=r)},null,8,["modelValue"]),$(ct)]),$(D(pt),{as:"main",class:"flex-grow flex flex-col overflow-hidden","default-index":2},{default:C(()=>[$(D(dt),{class:"flex flex-row md:hidden"},{default:C(()=>[$(D(we),{class:"tab"},{default:C(()=>[H("Input")]),_:1}),$(D(we),{class:"tab"},{default:C(()=>[H("Output")]),_:1})]),_:1}),$(D(ft),{class:"h-full md:grid md:grid-cols-2 border-y-2 border-border"},{default:C(()=>[$(D(be),{class:"h-full ui-not-selected:hidden md:ui-not-selected:grid grid grid-rows-1 overflow-hidden",static:!0},{default:C(()=>[$(Xe,{modelValue:D(s).source,"onUpdate:modelValue":o[1]||(o[1]=r=>D(s).source=r)},null,8,["modelValue"])]),_:1}),$(D(be),{class:"h-full ui-not-selected:hidden md:ui-not-selected:grid grid grid-rows-2 overflow-hidden",static:!0},{default:C(()=>[(L(),Ze(Je,null,{default:C(()=>[A("div",sn,[$(mt,{renderer:Ve,listeners:Ue,options:v})])]),_:1})),A("div",ln,[(L(!0),z(ee,null,le(D(s).options.functions,(r,g)=>{var m,I,x,P,M;return L(),z("div",{key:g},[A("h2",un,[ue(A("input",{class:"w-8 h-8",name:"fill",type:"color","onUpdate:modelValue":O=>r.color=O},null,8,cn),[[ie,r.color]]),H(" "+Y((m=oe(g))==null?void 0:m.name)+": ",1),A("span",dn,Y((x=(I=oe(g))==null?void 0:I.domain)==null?void 0:x.name)+" → "+Y((M=(P=oe(g))==null?void 0:P.codomain)==null?void 0:M.name),1)]),$(en,{modelValue:r.extent,"onUpdate:modelValue":O=>r.extent=O},null,8,["modelValue","onUpdate:modelValue"])])}),128))])]),_:1})]),_:1})]),_:1})],64))}});export{bn as default};
